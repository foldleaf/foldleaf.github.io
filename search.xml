<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>关于本站</title>
      <link href="/2030/01/30/%E5%85%B3%E4%BA%8E%E6%9C%AC%E7%AB%99/"/>
      <url>/2030/01/30/%E5%85%B3%E4%BA%8E%E6%9C%AC%E7%AB%99/</url>
      
        <content type="html"><![CDATA[<p>经过多方面的尝试，把 hexo、vuepress、hugo、docusaurus 等静态博客都搭了一遍，hugo 是用 go 模板语法来写的，但是有点问题就是有些主题的依赖下载有问题，能用的主题又感觉不好看，docusaurus 除了默认主题外唯一找到个不错的主题但似乎又因为 npm 依赖问题而放弃…… 最终方案是 <code>hexo-butterfly</code> + <code>vuepress-theme-hope</code></p><p>使用 hexo 作为主博客，在 butterfly、sakura、shoka 中最后选择了 butterfly 主题，主要原因是其生态比较好，diy 教程比较齐全，花样多，缺点是系列文章不太方便查看</p><p>使用 vuepress 作为副博客 / 文档站，最后在默认、reco、hope、gungnir、aurora 中选择了 hope 主题，主要原因是它的侧边栏能够根据文件层级自动生成树状目录，方便查看，缺点是不够花哨</p><p>如果你对本博客花哨的界面有所不适，可以移步到<a href="https://foldleaf.github.io/leaf-hope">我的文档站</a></p><p>最近看上了 rust 的 <a href="https://github.com/rust-lang/mdBook">mdbook</a>，这个感觉不错，可以单独拿来搞一个系列文档或一本电子书之类的</p>]]></content>
      
      
      <categories>
          
          <category> 杂谈 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 杂谈 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>常用工具</title>
      <link href="/2023/04/17/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/"/>
      <url>/2023/04/17/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<h2 id="数据库"><a class="markdownIt-Anchor" href="#数据库">#</a> 数据库</h2><p>数据库连接<br> Navicat<br>DBeaver</p><p>数据库设计<br> powerDesigne  上世纪的 ui，换一个吧<br> pdmaner</p><h2 id="编辑器"><a class="markdownIt-Anchor" href="#编辑器">#</a> 编辑器</h2><p>vscode 永远滴神 go、rust、python 等等 java 和 c 系列也能配置<br> IDEA java 专用<br> visual studio c 系列语言专用<br> pycharm python 专用<br> goland go 专用<br> vim 需要配置，vim 操作不好用<br> neovim 现代化的 vim<br>helix 比较新的东西，没试过，类似于 vim</p><h2 id="虚拟机"><a class="markdownIt-Anchor" href="#虚拟机">#</a> 虚拟机</h2><p>vmware<br>virtual box</p><h2 id="linux"><a class="markdownIt-Anchor" href="#linux">#</a> linux</h2><p>ArchLinux 从零配置，滚动更新<br> manjaro 基于 arch 的，不过已经是两种东西了<br> debian 应该是最稳定的<br> ubuntu 基于 debian 的，比较稳定，已配好基本配置<br> kali 安全渗透<br> redhat 商业稳定版</p><h2 id="接口测试"><a class="markdownIt-Anchor" href="#接口测试">#</a> 接口测试</h2><p>postman<br>apipost 本人用这个<br> apifox</p><h2 id="博客建站"><a class="markdownIt-Anchor" href="#博客建站">#</a> 博客建站</h2><h3 id="静态"><a class="markdownIt-Anchor" href="#静态">#</a> 静态</h3><p>hexo  感觉是国内生态最丰富的，推荐 butterfly 和 Next 主题，模板引擎编写<br> vuepress  基于 vue，vuepress2 是基于 vue3,1 是 vue2 的，官网文档不太好用，推荐 hope 与 reco 主题<br> hugo   go 模板编写，推荐 docsify（因为不知道为什么少了个依赖最后放弃了）<br>docusaurus  推荐前端华峰工程师的主题（虽然我试的时候似乎因为 node 版本过高出现问题）<br>gatsby 外国很多，国内没什么人用<br> aurora  蝉时雨大佬用 vue 做的，大佬还用 react 做了另一个好看的</p><h3 id="动态"><a class="markdownIt-Anchor" href="#动态">#</a> 动态</h3><p>WordPress 用的最多</p><h2 id="容器化"><a class="markdownIt-Anchor" href="#容器化">#</a> 容器化</h2><p>docker<br>K8S</p><h2 id="画图"><a class="markdownIt-Anchor" href="#画图">#</a> 画图</h2><p><a href="http://draw.io">draw.io</a><br>axure<br>figma</p><h2 id="小工具"><a class="markdownIt-Anchor" href="#小工具">#</a> 小工具</h2><h3 id="本地文件搜索"><a class="markdownIt-Anchor" href="#本地文件搜索">#</a> 本地文件搜索</h3><p>everything<br>filelocator pro</p><h3 id="磁盘查看"><a class="markdownIt-Anchor" href="#磁盘查看">#</a> 磁盘查看</h3><p>WizTree</p><h3 id="截图"><a class="markdownIt-Anchor" href="#截图">#</a> 截图</h3><p>snipaste</p><h3 id="文件对比"><a class="markdownIt-Anchor" href="#文件对比">#</a> 文件对比</h3><p>BCompare</p><h2 id="抓包"><a class="markdownIt-Anchor" href="#抓包">#</a> 抓包</h2><p>wireshark</p><h2 id="16进制的编辑软件"><a class="markdownIt-Anchor" href="#16进制的编辑软件">#</a> 16 进制的编辑软件</h2><p>winhex</p><h2 id="桌面美化"><a class="markdownIt-Anchor" href="#桌面美化">#</a> 桌面美化</h2><p>window  SIO，基于 qt, 并非真正的桌面<br> linux  kde、i3、xfce、gone 等等</p>]]></content>
      
      
      <categories>
          
          <category> 杂谈 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 杂谈 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue-router</title>
      <link href="/2023/04/16/vue-router/"/>
      <url>/2023/04/16/vue-router/</url>
      
        <content type="html"><![CDATA[<h1 id="项目创建"><a class="markdownIt-Anchor" href="#项目创建">#</a> 项目创建</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> create vite@latest<span class="token comment"># 项目命名为 sidebar</span><span class="token builtin class-name">cd</span> sidebar<span class="token function">npm</span> i<span class="token function">npm</span> run dev<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="资源准备"><a class="markdownIt-Anchor" href="#资源准备">#</a> 资源准备</h1><p>图标与字体，在 index.html 中 head 标签中引用</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span><span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://fonts.googleapis.com/css2?family=Material+Icons<span class="token punctuation">"</span></span><span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span>     <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preconnect<span class="token punctuation">"</span></span>     <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://fonts.googleapis.com<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span>     <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preconnect<span class="token punctuation">"</span></span>     <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://fonts.gstatic.com<span class="token punctuation">"</span></span>     <span class="token attr-name">crossorigin</span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span><span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://fonts.googleapis.com/css2?family=Fira+Sans:wght@100&amp;display=swap<span class="token punctuation">"</span></span><span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>sass</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">add</span> <span class="token parameter variable">-D</span> sass<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>vue-router</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> i vue-router<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="路由配置"><a class="markdownIt-Anchor" href="#路由配置">#</a> 路由配置</h1><p>以下都是在 src 文件夹下:<br>src/views/Home.vue</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>main</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>home-page<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Home<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>This is Home page<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>main</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>src/views/About.vue 类似</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>main</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>about-page<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>About<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>This is About page<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>main</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>src/main.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createApp <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token comment">// import './style.css'</span><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createRouter<span class="token punctuation">,</span>createWebHistory <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue-router'</span><span class="token keyword">import</span> Home <span class="token keyword">from</span> <span class="token string">'./views/Home.vue'</span><span class="token keyword">import</span> About <span class="token keyword">from</span> <span class="token string">'./views/About.vue'</span><span class="token keyword">const</span> router<span class="token operator">=</span><span class="token function">createRouter</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token literal-property property">history</span><span class="token operator">:</span> <span class="token function">createWebHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token literal-property property">routes</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">&#123;</span>            <span class="token literal-property property">path</span><span class="token operator">:</span><span class="token string">'/'</span><span class="token punctuation">,</span>            <span class="token literal-property property">component</span><span class="token operator">:</span> Home<span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token punctuation">&#123;</span>            <span class="token literal-property property">path</span><span class="token operator">:</span><span class="token string">'/about'</span><span class="token punctuation">,</span>            <span class="token literal-property property">component</span><span class="token operator">:</span> About<span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>src/App.vue</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>scss<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="将路由配置独立出来"><a class="markdownIt-Anchor" href="#将路由配置独立出来">#</a> 将路由配置独立出来</h1><p>新建文件夹 src/router<br> 将原来 main.js 有关 router 的代码移动到 <code>src/router/index.js</code> ，注 <code>import</code>  时文件层级会发生变化；<br> 该文件导出模块命名为 router:  <code>export default router</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createRouter<span class="token punctuation">,</span>createWebHistory <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue-router'</span><span class="token keyword">import</span> Home <span class="token keyword">from</span> <span class="token string">'../views/Home.vue'</span><span class="token keyword">import</span> About <span class="token keyword">from</span> <span class="token string">'../views/About.vue'</span><span class="token keyword">const</span> router<span class="token operator">=</span><span class="token function">createRouter</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token literal-property property">history</span><span class="token operator">:</span> <span class="token function">createWebHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token literal-property property">routes</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">&#123;</span>            <span class="token literal-property property">path</span><span class="token operator">:</span><span class="token string">'/'</span><span class="token punctuation">,</span>            <span class="token literal-property property">component</span><span class="token operator">:</span> Home<span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token punctuation">&#123;</span>            <span class="token literal-property property">path</span><span class="token operator">:</span><span class="token string">'/about'</span><span class="token punctuation">,</span>            <span class="token literal-property property">component</span><span class="token operator">:</span> About<span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">export</span> <span class="token keyword">default</span> router<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在 main.js 中引用</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createApp <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token comment">// import './style.css'</span><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span><span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'./router'</span><span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="侧边栏准备"><a class="markdownIt-Anchor" href="#侧边栏准备">#</a> 侧边栏准备</h1><p>src/components/Sidebar.vue</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>aside</span><span class="token punctuation">></span></span>        Sidebar    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>aside</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>scss<span class="token punctuation">"</span></span> <span class="token attr-name">scoped</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>src/App.vue</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">import</span> Sidebar <span class="token keyword">from</span> <span class="token string">'./components/Sidebar.vue'</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Sidebar</span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>scss<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><span class="token selector">:root</span> <span class="token punctuation">&#123;</span>    <span class="token property">--primary</span><span class="token punctuation">:</span> #4ade80<span class="token punctuation">;</span>    <span class="token property">--grey</span><span class="token punctuation">:</span> #64748b<span class="token punctuation">;</span>    <span class="token property">--dark</span><span class="token punctuation">:</span> #1e293b<span class="token punctuation">;</span>    <span class="token property">--dark-alt</span><span class="token punctuation">:</span> #334155<span class="token punctuation">;</span>    <span class="token property">--light</span><span class="token punctuation">:</span> #f1f5f9<span class="token punctuation">;</span>    <span class="token property">--sidebar-width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">*</span> <span class="token punctuation">&#123;</span>    <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>    <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>    <span class="token property">box-sizing</span><span class="token punctuation">:</span> border-box<span class="token punctuation">;</span>    <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">'Fira sans'</span><span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">body</span> <span class="token punctuation">&#123;</span>    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--light<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">button</span> <span class="token punctuation">&#123;</span>    <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span>    <span class="token property">appearance</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>    <span class="token property">border</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>    <span class="token property">outline</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>    <span class="token property">background</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.app</span><span class="token punctuation">&#123;</span>    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>    <span class="token selector">main</span><span class="token punctuation">&#123;</span>        <span class="token property">flex</span><span class="token punctuation">:</span> 1 1 0<span class="token punctuation">;</span>        <span class="token property">padding</span><span class="token punctuation">:</span> 2rem<span class="token punctuation">;</span>        <span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">max-width</span><span class="token punctuation">:</span> 768px<span class="token punctuation">)</span></span> <span class="token punctuation">&#123;</span>            <span class="token property">padding-left</span><span class="token punctuation">:</span> 6rem<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>主要是写整体的 css 样式排版，我也不是很懂<br>接下来重点在 src/components/Sidebar.vue 上</p><h1 id="侧边导航栏"><a class="markdownIt-Anchor" href="#侧边导航栏">#</a> 侧边导航栏</h1><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>menu<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>material-icons<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>home<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Home<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/about<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>material-icons<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>description<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>About<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>css 代码有点麻烦，忽略，只了解 router-link 即可</p><h1 id="sidebar代码"><a class="markdownIt-Anchor" href="#sidebar代码">#</a> Sidebar 代码</h1><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- 当is_expanded为true时，添加类名为'is_expanded'的样式 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>aside</span> <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>`$&#123;is_expanded&amp;&amp;'is_expanded'&#125;`<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>logo<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../assets/vue.svg<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vue<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>menu-toggle-wrap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>menu-toggle<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ToggleMenu<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>material-icons<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>keyboard_double_arrow_right<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">></span></span>Menu<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>menu<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>material-icons<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>home<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Home<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/about<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>material-icons<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>description<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>About<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>aside</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> ref <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> RouterLink <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue-router'</span><span class="token punctuation">;</span><span class="token keyword">const</span> is_expanded<span class="token operator">=</span><span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token function-variable function">ToggleMenu</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span>    is_expanded<span class="token punctuation">.</span>value<span class="token operator">=</span><span class="token operator">!</span>is_expanded<span class="token punctuation">.</span>value<span class="token punctuation">&#125;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>scss<span class="token punctuation">"</span></span> <span class="token attr-name">scoped</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><span class="token selector">aside</span><span class="token punctuation">&#123;</span>    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>    <span class="token property">flex-direction</span><span class="token punctuation">:</span> column<span class="token punctuation">;</span>    <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--dark<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--light<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>2rem + 32px<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>    <span class="token property">min-height</span><span class="token punctuation">:</span> 100vh<span class="token punctuation">;</span>    <span class="token property">padding</span><span class="token punctuation">:</span> 1rem<span class="token punctuation">;</span>    <span class="token property">transition</span><span class="token punctuation">:</span> 0.2s ease-out<span class="token punctuation">;</span>    <span class="token selector">.logo</span><span class="token punctuation">&#123;</span>        <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 1rem<span class="token punctuation">;</span>        <span class="token selector">img</span><span class="token punctuation">&#123;</span>            <span class="token property">width</span><span class="token punctuation">:</span> 2rem<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token selector">.menu-toggle-wrap</span><span class="token punctuation">&#123;</span>        <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>        <span class="token property">justify-content</span><span class="token punctuation">:</span> flex-end<span class="token punctuation">;</span>        <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 1rem<span class="token punctuation">;</span>                <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>        <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>        <span class="token property">transition</span><span class="token punctuation">:</span> 0.2s ease-out<span class="token punctuation">;</span>        <span class="token selector">.menu-toggle</span><span class="token punctuation">&#123;</span>            <span class="token property">transition</span><span class="token punctuation">:</span> 0.2s ease-out<span class="token punctuation">;</span>            <span class="token selector">.material-icons</span><span class="token punctuation">&#123;</span>                <span class="token property">font-size</span><span class="token punctuation">:</span> 2rem<span class="token punctuation">;</span>                <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--light<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token property">transition</span><span class="token punctuation">:</span> 0.2s ease-out<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token selector">&amp;:hover</span><span class="token punctuation">&#123;</span>                <span class="token selector">.material-icons</span><span class="token punctuation">&#123;</span>                                        <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--primary<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>0.5rem<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token selector">h3, .button .text</span><span class="token punctuation">&#123;</span>        <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>        <span class="token property">transition</span><span class="token punctuation">:</span> 0.3s ease-out<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token selector">.menu</span><span class="token punctuation">&#123;</span>        <span class="token property">margin</span><span class="token punctuation">:</span> 0 -1rem<span class="token punctuation">;</span>        <span class="token selector">.button</span><span class="token punctuation">&#123;</span>            <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>            <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>            <span class="token property">text-decoration</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>            <span class="token property">padding</span><span class="token punctuation">:</span> 0.5rem 1rem<span class="token punctuation">;</span>            <span class="token property">transition</span><span class="token punctuation">:</span> 0.2s ease-out<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token selector">.material-icons</span><span class="token punctuation">&#123;</span>            <span class="token property">font-size</span><span class="token punctuation">:</span> 2rem<span class="token punctuation">;</span>            <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--light<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token property">transition</span><span class="token punctuation">:</span> 0.2s ease-out<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token selector">.text</span><span class="token punctuation">&#123;</span>            <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--light<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token property">transition</span><span class="token punctuation">:</span> 0.2s ease-out<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token selector">&amp;:hover</span><span class="token punctuation">&#123;</span>            <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--dark-alt<span class="token punctuation">)</span><span class="token punctuation">;</span>                                            <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>    <span class="token selector">&amp;.is_expanded</span><span class="token punctuation">&#123;</span>        <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--sidebar-width<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token selector">.menu-toggle-wrap</span><span class="token punctuation">&#123;</span>            <span class="token property">top</span><span class="token punctuation">:</span> -3rem<span class="token punctuation">;</span>            <span class="token selector">.menu-toggle</span><span class="token punctuation">&#123;</span>                <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>-180deg<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">max-width</span><span class="token punctuation">:</span> 768px<span class="token punctuation">)</span></span> <span class="token punctuation">&#123;</span>        <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>        <span class="token property">z-index</span><span class="token punctuation">:</span> 99<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>electron-vite</title>
      <link href="/2023/04/15/electron-vite/"/>
      <url>/2023/04/15/electron-vite/</url>
      
        <content type="html"><![CDATA[<p>这应该是目前最简单的创建方法<br><a href="https://github.com/electron-vite/electron-vite-vue"> https://github.com/electron-vite/electron-vite-vue</a></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> create electron-vite<span class="token comment"># 假设项目名为myapp</span><span class="token builtin class-name">cd</span> myapp<span class="token function">npm</span> i<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>在根目录下创建.npmrc 文件，设置镜像</p><blockquote><p>很重要，国内 build 打包必需。试错了好多个方法，这个是最简洁有效的<br><a href="https://segmentfault.com/a/1190000040356146"> https://segmentfault.com/a/1190000040356146</a></p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">ELECTRON_MIRROR</span><span class="token operator">=</span>https://npm.taobao.org/mirrors/electron/<span class="token assign-left variable">ELECTRON_BUILDER_BINARIES_MIRROR</span><span class="token operator">=</span>http://npm.taobao.org/mirrors/electron-builder-binaries/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> run dev <span class="token comment"># 调试</span><span class="token function">npm</span> run build <span class="token comment"># 打包文件在 release文件夹下</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> electron </category>
          
      </categories>
      
      
        <tags>
            
            <tag> electron </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pyside6使用designer生成的文件</title>
      <link href="/2023/04/12/pyside6%E4%BD%BF%E7%94%A8designer%E7%94%9F%E6%88%90%E7%9A%84%E6%96%87%E4%BB%B6/"/>
      <url>/2023/04/12/pyside6%E4%BD%BF%E7%94%A8designer%E7%94%9F%E6%88%90%E7%9A%84%E6%96%87%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="转成python文件"><a class="markdownIt-Anchor" href="#转成python文件">#</a> 转成 python 文件</h1><p>在文件所在目录执行</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># pyside6-uic &lt;ui文件名> -o &lt;生成的py文件名></span>pyside6-uic computer.ui <span class="token parameter variable">-o</span> computer.py<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>在 vscode 中配置好 Qt for Python 插件后，只需要在 ui 文件处右键选择  <code>Compile Qt UI File(uic)</code>  即可转换</p><p>可以右键选择 Edit QT UI DILE (designer)，便捷地在 qt designer 里打开并编辑 ui 文件</p><h1 id="使用生成的python文件"><a class="markdownIt-Anchor" href="#使用生成的python文件">#</a> 使用生成的 python 文件</h1><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> PySide6<span class="token punctuation">.</span>QtWidgets <span class="token keyword">import</span> QApplication<span class="token punctuation">,</span>QWidget<span class="token comment"># 从生成的python文件中导入，导入的名称要与文件中的类名一致</span><span class="token keyword">from</span> computer <span class="token keyword">import</span> Ui_Form<span class="token keyword">class</span> <span class="token class-name">MyWindow</span><span class="token punctuation">(</span>QWidget<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment"># 使用生成的 ui</span>        self<span class="token punctuation">.</span>ui<span class="token operator">=</span>Ui_Form<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>setupUi<span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    app<span class="token operator">=</span>QApplication<span class="token punctuation">(</span><span class="token punctuation">)</span>    window<span class="token operator">=</span>MyWindow<span class="token punctuation">(</span><span class="token punctuation">)</span>    window<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>    app<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>class 的另一种多继承写法，更简洁:</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">MyWindow</span><span class="token punctuation">(</span>QWidget<span class="token punctuation">,</span>Ui_Form<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>setupUi<span class="token punctuation">(</span>self<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> pyside6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pyside6环境搭建及快速入门</title>
      <link href="/2023/04/11/pyside6%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E5%8F%8A%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"/>
      <url>/2023/04/11/pyside6%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E5%8F%8A%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<p>在此之前，你应该保证已经安装好 python 了</p><h1 id="pyside6"><a class="markdownIt-Anchor" href="#pyside6">#</a> pyside6</h1><pre class="line-numbers language-python" data-language="python"><code class="language-python">pip install pyside6<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="vscode"><a class="markdownIt-Anchor" href="#vscode">#</a> vscode</h1><p>插件 : Qt for Python</p><p>设置 - 扩展 - Qt for Python :<br> <code>designer path</code> : D:\anaconda3\Lib\site-packages\PySide6\designer.exe<br> <code>rcc path</code> : D:\anaconda3\Scripts\pyside6-rcc.exe<br> <code>uic path</code> : D:\anaconda3\Scripts\pyside6-uic.exe</p><p>(因为我这个环境是有用 anaconda 的，选择 pip install 的位置 (以上我的安装路径为 D:\anaconda3) 即可，)</p><p>也可以直接在 setting.json 里直接编辑:</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token property">"qtForPython.designer.path"</span><span class="token operator">:</span> <span class="token string">"D:\\anaconda3\\Lib\\site-packages\\PySide6\\designer.exe"</span><span class="token punctuation">,</span><span class="token property">"qtForPython.rcc.path"</span><span class="token operator">:</span> <span class="token string">"D:\\anaconda3\\Scripts\\pyside6-rcc.exe"</span><span class="token punctuation">,</span><span class="token property">"qtForPython.uic.path"</span><span class="token operator">:</span> <span class="token string">"D:\\anaconda3\\Scripts\\pyside6-uic.exe"</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>在 vscode 中的左侧导航栏右键选择 Create Qt UI File (designer), 可以打开 qt designer</p><p>设置 - 扩展 - Python: 设置自动补全的额外路径</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token property">"python.analysis.extraPaths"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token string">"D:\\anaconda3\\Lib\\site-packages"</span><span class="token punctuation">,</span>        <span class="token string">"D:\\anaconda3\\Scripts"</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h1 id="最简可运行代码"><a class="markdownIt-Anchor" href="#最简可运行代码">#</a> 最简可运行代码</h1><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 导入包</span><span class="token keyword">from</span> PySide6<span class="token punctuation">.</span>QtWidgets <span class="token keyword">import</span> QApplication<span class="token punctuation">,</span> QWidget<span class="token comment"># sys 包仅用于访问命令行参数，图形化界面一般用不上</span><span class="token keyword">import</span> sys<span class="token comment"># 每个应用程序只需要一个 QApplication 实例</span><span class="token comment"># 传入 sys.argv 以允许应用程序使用命令行参数(也可以忽略，图形化界面一般用不上)</span>app <span class="token operator">=</span> QApplication<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span><span class="token comment"># 创建一个 Qt 部件, 作为我们的窗口.</span>window <span class="token operator">=</span> QWidget<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 显示窗口，窗口默认是隐藏的</span>window<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 启动事件循环</span>app<span class="token punctuation">.</span>exec_<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 当退出程序后事件结束，程序结束</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="自定义窗口以及信号-槽"><a class="markdownIt-Anchor" href="#自定义窗口以及信号-槽">#</a> 自定义窗口以及信号、槽</h1><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> PySide6<span class="token punctuation">.</span>QtWidgets <span class="token keyword">import</span> QApplication<span class="token punctuation">,</span> QMainWindow<span class="token punctuation">,</span> QPushButton<span class="token punctuation">,</span>QLabel<span class="token comment"># 创建QMainWindow的子类，以自定义窗口</span><span class="token keyword">class</span> <span class="token class-name">MainWindow</span><span class="token punctuation">(</span>QMainWindow<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment"># 设置窗口标题</span>        self<span class="token punctuation">.</span>setWindowTitle<span class="token punctuation">(</span><span class="token string">"My App"</span><span class="token punctuation">)</span>        <span class="token comment"># 按钮控件</span>        button <span class="token operator">=</span> QPushButton<span class="token punctuation">(</span><span class="token string">"点我点我"</span><span class="token punctuation">,</span>self<span class="token punctuation">)</span>        <span class="token comment"># 接着就可以设置这个控件的属性</span>        button<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span>        button<span class="token punctuation">.</span>setToolTip<span class="token punctuation">(</span><span class="token string">"这是一个按钮"</span><span class="token punctuation">)</span>        button<span class="token punctuation">.</span>setText<span class="token punctuation">(</span><span class="token string">"我被点了"</span><span class="token punctuation">)</span>                <span class="token comment"># 点击按钮的信号</span>        button<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>hello<span class="token punctuation">)</span>        <span class="token comment"># 同理，标签控件</span>        label <span class="token operator">=</span> QLabel<span class="token punctuation">(</span><span class="token string">"welcome"</span><span class="token punctuation">,</span>self<span class="token punctuation">)</span>        label<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">)</span>        label<span class="token punctuation">.</span>setText<span class="token punctuation">(</span><span class="token string">"什么"</span><span class="token punctuation">)</span>    <span class="token comment"># 接收点击按钮的信号(槽，即接收的函数)</span>    <span class="token keyword">def</span> <span class="token function">hello</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">"__main__"</span><span class="token punctuation">:</span>    app <span class="token operator">=</span> QApplication<span class="token punctuation">(</span><span class="token punctuation">)</span>    window <span class="token operator">=</span> MainWindow<span class="token punctuation">(</span><span class="token punctuation">)</span>    window<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>    app<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> pyside6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>半小时学习rust</title>
      <link href="/2023/04/10/rust%E5%8D%8A%E5%B0%8F%E6%97%B6%E5%AD%A6%E4%B9%A0/"/>
      <url>/2023/04/10/rust%E5%8D%8A%E5%B0%8F%E6%97%B6%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>本文为粗略的翻译</p><p>为了提高编程语言的熟练度，就必须要大量阅读有关资料。但是，如果你不知道它的意思，你怎么能大量阅读呢？</p><p>在本文中，我将不会关注于一两个概念，而是试着通过尽可能多的 Rust 代码段，解释其中的关键字和符号的含义。</p><p>准备好了吗？让我们开始吧！</p><hr><p><code>let</code>  引入了变量绑定 (variable binding)</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> x<span class="token punctuation">;</span>  <span class="token comment">// 声明 "x"</span>x <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span> <span class="token comment">// 将 42 分配给 "x"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>也可以写成一行</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>您可以显式地指定变量的类型，用冒号表示类型注释: <code>:</code></p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> x<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">;</span> <span class="token comment">// i32是一个有符号的32位整数</span>x <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span><span class="token comment">// 有符号整数有: i8, i16, i32, i64, i128</span><span class="token comment">// 无符号整数有: u8, u16, u32, u64, u128 </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>也可以写成一行</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> x<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如果您声明一个变量，之后再初始化，编译器将会阻止你初始化之前使用这个变量</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> x<span class="token punctuation">;</span><span class="token function">foobar</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// error: borrow of possibly-uninitialized variable: `x`</span><span class="token comment">// 借用可能未初始化的变量: `x`</span>x <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>正确的写法是这样:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> x<span class="token punctuation">;</span>x <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span><span class="token function">foobar</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  `x` 的类型将会在这被推断出来</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>下划线是一个特殊的变量名，更确切地说是 “空缺名”, 意思就是扔掉一些东西: <code>_</code></p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// 42是常数，所以无事发生</span><span class="token keyword">let</span> _ <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span><span class="token comment">// 调用 `get_thing` 函数但是舍弃了扔掉了的结果</span><span class="token keyword">let</span> _ <span class="token operator">=</span> <span class="token function">get_thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以下划线开头的变量名是普通名称，只是编译器不会警告它们不被使用:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// 变量声明但不使用会被编译器警告</span><span class="token comment">// 在变量名前面加下划线可以去掉警告</span><span class="token keyword">let</span> _x <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>可以对同一个变量名多次绑定 - 你可以掩盖 (shadow) 变量绑定</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">13</span><span class="token punctuation">;</span><span class="token keyword">let</span> x <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token comment">// 在这之后使用 `x` 指代的都是第二个 `x`</span><span class="token comment">// 第一个  `x` 已不存在.（关于这点本人有补充，见下）</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>译者注：掩盖 (shadowing) 是在作用域之内掩盖掉原有的变量名，在作用域结束之后掩盖失效，因为此处两个  <code>x</code>  作用域相同，所以第二个 <code>x</code>  会一直掩盖第一个  <code>x</code></p></blockquote><p>Rust 有元组 (tuples)，您可以将其视为 “不同类型的值的固定长度集合”。</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> pair <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token char">'a'</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">;</span>pair<span class="token number">.0</span><span class="token punctuation">;</span> <span class="token comment">// 这是 'a'</span>pair<span class="token number">.1</span><span class="token punctuation">;</span> <span class="token comment">// 这是 17</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>如果想添加类型注释:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> pair<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token char">'a'</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>元组在执行任务时可以被解构 (destructured)，这意味着它们被分解为独立的字段:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> <span class="token punctuation">(</span>some_char<span class="token punctuation">,</span> some_int<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token char">'a'</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 现在 some_char是 'a'，some_int是 17</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>这点在函数返回元组时特别有用:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> <span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">)</span> <span class="token operator">=</span> slice<span class="token punctuation">.</span><span class="token function">split_at</span><span class="token punctuation">(</span>middle<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>当然，在解构元组时，可以用 <code>_</code> 来丢弃它的一部分</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> <span class="token punctuation">(</span>_<span class="token punctuation">,</span> right<span class="token punctuation">)</span> <span class="token operator">=</span> slice<span class="token punctuation">.</span><span class="token function">split_at</span><span class="token punctuation">(</span>middle<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>分号表示语句的结尾:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span><span class="token keyword">let</span> z <span class="token operator">=</span> y <span class="token operator">+</span> x<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>这意味着语句可以跨越多行</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span>    <span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>x<span class="token closure-punctuation punctuation">|</span></span> x <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">fold</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>x<span class="token punctuation">,</span> y<span class="token closure-punctuation punctuation">|</span></span> x <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>(我们待会儿再讨论它们的意思)<br> <code>fn</code>  声明一个没有返回值的函数</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Hi there!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>下面的函数返回 32 位有符号整数，箭头 <code>-&gt;</code>  表示它的返回类型:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">fair_dice_roll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">i32</span> <span class="token punctuation">&#123;</span>    <span class="token number">4</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>一对花括号 <code>&#123;&#125;</code>  声明一个代码块 (block)，它有自己的作用域</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// This prints "in", then "out"</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token string">"out"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#123;</span>        <span class="token comment">// this is a different `x`</span>        <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token string">"in"</span><span class="token punctuation">;</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>代码块也是表达式，可以计算为 (evaluate) 一个值</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span><span class="token comment">// 两者等价</span><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token number">42</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>在一个代码块中，可以有多个语句</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// first statement</span>    <span class="token keyword">let</span> z <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// second statement</span>    y <span class="token operator">+</span> z <span class="token comment">// 这是代码块的结尾 - 整个代码块返回的值</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>所以省略函数末尾语句的分号等价于 return 语句</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">fair_dice_roll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">i32</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token number">4</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">fair_dice_roll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">i32</span> <span class="token punctuation">&#123;</span>    <span class="token number">4</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>if</code>  条件语句也是表达式</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">fair_dice_roll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">i32</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> feeling_lucky <span class="token punctuation">&#123;</span>        <span class="token number">6</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token number">4</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>match</code>  语句也是表达式</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">fair_dice_roll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">i32</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">match</span> feeling_lucky <span class="token punctuation">&#123;</span>        <span class="token boolean">true</span> <span class="token operator">=></span> <span class="token number">6</span><span class="token punctuation">,</span>        <span class="token boolean">false</span> <span class="token operator">=></span> <span class="token number">4</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>符号点 <code>.</code>  通常用于访问值的字段:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>a<span class="token number">.0</span><span class="token punctuation">;</span> <span class="token comment">// this is 10</span><span class="token keyword">let</span> amos <span class="token operator">=</span> <span class="token function">get_some_struct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>amos<span class="token punctuation">.</span>nickname<span class="token punctuation">;</span> <span class="token comment">// this is "fasterthanlime"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>或者调用值的某个方法:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> nick <span class="token operator">=</span> <span class="token string">"fasterthanlime"</span><span class="token punctuation">;</span>nick<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// this is 14</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>双冒号 <code>::</code>  类似，但是它用于命名空间</p><p>在这个例子中， <code>std</code>  是一个 crate, <code>cmd</code>  是一个模块 (module), <code>min</code>  是一个函数</p><blockquote><p>译者注:package、crate、module 概念不要以其他语言的概念先入为主，这里简要提一下，不作展开</p><ol><li>package 为项目，就是 cargo new 创建的项目就称为 package</li><li>crate 是一个独立的编译单元，又分为 binary (二进制) crate 和 library crate，硬要翻译这个名词的话叫做分隔箱比较恰当。<br>binary crate 的充要条件是有 src/main.rs<br>library crate 的充要条件是有 src/lib.rs</li><li>module 是模块，用于内部代码的组织，可以控制作用域及私有性</li></ol></blockquote><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> least <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>cmp<span class="token punctuation">::</span></span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// this is 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>use directives can be used to “bring in scope” names from other namespace:<br> <code>use</code>  关键字用来引入其他命名空间的作用域里的内容，例如函数</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>cmp<span class="token punctuation">::</span></span>min<span class="token punctuation">;</span><span class="token keyword">let</span> least <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// this is 1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>在 use 关键字中，花括号还有另一个意思：它们来源相同<br>如果我们想同时导入 min 和 max，我们可以执行以下任何操作:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// this works:</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>cmp<span class="token punctuation">::</span></span>min<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>cmp<span class="token punctuation">::</span></span>max<span class="token punctuation">;</span><span class="token comment">// this also works:</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>cmp<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span>min<span class="token punctuation">,</span> max<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">// this also works!</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token namespace">cmp<span class="token punctuation">::</span></span>min<span class="token punctuation">,</span> <span class="token namespace">cmp<span class="token punctuation">::</span></span>max<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>类似于 javascript 的 <code>import &#123;min,max&#125; from 'xxx'</code></p></blockquote><p>A wildcard () lets you import every symbol from a namespace:*<br> 通配符 <code>*</code>  允许你从命名空间导入所有内容</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// this brings `min` and `max` in scope, and many other things</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>cmp<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>类型也命名空间，类型的方法可以作为常规函数调用:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token string">"amos"</span><span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// this is 4</span><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token keyword">str</span><span class="token punctuation">::</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token string">"amos"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// this is also 4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>str is a primitive type, but many non-primitive types are also in scope by default.<br> <code>str</code>  是原始类型，但也有许多非原始类型</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// `Vec` is a regular struct, not a primitive type</span><span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token class-name">Vec</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// this is exactly the same code, but with the *full* path to `Vec`</span><span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>vec<span class="token punctuation">::</span></span><span class="token class-name">Vec</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这会正常编译，因为 Rust 会在每个模块的开头插入:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span>v1<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>(这引入了很多东西， <code>Vec</code> ,  <code>String</code> ,  <code>Option</code>  , <code>Result</code>  等等)</p><p><code>struct</code>  关键字用于声明结构体</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">Vec2</span> <span class="token punctuation">&#123;</span>    x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span> <span class="token comment">// 64-bit floating point, aka "double precision"</span>    y<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>使用结构体字面量初始化</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token class-name">Rust</span> code<span class="token keyword">let</span> v1 <span class="token operator">=</span> <span class="token class-name">Vec2</span> <span class="token punctuation">&#123;</span> x<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">3.0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">let</span> v2 <span class="token operator">=</span> <span class="token class-name">Vec2</span> <span class="token punctuation">&#123;</span> y<span class="token punctuation">:</span> <span class="token number">2.0</span><span class="token punctuation">,</span> x<span class="token punctuation">:</span> <span class="token number">4.0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">// the order does not matter, only the names do</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>用另一个结构体初始化剩余字段的快捷方式:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> v3 <span class="token operator">=</span> <span class="token class-name">Vec2</span> <span class="token punctuation">&#123;</span>    x<span class="token punctuation">:</span> <span class="token number">14.0</span><span class="token punctuation">,</span>    <span class="token punctuation">..</span>v2    <span class="token comment">// 只能在最后使用，后面不能有逗号</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>注意，剩余字段前面不加任何东西时可以表示所有字段:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> v4 <span class="token operator">=</span> <span class="token class-name">Vec2</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">..</span>v3 <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>结构体可以像元组一样被解构</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> <span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">)</span> <span class="token operator">=</span> slice<span class="token punctuation">.</span><span class="token function">split_at</span><span class="token punctuation">(</span>middle<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>像这样</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token class-name">Vec2</span> <span class="token punctuation">&#123;</span> x<span class="token punctuation">:</span> <span class="token number">3.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">6.0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">let</span> <span class="token class-name">Vec2</span> <span class="token punctuation">&#123;</span> x<span class="token punctuation">,</span> y <span class="token punctuation">&#125;</span> <span class="token operator">=</span> v<span class="token punctuation">;</span><span class="token comment">// `x` 为 3.0, `y` 为 `6.0`</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>还有这样</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> <span class="token class-name">Vec2</span> <span class="token punctuation">&#123;</span> x<span class="token punctuation">,</span> <span class="token punctuation">..</span> <span class="token punctuation">&#125;</span> <span class="token operator">=</span> v<span class="token punctuation">;</span><span class="token comment">// 舍弃了 `v.y`</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><code>let</code>  模式匹配可以作为 <code>if</code>  的判断条件</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">Number</span> <span class="token punctuation">&#123;</span>    odd<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>    value<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> one <span class="token operator">=</span> <span class="token class-name">Number</span> <span class="token punctuation">&#123;</span> odd<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> two <span class="token operator">=</span> <span class="token class-name">Number</span> <span class="token punctuation">&#123;</span> odd<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token function">print_number</span><span class="token punctuation">(</span>one<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_number</span><span class="token punctuation">(</span>two<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">print_number</span><span class="token punctuation">(</span>n<span class="token punctuation">:</span> <span class="token class-name">Number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Number</span> <span class="token punctuation">&#123;</span> odd<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> value <span class="token punctuation">&#125;</span> <span class="token operator">=</span> n <span class="token punctuation">&#123;</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Odd number: &#123;&#125;"</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Number</span> <span class="token punctuation">&#123;</span> odd<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> value <span class="token punctuation">&#125;</span> <span class="token operator">=</span> n <span class="token punctuation">&#123;</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Even number: &#123;&#125;"</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// this prints:</span><span class="token comment">// Odd number: 1</span><span class="token comment">// Even number: 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>match 选择支也是模式匹配，类似与 if let</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">print_number</span><span class="token punctuation">(</span>n<span class="token punctuation">:</span> <span class="token class-name">Number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">match</span> n <span class="token punctuation">&#123;</span>        <span class="token class-name">Number</span> <span class="token punctuation">&#123;</span> odd<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> value <span class="token punctuation">&#125;</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Odd number: &#123;&#125;"</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token class-name">Number</span> <span class="token punctuation">&#123;</span> odd<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> value <span class="token punctuation">&#125;</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Even number: &#123;&#125;"</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// this prints the same as before</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>match 必须是详尽的，即必须至少有一个选择支能够匹配上</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">print_number</span><span class="token punctuation">(</span>n<span class="token punctuation">:</span> <span class="token class-name">Number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">match</span> n <span class="token punctuation">&#123;</span>        <span class="token class-name">Number</span> <span class="token punctuation">&#123;</span> value<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">..</span> <span class="token punctuation">&#125;</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"One"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token class-name">Number</span> <span class="token punctuation">&#123;</span> value<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">..</span> <span class="token punctuation">&#125;</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Two"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token class-name">Number</span> <span class="token punctuation">&#123;</span> value<span class="token punctuation">,</span> <span class="token punctuation">..</span> <span class="token punctuation">&#125;</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token comment">// if that last arm didn't exist, we would get a compile-time error</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果很难穷尽所有情形，可以使用下划线 <code>_</code> 匹配剩下的所有情形</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">print_number</span><span class="token punctuation">(</span>n<span class="token punctuation">:</span> <span class="token class-name">Number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">match</span> n<span class="token punctuation">.</span>value <span class="token punctuation">&#123;</span>        <span class="token number">1</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"One"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token number">2</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Two"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        _ <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> n<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>你可以声明你自己的类型的方法</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">Number</span> <span class="token punctuation">&#123;</span>    odd<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>    value<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">impl</span> <span class="token class-name">Number</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">fn</span> <span class="token function-definition function">is_strictly_positive</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">bool</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">self</span><span class="token punctuation">.</span>value <span class="token operator">></span> <span class="token number">0</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后普通地使用</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> minus_two <span class="token operator">=</span> <span class="token class-name">Number</span> <span class="token punctuation">&#123;</span>        odd<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"positive? &#123;&#125;"</span><span class="token punctuation">,</span> minus_two<span class="token punctuation">.</span><span class="token function">is_strictly_positive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// this prints "positive? false"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Variable bindings are immutable by default, which means their interior can’t be mutated:<br> 变量绑定在默认情况下是不可变的，这意味着它们的内部不能变化</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token class-name">Number</span> <span class="token punctuation">&#123;</span>        odd<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        value<span class="token punctuation">:</span> <span class="token number">17</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    n<span class="token punctuation">.</span>odd <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// error: cannot assign to `n.odd`,</span>                   <span class="token comment">// as `n` is not declared to be mutable</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这也意味着该变量不能被再次分配</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token class-name">Number</span> <span class="token punctuation">&#123;</span>        odd<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        value<span class="token punctuation">:</span> <span class="token number">17</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    n <span class="token operator">=</span> <span class="token class-name">Number</span> <span class="token punctuation">&#123;</span>        odd<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        value<span class="token punctuation">:</span> <span class="token number">22</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span> <span class="token comment">// error: cannot assign twice to immutable variable `n`</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>mut</code>  可以使变量绑定为可变的</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> n <span class="token operator">=</span> <span class="token class-name">Number</span> <span class="token punctuation">&#123;</span>        odd<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        value<span class="token punctuation">:</span> <span class="token number">17</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span>    n<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">19</span><span class="token punctuation">;</span> <span class="token comment">// all good</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>Traits</code>  (特型) 是多种类型共有的东西 (类似于其他编程语言的接口)</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">trait</span> <span class="token type-definition class-name">Signed</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">fn</span> <span class="token function-definition function">is_strictly_negative</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">bool</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>“孤儿规则”(orphan rules):<br> 如果要实现某个 trait，那么该 trait 和要实现该 trait 的类型至少有一个要在当前 crate 中定义</p><p>在上面已经定义了<br> <code>trait</code> :Signed<br> <code>struct</code> :Number</p><p>在自定义的的类型中实现自定义的 trait</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">impl</span> <span class="token class-name">Signed</span> <span class="token keyword">for</span> <span class="token class-name">Number</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">fn</span> <span class="token function-definition function">is_strictly_negative</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">bool</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">self</span><span class="token punctuation">.</span>value <span class="token operator">&lt;</span> <span class="token number">0</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token class-name">Number</span> <span class="token punctuation">&#123;</span> odd<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">44</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> n<span class="token punctuation">.</span><span class="token function">is_strictly_negative</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// prints "true"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在其他类型中实现自定义 trait (i32 是一个原始类型):</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">impl</span> <span class="token class-name">Signed</span> <span class="token keyword">for</span> <span class="token keyword">i32</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">fn</span> <span class="token function-definition function">is_strictly_negative</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">bool</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">self</span> <span class="token operator">&lt;</span> <span class="token number">0</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> n<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">44</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> n<span class="token punctuation">.</span><span class="token function">is_strictly_negative</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// prints "true"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在自定义类型中实现其他 trait</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">//  `Neg` trait 用于一元运算符 `-`的重载</span><span class="token keyword">impl</span> <span class="token namespace">std<span class="token punctuation">::</span>ops<span class="token punctuation">::</span></span><span class="token class-name">Neg</span> <span class="token keyword">for</span> <span class="token class-name">Number</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">type</span> <span class="token type-definition class-name">Output</span> <span class="token operator">=</span> <span class="token class-name">Number</span><span class="token punctuation">;</span>    <span class="token keyword">fn</span> <span class="token function-definition function">neg</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Number</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Number</span> <span class="token punctuation">&#123;</span>            value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token keyword">self</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span>            odd<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>odd<span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token class-name">Number</span> <span class="token punctuation">&#123;</span> odd<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token number">987</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> m <span class="token operator">=</span> <span class="token operator">-</span>n<span class="token punctuation">;</span> <span class="token comment">// this is only possible because we implemented `Neg`</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// prints "-987"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>An block is always for a type, so, inside that block, means that type:implSelf<br> 一个代码块用于一个类型，所以在这个代码块的内部意味着这个类型的自我实现</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">impl</span> <span class="token namespace">std<span class="token punctuation">::</span>ops<span class="token punctuation">::</span></span><span class="token class-name">Neg</span> <span class="token keyword">for</span> <span class="token class-name">Number</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">type</span> <span class="token type-definition class-name">Output</span> <span class="token operator">=</span> <span class="token keyword">Self</span><span class="token punctuation">;</span>    <span class="token keyword">fn</span> <span class="token function-definition function">neg</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">Self</span> <span class="token punctuation">&#123;</span>            value<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token keyword">self</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span>            odd<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>odd<span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Some traits are markers - they don’t say that a type implements some methods, they say that certain things can be done with a type.<br> 有些 trait 是 marker (标记)—— 它们不是说类型实现了某些方法，而是说某些事情可以用类型来完成。</p><p>举个例子， <code>i32</code>  实现了 trait  <code>Copy</code>  (i32 可以认为是 Copy 类型)，所以</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> a<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> b <span class="token operator">=</span> a<span class="token punctuation">;</span> <span class="token comment">// `a` 被拷贝</span>    <span class="token keyword">let</span> c <span class="token operator">=</span> a<span class="token punctuation">;</span> <span class="token comment">// `a` 再次被拷贝</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这同样也可以</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">print_i32</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"x = &#123;&#125;"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> a<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>    <span class="token function">print_i32</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// `a` is copied</span>    <span class="token function">print_i32</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// `a` is copied again</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>但结构体 <code>Number</code>  不是 <code>Copy</code> , 所以这样不行:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token class-name">Number</span> <span class="token punctuation">&#123;</span> odd<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token number">51</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> m <span class="token operator">=</span> n<span class="token punctuation">;</span> <span class="token comment">// `n` is moved into `m`</span>    <span class="token keyword">let</span> o <span class="token operator">=</span> n<span class="token punctuation">;</span> <span class="token comment">// error: use of moved value: `n`</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这同样不行:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">print_number</span><span class="token punctuation">(</span>n<span class="token punctuation">:</span> <span class="token class-name">Number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125; number &#123;&#125;"</span><span class="token punctuation">,</span> <span class="token keyword">if</span> n<span class="token punctuation">.</span>odd <span class="token punctuation">&#123;</span> <span class="token string">"odd"</span> <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token string">"even"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> n<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token class-name">Number</span> <span class="token punctuation">&#123;</span> odd<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token number">51</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token function">print_number</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// `n` is moved</span>    <span class="token function">print_number</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// error: use of moved value: `n`</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>但 <code>print_number</code>  使用不可变引用 (immutable reference) 后则可以</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">print_number</span><span class="token punctuation">(</span>n<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125; number &#123;&#125;"</span><span class="token punctuation">,</span> <span class="token keyword">if</span> n<span class="token punctuation">.</span>odd <span class="token punctuation">&#123;</span> <span class="token string">"odd"</span> <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token string">"even"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> n<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token class-name">Number</span> <span class="token punctuation">&#123;</span> odd<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token number">51</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token function">print_number</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// `n` is borrowed for the time of the call</span>    <span class="token function">print_number</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// `n` is borrowed again</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果一个函数接受一个可变的引用，那么它也可以工作 —— 但是只有当我们的变量绑定也是 mut 的时候</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">invert</span><span class="token punctuation">(</span>n<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">Number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    n<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token operator">-</span>n<span class="token punctuation">.</span>value<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">print_number</span><span class="token punctuation">(</span>n<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125; number &#123;&#125;"</span><span class="token punctuation">,</span> <span class="token keyword">if</span> n<span class="token punctuation">.</span>odd <span class="token punctuation">&#123;</span> <span class="token string">"odd"</span> <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token string">"even"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> n<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// this time, `n` is mutable</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> n <span class="token operator">=</span> <span class="token class-name">Number</span> <span class="token punctuation">&#123;</span> odd<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token number">51</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token function">print_number</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">invert</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// `n is borrowed mutably - everything is explicit</span>    <span class="token function">print_number</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Trait methods can also take by reference or mutable reference:self<br>Trait 方法可以通过引用或可变引用接收 <code>self</code> :</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">impl</span> <span class="token namespace">std<span class="token punctuation">::</span>clone<span class="token punctuation">::</span></span><span class="token class-name">Clone</span> <span class="token keyword">for</span> <span class="token class-name">Number</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">fn</span> <span class="token function-definition function">clone</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">Self</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">..</span><span class="token operator">*</span><span class="token keyword">self</span> <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当调用 trait 方法时，接收方是隐式借用的:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token class-name">Number</span> <span class="token punctuation">&#123;</span> odd<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token number">51</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> m <span class="token operator">=</span> n<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    m<span class="token punctuation">.</span>value <span class="token operator">+=</span> <span class="token number">100</span><span class="token punctuation">;</span>        <span class="token function">print_number</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_number</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>注意：这两种写法是等价的</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> m <span class="token operator">=</span> n<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> m <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>clone<span class="token punctuation">::</span></span><span class="token class-name">Clone</span><span class="token punctuation">::</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>Marker traits like have no methods:Copy<br> 像 Copy 这样的 Marker trait 没有方法:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// note: `Copy` requires that `Clone` is implemented too</span><span class="token keyword">impl</span> <span class="token namespace">std<span class="token punctuation">::</span>clone<span class="token punctuation">::</span></span><span class="token class-name">Clone</span> <span class="token keyword">for</span> <span class="token class-name">Number</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">fn</span> <span class="token function-definition function">clone</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">Self</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">..</span><span class="token operator">*</span><span class="token keyword">self</span> <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">impl</span> <span class="token namespace">std<span class="token punctuation">::</span>marker<span class="token punctuation">::</span></span><span class="token class-name">Copy</span> <span class="token keyword">for</span> <span class="token class-name">Number</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>现在 Clone 仍然可用</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token class-name">Number</span> <span class="token punctuation">&#123;</span> odd<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token number">51</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> m <span class="token operator">=</span> n<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> o <span class="token operator">=</span> n<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>但是 Number 的值不再移动 (move)</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token class-name">Number</span> <span class="token punctuation">&#123;</span> odd<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token number">51</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> m <span class="token operator">=</span> n<span class="token punctuation">;</span> <span class="token comment">// `m` is a copy of `n`</span>    <span class="token keyword">let</span> o <span class="token operator">=</span> n<span class="token punctuation">;</span> <span class="token comment">// same. `n` is neither moved nor borrowed.</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>有些 trait 非常常见，它们可以使用 <code>derive</code>  属性自动实现:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token attribute attr-name">#[derive(Clone, Copy)]</span><span class="token keyword">struct</span> <span class="token type-definition class-name">Number</span> <span class="token punctuation">&#123;</span>    odd<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>    value<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token comment">// 扩展了 `impl Clone for Number` 以及 `impl Copy for Number` 的代码块.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>函数可以是泛型的:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">foobar</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">(</span>arg<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// do something with `arg`</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>它们可以有多个类型参数，然后可以在函数的声明和函数体中使用这些参数，而不是具体的类型:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">foobar</span><span class="token operator">&lt;</span><span class="token class-name">L</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token operator">></span><span class="token punctuation">(</span>left<span class="token punctuation">:</span> <span class="token class-name">L</span><span class="token punctuation">,</span> right<span class="token punctuation">:</span> <span class="token class-name">R</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// do something with `left` and `right`</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>类型参数通常也有约束，因此您可以对它们进行一些实际操作。<br>最简单的是通过  <code>trait</code>  来约束</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">print</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Display</span><span class="token operator">></span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"value = &#123;&#125;"</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">print</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Debug</span><span class="token operator">></span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"value = &#123;:?&#125;"</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>Display 和 Debug 都是一种 trait，用于格式化输出</p></blockquote><p>类型参数约束有更长的语法:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">print</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span><span class="token keyword">where</span>    <span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Display</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"value = &#123;&#125;"</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>约束可能更复杂：可能需要一个类型参数来实现多个 trait:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span></span><span class="token class-name">Debug</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">compare</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">(</span>left<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span> right<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span><span class="token keyword">where</span>    <span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Debug</span> <span class="token operator">+</span> <span class="token class-name">PartialEq</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:?&#125; &#123;&#125; &#123;:?&#125;"</span><span class="token punctuation">,</span> left<span class="token punctuation">,</span> <span class="token keyword">if</span> left <span class="token operator">==</span> right <span class="token punctuation">&#123;</span> <span class="token string">"=="</span> <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token string">"!="</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">compare</span><span class="token punctuation">(</span><span class="token string">"tea"</span><span class="token punctuation">,</span> <span class="token string">"coffee"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// prints: "tea" != "coffee"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Generic functions can be thought of as namespaces, containing an infinity of functions with different concrete types.<br> 泛型函数可以被看作是命名空间，包含无数具有不同具体类型的函数</p><p>Same as with crates, and modules, and types, generic functions can be “explored” (navigated?) using ::<br> 与 crate、module 和 type 一样，泛型函数也可以使用双冒号 <code>::</code>  进行访问</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>any<span class="token punctuation">::</span></span>type_name<span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token function">type_name</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// prints "i32"</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token function">type_name</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword">f64</span><span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// prints "(f64, char)"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>This is lovingly called turbofish syntax, because looks like a fish.::&lt;&gt;<br> 这被亲切地称为 turbofish (涡轮鱼？) 语法，因为 <code>::&lt;&gt;</code>  看起来像一条鱼。</p><p>结构体也可以是泛型的:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">Pair</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    a<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span>    b<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">print_type_name</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">(</span>_val<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token namespace">std<span class="token punctuation">::</span>any<span class="token punctuation">::</span></span><span class="token function">type_name</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token class-name">Pair</span> <span class="token punctuation">&#123;</span> a<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token number">9</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> p2 <span class="token operator">=</span> <span class="token class-name">Pair</span> <span class="token punctuation">&#123;</span> a<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token function">print_type_name</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// prints "Pair&lt;i32>"</span>    <span class="token function">print_type_name</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// prints "Pair&lt;bool>"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>标准库类型 Vec (分配在堆上的数组) 是泛型的的<br> The standard library type (~ a heap-allocated array), is generic:Vec</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> v1 <span class="token operator">=</span> <span class="token class-name">Vec</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    v1<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> v2 <span class="token operator">=</span> <span class="token class-name">Vec</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    v2<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_type_name</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>v1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// prints "Vec&lt;i32>"</span>    <span class="token function">print_type_name</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>v2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// prints "Vec&lt;bool>"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Speaking of , it comes with a macro that gives more or less “vec literals”:Vec<br> 说到 Vec，它或多或少都会用到宏来提供 “vec 字面值”:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> v1 <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> v2 <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">print_type_name</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>v1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// prints "Vec&lt;i32>"</span>    <span class="token function">print_type_name</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>v2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// prints "Vec&lt;bool>"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>All of , or invoke a macro. Macros just expand to regular <a href="http://code.name">code.name</a>!()name![]name!{}<br> <code>name!()</code>  ， <code>name![]</code>  或 <code>name!&#123;&#125;</code>  都调用了宏。宏只是扩展为常规代码</p><p>其实 <code>println</code>  就是一个宏</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token string">"Hello there!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>这段代码会扩展为以下等效的代码:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token keyword">self</span><span class="token punctuation">,</span> <span class="token class-name">Write</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token namespace">io<span class="token punctuation">::</span></span><span class="token function">stdout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write_all</span><span class="token punctuation">(</span><span class="token string">b"Hello there!\n"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><code>panic</code>  (恐慌 / 异常) 也是一个宏。它通过一条错误消息和错误的文件名 / 行号 (如果启用的话) 强制停止执行:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token macro property">panic!</span><span class="token punctuation">(</span><span class="token string">"This panics"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// output: thread 'main' panicked at 'This panics', src/main.rs:3:5</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>Some methods also panic. For example, the type can contain something, or it can contain nothing. If is called on it, and it contains nothing, it panics:Option.unwrap()<br> 有些方法也会引起 <code>panic</code> 。例如，Option 类型可以包含某些内容，也可以不包含。如果。在它上面调用  <code>.unpack()</code>  但不包含任何东西的话，就会发生 <code>panic</code> :</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> o1<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    o1<span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// this is fine</span>    <span class="token keyword">let</span> o2<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token class-name">None</span><span class="token punctuation">;</span>    o2<span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// this panics!</span><span class="token punctuation">&#125;</span><span class="token comment">// output: thread 'main' panicked at 'called `Option::unwrap()` on a `None` value', src/libcore/option.rs:378:21</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>Option</code>  不是一个结构体 - 而是一个 enum (枚举类)，它有两种变体 (variant)</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">enum</span> <span class="token type-definition class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token class-name">None</span><span class="token punctuation">,</span>    <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">fn</span> <span class="token function-definition function">unwrap</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">T</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// enums variants 可以用于模式匹配:</span>        <span class="token keyword">match</span> <span class="token keyword">self</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Some</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=></span> t<span class="token punctuation">,</span>            <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">None</span> <span class="token operator">=></span> <span class="token macro property">panic!</span><span class="token punctuation">(</span><span class="token string">".unwrap() called on a None option"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">use</span> <span class="token keyword">self</span><span class="token punctuation">::</span><span class="token class-name">Option</span><span class="token punctuation">::</span><span class="token punctuation">&#123;</span><span class="token class-name">None</span><span class="token punctuation">,</span> <span class="token class-name">Some</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> o1<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    o1<span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// this is fine</span>    <span class="token keyword">let</span> o2<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token class-name">None</span><span class="token punctuation">;</span>    o2<span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// this panics!</span><span class="token punctuation">&#125;</span><span class="token comment">// output: thread 'main' panicked at '.unwrap() called on a None option', src/main.rs:11:27</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>Result</code>  也是一个 enum, 包含一个内容和一个错误</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">enum</span> <span class="token type-definition class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">E</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">E</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>It also panics when unwrapped and containing an error.<br> 当被解析出一个错误 (error) 时，它也会 panic</p><p>变量绑定具有生命周期 (lifetime):</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// `x` doesn't exist yet</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span> <span class="token comment">// `x` starts existing</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"x = &#123;&#125;"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// `x` stops existing</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// `x` no longer exists</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>引用同样也有生命周期</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// `x` doesn't exist yet</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span> <span class="token comment">// `x` starts existing</span>        <span class="token keyword">let</span> x_ref <span class="token operator">=</span> <span class="token operator">&amp;</span>x<span class="token punctuation">;</span> <span class="token comment">// `x_ref` starts existing - it borrows `x`</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"x_ref = &#123;&#125;"</span><span class="token punctuation">,</span> x_ref<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// `x_ref` stops existing</span>        <span class="token comment">// `x` stops existing</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// `x` no longer exists</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>引用的生命周期不能超过其借用的变量绑定的生命周期期:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> x_ref <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>        <span class="token operator">&amp;</span>x    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"x_ref = &#123;&#125;"</span><span class="token punctuation">,</span> x_ref<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// error: `x` does not live long enough</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>A variable binding can be immutably borrowed multiple times:<br> 可以多次不可变地借用变量绑定:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> x_ref1 <span class="token operator">=</span> <span class="token operator">&amp;</span>x<span class="token punctuation">;</span>    <span class="token keyword">let</span> x_ref2 <span class="token operator">=</span> <span class="token operator">&amp;</span>x<span class="token punctuation">;</span>    <span class="token keyword">let</span> x_ref3 <span class="token operator">=</span> <span class="token operator">&amp;</span>x<span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125; &#123;&#125; &#123;&#125;"</span><span class="token punctuation">,</span> x_ref1<span class="token punctuation">,</span> x_ref2<span class="token punctuation">,</span> x_ref3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>借用时，变量绑定不能发生变化</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> x <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> x_ref <span class="token operator">=</span> <span class="token operator">&amp;</span>x<span class="token punctuation">;</span>    x <span class="token operator">=</span> <span class="token number">13</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"x_ref = &#123;&#125;"</span><span class="token punctuation">,</span> x_ref<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// error: cannot assign to `x` because it is borrowed</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>不可变借用时，变量不能再被可变借用</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> x <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> x_ref1 <span class="token operator">=</span> <span class="token operator">&amp;</span>x<span class="token punctuation">;</span>    <span class="token keyword">let</span> x_ref2 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> x<span class="token punctuation">;</span>    <span class="token comment">// error: cannot borrow `x` as mutable because it is also borrowed as immutable</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"x_ref1 = &#123;&#125;"</span><span class="token punctuation">,</span> x_ref1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>在任意给定时间，要么只能有一个可变引用，要么只能有多个不可变引用。</li><li>引用必须总是有效的。</li></ul><p>函数参数中的引用也有生命周期:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">print</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// `x` is borrowed (from the outside) for the</span>    <span class="token comment">// entire time this function is called.</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>具有引用参数的函数可以通过具有不同生命周期的借用来调用，因此:</p><ul><li>所有接受引用参数的函数都是泛型的</li><li>生命周期是一个泛型的参数</li></ul><p>生命周期的名称以单引号 <code>'</code>  开头</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// elided (non-named) lifetimes:</span><span class="token keyword">fn</span> <span class="token function-definition function">print</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">// named lifetimes:</span><span class="token keyword">fn</span> <span class="token function-definition function">print</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">></span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>This allows returning references whose lifetime depend on the lifetime of the arguments:<br> 谁的生命周期依赖于参数的生命周期，就返回谁的引用</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">Number</span> <span class="token punctuation">&#123;</span>    value<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">number_value</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">></span><span class="token punctuation">(</span>num<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token class-name">Number</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token keyword">i32</span> <span class="token punctuation">&#123;</span>    <span class="token operator">&amp;</span>num<span class="token punctuation">.</span>value<span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token class-name">Number</span> <span class="token punctuation">&#123;</span> value<span class="token punctuation">:</span> <span class="token number">47</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token function">number_value</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// `v` borrows `n` (immutably), thus: `v` cannot outlive `n`.</span>    <span class="token comment">// While `v` exists, `n` cannot be mutably borrowed, mutated, moved, etc.</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当输入只有一个生命周期时，不需要命名，并且所有东西都有相同的生命周期，因此下面的两个函数是等价的</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">number_value</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">></span><span class="token punctuation">(</span>num<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token class-name">Number</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token keyword">i32</span> <span class="token punctuation">&#123;</span>    <span class="token operator">&amp;</span>num<span class="token punctuation">.</span>value<span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">number_value</span><span class="token punctuation">(</span>num<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Number</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token keyword">i32</span> <span class="token punctuation">&#123;</span>    <span class="token operator">&amp;</span>num<span class="token punctuation">.</span>value<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Structs can also be generic over lifetimes, which allows them to hold references:<br> 结构体可以在生命周期里都是泛型的，这使其可以接受引用</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">NumRef</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token keyword">i32</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> x<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token number">99</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> x_ref <span class="token operator">=</span> <span class="token class-name">NumRef</span> <span class="token punctuation">&#123;</span> x<span class="token punctuation">:</span> <span class="token operator">&amp;</span>x <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token comment">// `x_ref` cannot outlive `x`, etc.</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>同样的代码，额外添加了函数</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">NumRef</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token keyword">i32</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">as_num_ref</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">></span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">NumRef</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token class-name">NumRef</span> <span class="token punctuation">&#123;</span> x<span class="token punctuation">:</span> <span class="token operator">&amp;</span>x <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> x<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token number">99</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> x_ref <span class="token operator">=</span> <span class="token function">as_num_ref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// `x_ref` cannot outlive `x`, etc.</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>The same code, but with “elided” lifetimes:<br> 同样的代码，省略了声明周期</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">NumRef</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token keyword">i32</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">as_num_ref</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">NumRef</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'_</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token class-name">NumRef</span> <span class="token punctuation">&#123;</span> x<span class="token punctuation">:</span> <span class="token operator">&amp;</span>x <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> x<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token number">99</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> x_ref <span class="token operator">=</span> <span class="token function">as_num_ref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// `x_ref` cannot outlive `x`, etc.</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>impl</code>  代码块在生命周期里也是泛型的:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">></span> <span class="token class-name">NumRef</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">fn</span> <span class="token function-definition function">as_i32_ref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token keyword">i32</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">self</span><span class="token punctuation">.</span>x    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> x<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token number">99</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> x_num_ref <span class="token operator">=</span> <span class="token class-name">NumRef</span> <span class="token punctuation">&#123;</span> x<span class="token punctuation">:</span> <span class="token operator">&amp;</span>x <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> x_i32_ref <span class="token operator">=</span> x_num_ref<span class="token punctuation">.</span><span class="token function">as_i32_ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// neither ref can outlive `x`</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>但你也可以省略</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">></span> <span class="token class-name">NumRef</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">fn</span> <span class="token function-definition function">as_i32_ref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token keyword">i32</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">self</span><span class="token punctuation">.</span>x    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果不需要这个生命周期的名字，你可以狠狠地省略:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">impl</span> <span class="token class-name">NumRef</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'_</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">fn</span> <span class="token function-definition function">as_i32_ref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token keyword">i32</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">self</span><span class="token punctuation">.</span>x    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>有一个特殊的生命周期: <code>static</code> ，它对整个程序的生命周期都有效。(类比其他语言里的静态全局变量)</p><p>String 是 <code>'static</code>  (静态全局) 的</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">Person</span> <span class="token punctuation">&#123;</span>    name<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'static</span> <span class="token keyword">str</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>        name<span class="token punctuation">:</span> <span class="token string">"fasterthanlime"</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>但是 string 的所有者不是 <code>static</code>  的:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">Person</span> <span class="token punctuation">&#123;</span>    name<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'static</span> <span class="token keyword">str</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"fasterthan&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token string">"lime"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span> name<span class="token punctuation">:</span> <span class="token operator">&amp;</span>name <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token comment">// error: `name` does not live long enough</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在最后一个示例中，变量 <code>name</code>  不是  <code>&amp;'static str</code> ，而是  <code>String</code> 。它是动态分配的，会被释放。它的生命周期小于整个程序 (即使它在 main 中)。</p><p>To store a non- string in , it needs to either:'staticPerson<br> 要想在结构体 <code>Person</code>  中存储非 <code>'static</code>  的 string，需要满足<br> A) 在生命周期里是泛型:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">Person</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    name<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token keyword">str</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"fasterthan&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token string">"lime"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span> name<span class="token punctuation">:</span> <span class="token operator">&amp;</span>name <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token comment">// `p` cannot outlive `name`</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>或者<br> B) 获得 string 的所有权</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">Person</span> <span class="token punctuation">&#123;</span>    name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"fasterthan&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token string">"lime"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span> name<span class="token punctuation">:</span> name <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token comment">// `name` was moved into `p`, their lifetimes are no longer tied.</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在结构体中，当字段与变量绑定同名时</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span> name<span class="token punctuation">:</span> name <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>可以简写成:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span> name <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Rust 中的许多类型，有 <code>所有者</code>  (owned) 的和 <code>非所有者</code>  (nom-owned) 的变体:</p><blockquote><p>引用可以在没有所有权的情况下使用被绑定的变量</p></blockquote><ul><li>Strings: String 是所有者，&amp;str 是引用 (reference)</li><li>Paths: PathBuf 是所有者，&amp;Path 是引用</li><li>Collections:  <code>Vec&lt;T&gt;</code>  所有者， <code>&amp;[T]</code>  是引用</li></ul><p>Rust 有切片 (slice)- 切片是对多个连续元素的引用<br>可以借用 vector 的切片，例如</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> v2 <span class="token operator">=</span> <span class="token operator">&amp;</span>v<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">..</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"v2 = &#123;:?&#125;"</span><span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// output:</span><span class="token comment">// v2 = [3, 4]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这不足为奇。利用 <code>Index</code>  和 <code>IndexMut</code>  的 <code>trait</code>  就可以重载索引运算 ( <code>foo[index]</code> )。</p><p>(两个点) <code>..</code>  语法只是表示范围 (range),range 只是在标准库里定义的少数结构体</p><p>范围是开放式的，一般是左闭右开区间，如果最右端使用等号 <code>=</code> ，右端就是闭区间</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 0 or greater</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:?&#125;"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>    <span class="token comment">// strictly less than 20</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:?&#125;"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">..</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>    <span class="token comment">// 20 or less than 20</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:?&#125;"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">..=</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>    <span class="token comment">// only 3, 4, 5</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:?&#125;"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">..</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>借用规则也适用于切片</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">tail</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>  <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token function">tail</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"y = &#123;:?&#125;"</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>等价于</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">tail</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">></span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>  <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>这是合法的</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token function">tail</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"y = &#123;:?&#125;"</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>但这因为 <code>[1,2,3,4,5]</code>  是一个静态数组</p><p>而这是不合法的:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token function">tail</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>v<span class="token punctuation">)</span>        <span class="token comment">// error: `v` does not live long enough</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"y = &#123;:?&#125;"</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>因为 vector 是分配在堆上的，没有 <code>'static</code>  的生命周期</p><p>&amp;str 实际上是切片:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">file_ext</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token comment">// this does not create a new string - it returns</span>    <span class="token comment">// a slice of the argument.</span>    name<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">"Read me. Or don't.txt"</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>ext<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">file_ext</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"file extension: &#123;&#125;"</span><span class="token punctuation">,</span> ext<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"no file extension"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>所以借用规则也适用于此:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> ext <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Read me. Or don't.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">file_ext</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap_or</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>        <span class="token comment">// error: `name` does not live long enough</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"extension: &#123;:?&#125;"</span><span class="token punctuation">,</span> ext<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>函数可以失败并特别地返回一个 <code>Result</code></p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token keyword">str</span><span class="token punctuation">::</span><span class="token function">from_utf8</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">240</span><span class="token punctuation">,</span> <span class="token number">159</span><span class="token punctuation">,</span> <span class="token number">141</span><span class="token punctuation">,</span> <span class="token number">137</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:?&#125;"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// prints: Ok("🍉")</span>    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token keyword">str</span><span class="token punctuation">::</span><span class="token function">from_utf8</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">195</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:?&#125;"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// prints: Err(Utf8Error &#123; valid_up_to: 0, error_len: Some(1) &#125;)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果你想在失败的情况下 <code>panic</code> , 可以使用 <code>.unwrap()</code></p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token keyword">str</span><span class="token punctuation">::</span><span class="token function">from_utf8</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">240</span><span class="token punctuation">,</span> <span class="token number">159</span><span class="token punctuation">,</span> <span class="token number">141</span><span class="token punctuation">,</span> <span class="token number">137</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:?&#125;"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// prints: "🍉"</span>    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token keyword">str</span><span class="token punctuation">::</span><span class="token function">from_utf8</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">195</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// prints: thread 'main' panicked at 'called `Result::unwrap()`</span>    <span class="token comment">// on an `Err` value: Utf8Error &#123; valid_up_to: 0, error_len: Some(1) &#125;',</span>    <span class="token comment">// src/libcore/result.rs:1165:5</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>或者用 .expect (), 可以自定义信息</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token keyword">str</span><span class="token punctuation">::</span><span class="token function">from_utf8</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">195</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"valid utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// prints: thread 'main' panicked at 'valid utf-8: Utf8Error</span>    <span class="token comment">// &#123; valid_up_to: 0, error_len: Some(1) &#125;', src/libcore/result.rs:1165:5</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>或者使用模式匹配 <code>match</code></p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">match</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token keyword">str</span><span class="token punctuation">::</span><span class="token function">from_utf8</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">240</span><span class="token punctuation">,</span> <span class="token number">159</span><span class="token punctuation">,</span> <span class="token number">141</span><span class="token punctuation">,</span> <span class="token number">137</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Ok</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">panic!</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// prints 🍉</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>或者使用: <code>if let</code></p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token keyword">str</span><span class="token punctuation">::</span><span class="token function">from_utf8</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">240</span><span class="token punctuation">,</span> <span class="token number">159</span><span class="token punctuation">,</span> <span class="token number">141</span><span class="token punctuation">,</span> <span class="token number">137</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// prints 🍉</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>或者将错误上报:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token keyword">str</span><span class="token punctuation">::</span><span class="token class-name">Utf8Error</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">match</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token keyword">str</span><span class="token punctuation">::</span><span class="token function">from_utf8</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">240</span><span class="token punctuation">,</span> <span class="token number">159</span><span class="token punctuation">,</span> <span class="token number">141</span><span class="token punctuation">,</span> <span class="token number">137</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Ok</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>或者使用  <code>?</code>  简单处理</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token keyword">str</span><span class="token punctuation">::</span><span class="token class-name">Utf8Error</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token keyword">str</span><span class="token punctuation">::</span><span class="token function">from_utf8</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">240</span><span class="token punctuation">,</span> <span class="token number">159</span><span class="token punctuation">,</span> <span class="token number">141</span><span class="token punctuation">,</span> <span class="token number">137</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>操作符  <code>*</code>  可以用于解引用，但是您不需要这样来访问字段或调用方法:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">Point</span> <span class="token punctuation">&#123;</span>    x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span>    y<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span> x<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">3.0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> p_ref <span class="token operator">=</span> <span class="token operator">&amp;</span>p<span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"(&#123;&#125;, &#123;&#125;)"</span><span class="token punctuation">,</span> p_ref<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p_ref<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// prints `(1, 3)`</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果类型为 Copy 时只需要这样:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">Point</span> <span class="token punctuation">&#123;</span>    x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span>    y<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">negate</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token class-name">Point</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span>        x<span class="token punctuation">:</span> <span class="token operator">-</span>p<span class="token punctuation">.</span>x<span class="token punctuation">,</span>        y<span class="token punctuation">:</span> <span class="token operator">-</span>p<span class="token punctuation">.</span>y<span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span> x<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">3.0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> p_ref <span class="token operator">=</span> <span class="token operator">&amp;</span>p<span class="token punctuation">;</span>    <span class="token function">negate</span><span class="token punctuation">(</span><span class="token operator">*</span>p_ref<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// error: cannot move out of `*p_ref` which is behind a shared reference</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// now `Point` is `Copy`</span><span class="token attribute attr-name">#[derive(Clone, Copy)]</span><span class="token keyword">struct</span> <span class="token type-definition class-name">Point</span> <span class="token punctuation">&#123;</span>    x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span>    y<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">negate</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token class-name">Point</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span>        x<span class="token punctuation">:</span> <span class="token operator">-</span>p<span class="token punctuation">.</span>x<span class="token punctuation">,</span>        y<span class="token punctuation">:</span> <span class="token operator">-</span>p<span class="token punctuation">.</span>y<span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span> x<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">3.0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> p_ref <span class="token operator">=</span> <span class="token operator">&amp;</span>p<span class="token punctuation">;</span>    <span class="token function">negate</span><span class="token punctuation">(</span><span class="token operator">*</span>p_ref<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ...and now this works</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>Closure</code>  (闭包) 只是  <code>Fn</code> 、  <code>FnMut</code>  或  <code>FnOnce</code>  类型的函数，具有一定的 <code>context</code>  (语境 / 运行环境 / 上下文)</p><p>Their parameters are a comma-separated list of names within a pair of pipes (). They don’t need curly braces, unless you want to have multiple statements.|<br>Closure 的参数是一对管道 (|) 中以逗号分隔的名称列表。不需要花括号，除非您想要有多个语句。</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">for_each_planet</span><span class="token operator">&lt;</span><span class="token class-name">F</span><span class="token operator">></span><span class="token punctuation">(</span>f<span class="token punctuation">:</span> <span class="token class-name">F</span><span class="token punctuation">)</span>    <span class="token keyword">where</span> <span class="token class-name">F</span><span class="token punctuation">:</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'static</span> <span class="token keyword">str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">f</span><span class="token punctuation">(</span><span class="token string">"Earth"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">f</span><span class="token punctuation">(</span><span class="token string">"Mars"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">f</span><span class="token punctuation">(</span><span class="token string">"Jupiter"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">for_each_planet</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>planet<span class="token closure-punctuation punctuation">|</span></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Hello, &#123;&#125;"</span><span class="token punctuation">,</span> planet<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// prints:</span><span class="token comment">// Hello, Earth</span><span class="token comment">// Hello, Mars</span><span class="token comment">// Hello, Jupiter</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>借用规则也适用与此</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">for_each_planet</span><span class="token operator">&lt;</span><span class="token class-name">F</span><span class="token operator">></span><span class="token punctuation">(</span>f<span class="token punctuation">:</span> <span class="token class-name">F</span><span class="token punctuation">)</span>    <span class="token keyword">where</span> <span class="token class-name">F</span><span class="token punctuation">:</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'static</span> <span class="token keyword">str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">f</span><span class="token punctuation">(</span><span class="token string">"Earth"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">f</span><span class="token punctuation">(</span><span class="token string">"Mars"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">f</span><span class="token punctuation">(</span><span class="token string">"Jupiter"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> greeting <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Good to see you"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">for_each_planet</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>planet<span class="token closure-punctuation punctuation">|</span></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;, &#123;&#125;"</span><span class="token punctuation">,</span> greeting<span class="token punctuation">,</span> planet<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// our closure borrows `greeting`, so it cannot outlive it</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这个例子不能运行:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">for_each_planet</span><span class="token operator">&lt;</span><span class="token class-name">F</span><span class="token operator">></span><span class="token punctuation">(</span>f<span class="token punctuation">:</span> <span class="token class-name">F</span><span class="token punctuation">)</span>    <span class="token keyword">where</span> <span class="token class-name">F</span><span class="token punctuation">:</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'static</span> <span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">'static</span> <span class="token comment">// `F` must now have "'static" lifetime</span><span class="token punctuation">&#123;</span>    <span class="token function">f</span><span class="token punctuation">(</span><span class="token string">"Earth"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">f</span><span class="token punctuation">(</span><span class="token string">"Mars"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">f</span><span class="token punctuation">(</span><span class="token string">"Jupiter"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> greeting <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Good to see you"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">for_each_planet</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>planet<span class="token closure-punctuation punctuation">|</span></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;, &#123;&#125;"</span><span class="token punctuation">,</span> greeting<span class="token punctuation">,</span> planet<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// error: closure may outlive the current function, but it borrows</span>    <span class="token comment">// `greeting`, which is owned by the current function</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>但这个可以:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> greeting <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"You're doing great"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">for_each_planet</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>planet<span class="token closure-punctuation punctuation">|</span></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;, &#123;&#125;"</span><span class="token punctuation">,</span> greeting<span class="token punctuation">,</span> planet<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// `greeting` is no longer borrowed, it is *moved* into</span>    <span class="token comment">// the closure.</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>An needs to be mutably borrowed to be called, so it can only be called once at a time.FnMut<br> <code>FnMut</code>  需要可变地借用才能被调用，因此一次只能调用一次</p><p>这是合法的:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">foobar</span><span class="token operator">&lt;</span><span class="token class-name">F</span><span class="token operator">></span><span class="token punctuation">(</span>f<span class="token punctuation">:</span> <span class="token class-name">F</span><span class="token punctuation">)</span>    <span class="token keyword">where</span> <span class="token class-name">F</span><span class="token punctuation">:</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">i32</span><span class="token punctuation">&#123;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">foobar</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>x<span class="token closure-punctuation punctuation">|</span></span> x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// output: 8</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>而这不合法:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">foobar</span><span class="token operator">&lt;</span><span class="token class-name">F</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">mut</span> f<span class="token punctuation">:</span> <span class="token class-name">F</span><span class="token punctuation">)</span>    <span class="token keyword">where</span> <span class="token class-name">F</span><span class="token punctuation">:</span> <span class="token class-name">FnMut</span><span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">i32</span><span class="token punctuation">&#123;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// error: cannot borrow `f` as mutable more than once at a time</span><span class="token punctuation">&#125;</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">foobar</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>x<span class="token closure-punctuation punctuation">|</span></span> x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这也是合法的:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">foobar</span><span class="token operator">&lt;</span><span class="token class-name">F</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">mut</span> f<span class="token punctuation">:</span> <span class="token class-name">F</span><span class="token punctuation">)</span>    <span class="token keyword">where</span> <span class="token class-name">F</span><span class="token punctuation">:</span> <span class="token class-name">FnMut</span><span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">i32</span><span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> tmp <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token function">f</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">foobar</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>x<span class="token closure-punctuation punctuation">|</span></span> x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// output: 8</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>FnMut</code>  之所以存在，是因为一些闭包可变地借用本地变量</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">foobar</span><span class="token operator">&lt;</span><span class="token class-name">F</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">mut</span> f<span class="token punctuation">:</span> <span class="token class-name">F</span><span class="token punctuation">)</span>    <span class="token keyword">where</span> <span class="token class-name">F</span><span class="token punctuation">:</span> <span class="token class-name">FnMut</span><span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">i32</span><span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> tmp <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token function">f</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> acc <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token function">foobar</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>x<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">&#123;</span>        acc <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>        x <span class="token operator">*</span> acc    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// output: 24</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这些闭包不能被传递给期望的 Fn 函数:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">foobar</span><span class="token operator">&lt;</span><span class="token class-name">F</span><span class="token operator">></span><span class="token punctuation">(</span>f<span class="token punctuation">:</span> <span class="token class-name">F</span><span class="token punctuation">)</span>    <span class="token keyword">where</span> <span class="token class-name">F</span><span class="token punctuation">:</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">i32</span><span class="token punctuation">&#123;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> acc <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token function">foobar</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>x<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">&#123;</span>        acc <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token comment">// error: cannot assign to `acc`, as it is a</span>        <span class="token comment">// captured variable in a `Fn` closure.</span>        <span class="token comment">// the compiler suggests "changing foobar</span>        <span class="token comment">// to accept closures that implement `FnMut`"</span>        x <span class="token operator">*</span> acc    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>FnOnce 闭包只能调用一次。它们之所以存在，是因为某些闭包移出了在捕获时被移动的变量</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">foobar</span><span class="token operator">&lt;</span><span class="token class-name">F</span><span class="token operator">></span><span class="token punctuation">(</span>f<span class="token punctuation">:</span> <span class="token class-name">F</span><span class="token punctuation">)</span>    <span class="token keyword">where</span> <span class="token class-name">F</span><span class="token punctuation">:</span> <span class="token class-name">FnOnce</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span><span class="token punctuation">&#123;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"alright"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">foobar</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// `s` was moved into our closure, and our</span>    <span class="token comment">// closures moves it to the caller by returning</span>    <span class="token comment">// it. Remember that `String` is not `Copy`.</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这是自然执行的，因为需要移动 FnOnce 闭包才能被调用。</p><p>所以这个例子是不合法的:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">foobar</span><span class="token operator">&lt;</span><span class="token class-name">F</span><span class="token operator">></span><span class="token punctuation">(</span>f<span class="token punctuation">:</span> <span class="token class-name">F</span><span class="token punctuation">)</span>    <span class="token keyword">where</span> <span class="token class-name">F</span><span class="token punctuation">:</span> <span class="token class-name">FnOnce</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span><span class="token punctuation">&#123;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// error: use of moved value: `f`</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>而且，如果你需要说服我们的关闭确实移动 s，这也是非法的</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"alright"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">foobar</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">foobar</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// use of moved value: `s`</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>但这个是对的:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"alright"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">foobar</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> s<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">foobar</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> s<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>带有两个参数的闭包:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">foobar</span><span class="token operator">&lt;</span><span class="token class-name">F</span><span class="token operator">></span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> is_greater<span class="token punctuation">:</span> <span class="token class-name">F</span><span class="token punctuation">)</span>    <span class="token keyword">where</span> <span class="token class-name">F</span><span class="token punctuation">:</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">bool</span><span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token punctuation">(</span>greater<span class="token punctuation">,</span> smaller<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">if</span> <span class="token function">is_greater</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token punctuation">(</span>y<span class="token punctuation">,</span> x<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125; is greater than &#123;&#125;"</span><span class="token punctuation">,</span> greater<span class="token punctuation">,</span> smaller<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">foobar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>x<span class="token punctuation">,</span> y<span class="token closure-punctuation punctuation">|</span></span> x <span class="token operator">></span> y<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>省略所有参数的闭包:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">foobar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>_<span class="token punctuation">,</span> _<span class="token closure-punctuation punctuation">|</span></span> <span class="token macro property">panic!</span><span class="token punctuation">(</span><span class="token string">"Comparing is futile!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>Here’s a slightly worrying closure:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">countdown</span><span class="token operator">&lt;</span><span class="token class-name">F</span><span class="token operator">></span><span class="token punctuation">(</span>count<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">,</span> tick<span class="token punctuation">:</span> <span class="token class-name">F</span><span class="token punctuation">)</span>    <span class="token keyword">where</span> <span class="token class-name">F</span><span class="token punctuation">:</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token keyword">usize</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">..=</span>count<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rev</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">tick</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">countdown</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>i<span class="token closure-punctuation punctuation">|</span></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"tick &#123;&#125;..."</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// output:</span><span class="token comment">// tick 3...</span><span class="token comment">// tick 2...</span><span class="token comment">// tick 1...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>And here’s a toilet closure:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">countdown</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>_<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>这样叫是因为 <code>|_| ()</code>  看起来像厕所</p><p>任何可迭代的内容都可以在  <code>for in</code>  循环中使用。</p><p>We’ve just seen a range being used, but it also works with a :Vec<br> 我们之前看了 range 的使用，也可以用于 Vec</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"I like the number &#123;&#125;"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>或用于切片:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"I like the number &#123;&#125;"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// output:</span><span class="token comment">// I like the number 52</span><span class="token comment">// I like the number 49</span><span class="token comment">// I like the number 21</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>或一个实际的迭代器 (actual iterator)</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// note: `&amp;str` also has a `.bytes()` iterator.</span>    <span class="token comment">// Rust's `char` type is a "Unicode scalar value"</span>    <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token string">"rust"</span><span class="token punctuation">.</span><span class="token function">chars</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Give me a &#123;&#125;"</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// output:</span><span class="token comment">// Give me a r</span><span class="token comment">// Give me a u</span><span class="token comment">// Give me a s</span><span class="token comment">// Give me a t</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>即使迭代项被过滤、映射和扁平化</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token string">"SuRPRISE INbOUND"</span>        <span class="token punctuation">.</span><span class="token function">chars</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>c<span class="token closure-punctuation punctuation">|</span></span> c<span class="token punctuation">.</span><span class="token function">is_lowercase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">flat_map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>c<span class="token closure-punctuation punctuation">|</span></span> c<span class="token punctuation">.</span><span class="token function">to_uppercase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token macro property">print!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// output: UB</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>你可以从函数返回一个闭包</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">make_tester</span><span class="token punctuation">(</span>answer<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">impl</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">bool</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>challenge<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">&#123;</span>        challenge <span class="token operator">==</span> answer    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// you can use `.into()` to perform conversions</span>    <span class="token comment">// between various types, here `&amp;'static str` and `String`</span>    <span class="token keyword">let</span> test <span class="token operator">=</span> <span class="token function">make_tester</span><span class="token punctuation">(</span><span class="token string">"hunter2"</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"******"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"hunter2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>你甚至可以将一个对函数参数的引用移动到它返回的闭包中:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">make_tester</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">></span><span class="token punctuation">(</span>answer<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">impl</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">bool</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">'a</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>challenge<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">&#123;</span>        challenge <span class="token operator">==</span> answer    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> test <span class="token operator">=</span> <span class="token function">make_tester</span><span class="token punctuation">(</span><span class="token string">"hunter2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"*******"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"hunter2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// output:</span><span class="token comment">// false</span><span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>或者略掉生命周期</p><figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">make_tester</span><span class="token punctuation">(</span>answer<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">impl</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">bool</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">'_</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>challenge<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        challenge <span class="token operator">==</span> answer</pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> rust </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rust模块系统</title>
      <link href="/2023/04/09/rust%E6%A8%A1%E5%9D%97%E7%B3%BB%E7%BB%9F/"/>
      <url>/2023/04/09/rust%E6%A8%A1%E5%9D%97%E7%B3%BB%E7%BB%9F/</url>
      
        <content type="html"><![CDATA[<p>参考文章:<br><a href="https://www.sheshbabu.com/posts/rust-module-system/">https://www.sheshbabu.com/posts/rust-module-system/</a></p><p>另外，rust 虽然可能不错，但 rust 的基金会经常会搞出一些骚操作，让我犹豫要不要继续学</p><p><a href="https://www.zhihu.com/question/594913275">https://www.zhihu.com/question/594913275</a></p><p><a href="https://rustcc.cn/article?id=37017d56-bf8d-4395-9359-3f996a81f7f7">https://rustcc.cn/article?id=37017d56-bf8d-4395-9359-3f996a81f7f7</a></p><p><a href="https://rustcc.cn/article?id=2db1b8b9-fe59-4069-97bd-0c4343860ffc">https://rustcc.cn/article?id=2db1b8b9-fe59-4069-97bd-0c4343860ffc</a></p><hr><p>使用 cargo 创建新项目 rust_demo, 在 rust_demo/src 下建立如下项目结构</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">│  config.rs│  main.rs│├─models│       mod.rs│       user_model.rs│      └─routes        mod.rs        health_route.rs        user_route.rs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>对于该项目结构，模块系统如下</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">crate│  ├─config│├─models  │   ││   └─ user_model│└─routes    │    ├─ health_route    │    └─ user_route<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>接下来会循序渐进地讲解</p><h1 id="mainrs调用同层级"><a class="markdownIt-Anchor" href="#mainrs调用同层级">#</a> main.rs 调用同层级</h1><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust">│  config<span class="token punctuation">.</span>rs│  main<span class="token punctuation">.</span>rs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>在 config.rs 中定义了 <code>print_config()</code>  函数・</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">print_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"我是config"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>函数默认为私有，使用 pub 关键字声明为共有，才能在外部使用</p></blockquote><p>在 main.rs 使用</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// mod 关键字声明为一个模块</span><span class="token comment">// cargo new创建的项目，以 src 为默认的根模块，名称为 crate</span><span class="token keyword">mod</span>  <span class="token module-declaration namespace">config</span><span class="token punctuation">;</span>    <span class="token comment">// 与要引用的 config.rs 文件名同名</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 完整路径为:  crate::config::print_config();</span>    <span class="token comment">// 因为 main.rs 与 config.rs 所处为根模块 crate，所以 crate 可省略</span>    <span class="token namespace">config<span class="token punctuation">::</span></span><span class="token function">print_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="mainrs调用不同层级"><a class="markdownIt-Anchor" href="#mainrs调用不同层级">#</a> main.rs 调用不同层级</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">│  config.rs│  main.rs│└─models        mod.rs        user_model.rs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>models/user_model.rs</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">print_user_model</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"我是user_model"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>新建 models/mod.rs, 在 mod.rs 中声明模块 mod</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// 文件 mod.rs 表明所处的目录 models 为一个 mod</span><span class="token keyword">pub</span> <span class="token keyword">mod</span> <span class="token module-declaration namespace">user_model</span><span class="token punctuation">;</span><span class="token comment">// 子 mod 名称与其文件名相同</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>在 main.rs 中调用</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">mod</span>  <span class="token module-declaration namespace">config</span><span class="token punctuation">;</span><span class="token keyword">mod</span>  <span class="token module-declaration namespace">models</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token namespace">config<span class="token punctuation">::</span></span><span class="token function">print_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token namespace">models<span class="token punctuation">::</span>user_model<span class="token punctuation">::</span></span><span class="token function">print_user_model</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// `一级mod` :: `二级mod` :: ... :: `函数`</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><ol><li>mod.rs 表明了该文件所处的目录 <code>models</code>  为一个 mod</li><li>在 mod.rs 中声明公有的子 mod: <code>user_model</code></li><li>在 main.rs 中使用 <code>models/user_model.rs</code>  中的函数</li></ol></blockquote><h1 id="不同层级的rs文件调用"><a class="markdownIt-Anchor" href="#不同层级的rs文件调用">#</a> 不同层级的 rs 文件调用</h1><p>最后的文件层级如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">│  config.rs│  main.rs│├─models│      mod.rs│      user_model.rs│      └─routes        mod.rs        user_route.rs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>routes/mod.rs</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">mod</span> <span class="token module-declaration namespace">user_models</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在 routes/user_routes.rs 中调用 models/user_model 的函数</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">print_user_route</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"print_user_model被调用了！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>models<span class="token punctuation">::</span>user_model<span class="token punctuation">::</span></span><span class="token function">print_user_model</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>main.rs 中使用</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">mod</span>  <span class="token module-declaration namespace">config</span><span class="token punctuation">;</span><span class="token keyword">mod</span>  <span class="token module-declaration namespace">routes</span><span class="token punctuation">;</span><span class="token keyword">mod</span>  <span class="token module-declaration namespace">models</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"我是main"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token namespace">config<span class="token punctuation">::</span></span><span class="token function">print_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token namespace">models<span class="token punctuation">::</span>user_model<span class="token punctuation">::</span></span><span class="token function">print_user_model</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token namespace">routes<span class="token punctuation">::</span>user_route<span class="token punctuation">::</span></span><span class="token function">print_user_route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>对于该文件层级定义的各个 mod 模块，其模块系统如下</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">crate│  ├─config│├─models  │   ││   └─ user_model│└─routes    │    └─ user_route<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>crate 为根模块，在上述 routes/user_routes.rs 中使用 crate 的绝对路径调用:</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>models<span class="token punctuation">::</span>user_model<span class="token punctuation">::</span></span><span class="token function">print_user_model</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>路径太长在编写代码时不易阅读，使用 use 关键字<br>修改 routes/user_routes.rs</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// 使用 use 引入模块的函数，后续只需要写函数名即可</span><span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>models<span class="token punctuation">::</span>user_model<span class="token punctuation">::</span></span>print_user_model<span class="token punctuation">;</span><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">print_user_route</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"print_user_model被调用了！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_user_model</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用 as 关键字重新自定义调用的函数名并使用，可解决名称冲突的问题</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>models<span class="token punctuation">::</span>user_model<span class="token punctuation">::</span></span>print_user_model <span class="token keyword">as</span> aa<span class="token punctuation">;</span><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">print_user_route</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"print_user_model被调用了！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">aa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面的 crate 为绝对路径调用，下面使用 supper 进行相对路径调用:<br> 在 routes 中再新建一个 health_route.rs</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">│  config.rs│  main.rs│├─models│      mod.rs│      user_model.rs│      └─routes        mod.rs        user_route.rs        health_route.rs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>routes/health_route.rs</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">print_health_route</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"我是health_route"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>要想在外部调用，不要忘记先在 routes/mod.rs 中声明</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">mod</span> <span class="token module-declaration namespace">health_route</span><span class="token punctuation">;</span><span class="token keyword">pub</span> <span class="token keyword">mod</span> <span class="token module-declaration namespace">user_route</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>routes/user_route.rs</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>models<span class="token punctuation">::</span>user_model<span class="token punctuation">::</span></span>print_user_model <span class="token keyword">as</span> aa<span class="token punctuation">;</span><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">print_user_route</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"print_user_model被调用了！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">aa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"print_health_route被调用了！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">super</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>health_route<span class="token punctuation">::</span></span><span class="token function">print_health_route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>super 是上一层级的 mod，对于 user_routes 来说上一级为: <code>crate::models</code></p>]]></content>
      
      
      <categories>
          
          <category> rust </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rust基本语法</title>
      <link href="/2023/04/08/rust%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/"/>
      <url>/2023/04/08/rust%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="变量绑定"><a class="markdownIt-Anchor" href="#变量绑定">#</a> 变量绑定</h1><p>不可变变量：在变量赋值或对象创建结束之后就不能再改变它的值或状态的变量<br>可变变量：同理，在变量赋值或对象创建结束之后就可以再改变它的值或状态的变量</p><p>在 rust 中使用 <code>let</code>  关键字声明变量绑定<br>在 rust 中默认的都是不可变的，即不可以使用 <code>变量=值</code> 的方式修改绑定的值，如需修改则通过 shadowing (掩盖 / 重影 / 隐藏) 创建一个新的不可变变量绑定<br>变量如果需要可变需要使用 <code>mut</code>  修饰，可以直接修改绑定的值</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>      <span class="token comment">// 创建一个不可变变量，将 1 与变量绑定</span>x <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>          <span class="token comment">// 错误，不能修改不可变变量绑定的值</span><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>      <span class="token comment">// 正确，通过shadowing创建一个新的不可变绑定</span><span class="token keyword">let</span> <span class="token keyword">mut</span> y <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">// 创建一个可变变量，将 1 与变量绑定</span>y <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>          <span class="token comment">// 正确，可以修改可变变量</span><span class="token keyword">let</span> z<span class="token punctuation">:</span> <span class="token keyword">i16</span> <span class="token operator">=</span> <span class="token number">3</span>  <span class="token comment">// 显式声明，指定类型，默认的隐式声明会自动推断类型</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>rust 的报错信息</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"> --<span class="token operator">></span> main.rs:3:5  <span class="token operator">|</span><span class="token number">2</span> <span class="token operator">|</span>     <span class="token builtin class-name">let</span> <span class="token assign-left variable">x</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>  <span class="token operator">|</span>         -  <span class="token operator">|</span>         <span class="token operator">|</span>  <span class="token operator">|</span>         first assignment to <span class="token variable"><span class="token variable">`</span>x<span class="token variable">`</span></span>  <span class="token operator">|</span>         help: consider making this binding mutable: <span class="token variable"><span class="token variable">`</span>mut x<span class="token variable">`</span></span><span class="token number">3</span> <span class="token operator">|</span>     <span class="token assign-left variable">x</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>  <span class="token operator">|</span>     ^^^ cannot assign twice to immutable variable<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>你会看到 cannot assign twice to immutable variable（不能对不可变变量 x 二次赋值）</p><h1 id="shadowing隐藏掩盖重影"><a class="markdownIt-Anchor" href="#shadowing隐藏掩盖重影">#</a> shadowing (隐藏 / 掩盖 / 重影)</h1><p>上面提到不可变变量不能二次赋值，但可以使用 shadowing，将原变量 “shadowing (隐藏)”<br>shadowing 是使用同名的新变量隐藏掉了原变量，直到新变量也被隐藏或者其作用域结束为止，使用该变量名的行为都视为使用这个新变量。<br>可以多次隐藏。</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span><span class="token comment">// x=5</span>    <span class="token keyword">let</span> x <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">// x=6</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> x <span class="token operator">=</span> x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"The value of x in the inner scope is: &#123;x&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// x=12</span>        <span class="token comment">// x=12的作用域结束</span>    <span class="token punctuation">&#125;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"The value of x is: &#123;x&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// x=6</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="常量"><a class="markdownIt-Anchor" href="#常量">#</a> 常量</h1><p>常量只能被设置为常量表达式，而不可以是其他任何只能在运行时计算出的值<br>可以出现在任何作用域（包括全局作用域）</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">const</span> <span class="token constant">PI</span><span class="token punctuation">:</span> <span class="token keyword">f64</span> <span class="token operator">=</span> <span class="token number">3.14159</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token constant">MAGIC</span><span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token class-name">A</span><span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span>x<span class="token operator">*</span>y<span class="token punctuation">;</span><span class="token comment">//错误， x*y是运行时才能确定</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h1 id="数据类型"><a class="markdownIt-Anchor" href="#数据类型">#</a> 数据类型</h1><p>数值类型：分为整型与浮点型</p><ul><li>i8、i16、i32、i64、i128、isize</li><li>u8、u16、u32、u64、u128、usize</li><li>f32、f64</li><li>其中 isize 和 usize 是指针大小的整数，因此它们的大小与机器架构相关。</li><li>字面值 (literals) 写为 10i8、10u16、10.0f32、10usize 等。</li><li>字面值如果不指定类型，则默认整数为 i32，浮点数为 f64。</li></ul><p>布尔类型 (bool)：true/false<br> 字符类型：用单引号 <code>''</code>  包裹，unicode 编码<br>复合类型：数组 (array)、切片 (slice)、字符串 (string)、元组 (tuple)<br> 函数：函数也是一种类型</p><h2 id="数组"><a class="markdownIt-Anchor" href="#数组">#</a> 数组</h2><p><code>[T;N]</code> ,T 为元素类型，N 为元素个数</p><ul><li>N 是编译时常数 (compile-time constant)，也就是说数组的长度是固定的。</li><li>运行时 (runtime) 访问数组元素会检查是否越界。</li></ul><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 3个元素的数组</span><span class="token keyword">let</span> arr2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// 3个元素的数组，元素都是 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="切片"><a class="markdownIt-Anchor" href="#切片">#</a> 切片</h2><p>切片类型的形式为  <code>&amp;[T]</code> ，例如  <code>&amp;[i32]</code> <br> 切片可以是可变的，也可以是不可变的。<br>切片不能直接创建，需要从别的变量借用 (borrow), 这里暂时直接用 go 的切片来理解</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">let</span> total_slice <span class="token operator">=</span> <span class="token operator">&amp;</span>arr<span class="token punctuation">;</span> <span class="token comment">// 数组arr的切片</span><span class="token keyword">let</span> total_slice <span class="token operator">=</span> <span class="token operator">&amp;</span>arr<span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 与上面的效果一样</span><span class="token keyword">let</span> partial_slice <span class="token operator">=</span> <span class="token operator">&amp;</span>arr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">..</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 索引2到4的的元素：[2, 3, 4]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="字符串"><a class="markdownIt-Anchor" href="#字符串">#</a> 字符串</h2><p><code>String</code>  是在堆上分配空间、可以增长的字符序列。<br> <code>&amp;str</code>  是 String 的切片类型<br> <code>str</code>  是没有大小的类型，编译时不知道大小，因此无法独立存在</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span> <span class="token operator">=</span> <span class="token string">"galaxy"</span><span class="token punctuation">;</span><span class="token keyword">let</span> s2<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token string">"galaxy"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> s3<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"galaxy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> s4<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>s3<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="元组"><a class="markdownIt-Anchor" href="#元组">#</a> 元组</h2><ul><li>元组是固定大小的、有序的、异构的列表类型。</li><li>可以通过下标来访问元组的分量，例如 foo.0。</li><li>可以使用 let 绑定来解构。</li></ul><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> foo<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token punctuation">,</span> <span class="token keyword">f64</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">72</span><span class="token punctuation">,</span> <span class="token char">'H'</span><span class="token punctuation">,</span> <span class="token number">5.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">72</span><span class="token punctuation">,</span> <span class="token char">'H'</span><span class="token punctuation">,</span> <span class="token number">5.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token operator">=</span> foo<span class="token punctuation">;</span> <span class="token comment">// a = 72, b = 'H', c = 5.1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="向量"><a class="markdownIt-Anchor" href="#向量">#</a> 向量</h2><p><code>Vec</code>  是分配在堆上的、可增长的数组<br> <code>&lt;T&gt;</code>  表示泛型，使用时代入实际的类型<br>使用  <code>Vec::new()</code>  或  <code>vec!</code>  宏来创建 Vec</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// Explicit typing</span><span class="token keyword">let</span> v0<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token class-name">Vec</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// v1 and v2 are equal</span><span class="token keyword">let</span> <span class="token keyword">mut</span> v1 <span class="token operator">=</span> <span class="token class-name">Vec</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>v1<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>v1<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>v1<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> v2 <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// v3 and v4 are equal</span><span class="token keyword">let</span> v3 <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">let</span> v4 <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">let</span> v2 <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">let</span> x <span class="token operator">=</span> v2<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>向量可以像数组一样使用 [] 来访问元素。<ul><li>在 Rust 中不能用 i32/i64 等类型的值作为下标访问元素。</li><li>必须使用 usize 类型的值，因为 usize 保证和指针是一样长度的。</li><li>其他类型要显式转换成 usize：<br>let i: i8 = 2;<br>let y = v2[i as usize];</li></ul></li></ul><h2 id="类型转换"><a class="markdownIt-Anchor" href="#类型转换">#</a> 类型转换</h2><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> x<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span><span class="token keyword">let</span> y<span class="token punctuation">:</span> <span class="token keyword">u32</span> <span class="token operator">=</span> x <span class="token keyword">as</span> <span class="token keyword">u32</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>一般来说，只能在可以安全转换的类型之间进行转换操作<br>例如，[u8; 4] 不能转换为 char 类型</p><h1 id="引用"><a class="markdownIt-Anchor" href="#引用">#</a> 引用</h1><p><code>&amp;</code>  取引用<br> <code>*</code>  解引用<br>与 c++ 一样，在 Rust 中，引用保证是合法的</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span><span class="token keyword">let</span> ref_x <span class="token operator">=</span> <span class="token operator">&amp;</span>x<span class="token punctuation">;</span><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token operator">*</span>ref_x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 12</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h1 id="语句"><a class="markdownIt-Anchor" href="#语句">#</a> 语句</h1><h2 id="if-else-条件语句"><a class="markdownIt-Anchor" href="#if-else-条件语句">#</a> if-else 条件语句</h2><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">if</span> x <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">&#123;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="while-循环"><a class="markdownIt-Anchor" href="#while-循环">#</a> while 循环</h2><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> <span class="token keyword">mut</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">while</span> x <span class="token operator">&lt;</span> <span class="token number">100</span> <span class="token punctuation">&#123;</span>    x <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"x: &#123;&#125;"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="loop-循环"><a class="markdownIt-Anchor" href="#loop-循环">#</a> loop 循环</h2><p>无限循环，相当于 while true 和 for (;😉, 直到遇到 break 语句或程序终止<br> loop 循环中的 break 语句可以返回一个值，作为整个循环的求值结果（另外两种循环没<br>有这个功能）</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> <span class="token keyword">mut</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token keyword">loop</span> <span class="token punctuation">&#123;</span>        x <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> x <span class="token operator">*</span> x <span class="token operator">>=</span> <span class="token number">100</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">break</span> x<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token macro property">print!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;,&#123;&#125;"</span><span class="token punctuation">,</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token comment">//10,10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="for-循环"><a class="markdownIt-Anchor" href="#for-循环">#</a> for 循环</h2><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span><span class="token number">10</span> <span class="token punctuation">&#123;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//输出0到9</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> xs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token operator">&amp;</span>xs <span class="token punctuation">&#123;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 循环输出数组的元素值</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="match-匹配语句"><a class="markdownIt-Anchor" href="#match-匹配语句">#</a> match 匹配语句</h2><p>类似于 switch 语句</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token comment">// 匹配 x 的值</span><span class="token keyword">match</span> x <span class="token punctuation">&#123;</span>       <span class="token comment">// 匹配到 1</span>    <span class="token number">1</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"one fish"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>     <span class="token comment">// 匹配到 2</span>    <span class="token number">2</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>          <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"two fish"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"two fish"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>     <span class="token comment">// 其他情况使用下划线 `_`</span>    _ <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"no fish for you"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">&#125;</span><span class="token comment">//  no fish for you</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以匹配任意表达式</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">;</span><span class="token keyword">match</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"one"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"two, &#123;&#125;"</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"three"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token keyword">if</span> i <span class="token operator">></span> <span class="token number">5</span> <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"On guard!"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">(</span>_<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">":&lt;"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="模式"><a class="markdownIt-Anchor" href="#模式">#</a> 模式</h1><h1 id="函数"><a class="markdownIt-Anchor" href="#函数">#</a> 函数</h1><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> 函数名称<span class="token punctuation">(</span>参数列表<span class="token punctuation">(</span>参数名<span class="token punctuation">:</span>参数类型<span class="token punctuation">,</span><span class="token punctuation">...</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">-></span> 返回值类型<span class="token punctuation">&#123;</span>    <span class="token comment">//函数体</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">foo</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token class-name">U</span><span class="token punctuation">,</span> z<span class="token punctuation">:</span> <span class="token class-name">V</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">T</span> <span class="token punctuation">&#123;</span><span class="token comment">// ...</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Rust 必须显式定义函数的参数和返回值的类型。<br>实际上编译器是可以推断函数的参数和返回值的类型的，但是 Rust 的设计者认为显式指定是<br>一种更好的实践。</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">i32</span> <span class="token punctuation">&#123;</span>    x <span class="token operator">+</span> y <span class="token comment">// 不带分号，返回x+y的值</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">sub</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">i32</span> <span class="token punctuation">&#123;</span>    x <span class="token operator">-</span> y<span class="token punctuation">;</span> <span class="token comment">// 带分号，没有返回值，编译错误</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">mul</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">i32</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> x <span class="token operator">*</span> y<span class="token punctuation">;</span> <span class="token comment">// 使用return关键字，可以加分号</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>因为 Rust 的函数也是表达式，它们的返回值是由函数体最后一个表达式的值决定的。如果最后一个表达式后面加了分号，那么它就变成了一个语句，而语句没有值，所以函数就没有返回值了。</p><h1 id="宏"><a class="markdownIt-Anchor" href="#宏">#</a> 宏</h1><h1 id="print-和-println"><a class="markdownIt-Anchor" href="#print-和-println">#</a> print! 和 println!</h1><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token string">"foo"</span><span class="token punctuation">;</span><span class="token macro property">print!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;, &#123;&#125;, &#123;&#125;"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// => foo, 3, true</span><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:?&#125;, &#123;:?&#125;"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// => "foo", [1, 2, 3]</span><span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;0&#125;, &#123;y&#125;, &#123;0&#125;"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// => foo, 1, foo</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用  <code>&#123;&#125;</code>  来做字符串插入， <code>&#123;:?&#125;</code>  做调试输出。<br>有些类型，例如数组和向量，只能用调试输出的方式来打印<br> <code>&#123;&#125;</code>  里可以加数字，表示第几个参数，新版本还可以把变量名写在  <code>&#123;&#125;</code>  里</p>]]></content>
      
      
      <categories>
          
          <category> rust </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rust所有权和引用</title>
      <link href="/2023/04/07/rust%E6%89%80%E6%9C%89%E6%9D%83%E5%92%8C%E5%BC%95%E7%94%A8/"/>
      <url>/2023/04/07/rust%E6%89%80%E6%9C%89%E6%9D%83%E5%92%8C%E5%BC%95%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="内存分配"><a class="markdownIt-Anchor" href="#内存分配">#</a> 内存分配</h1><p>全局对象：事先分配的内存空间段，程序启动时分配，结束时回收。<br>局部对象：分配在栈上，进入函数时分配，退出函数时回收。<br>动态对象：分配在堆上，需要时分配，不需要时回收。</p><h1 id="规则"><a class="markdownIt-Anchor" href="#规则">#</a> 规则</h1><ul><li>Rust 中的每一个值都有一个 所有者（owner）。</li><li>值在任一时刻有且只有一个所有者。</li><li>当所有者（变量）离开作用域，这个值将被丢弃。</li></ul><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 从此处起，s 是有效的</span>    <span class="token comment">// 使用 s</span><span class="token punctuation">&#125;</span>                                  <span class="token comment">// 此作用域已结束，</span>                                   <span class="token comment">// s 不再有效</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="move移动转移"><a class="markdownIt-Anchor" href="#move移动转移">#</a> move (移动 / 转移)</h1><p>Rust 中的数值类型是实现了 Copy trait 的 (存储在栈上的类型)，它们在赋值或者传递给函数时，会自动地进行复制，而不是转移所有权。例如：</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span> <span class="token comment">// x拥有42的所有权</span><span class="token keyword">let</span> y <span class="token operator">=</span> x<span class="token punctuation">;</span> <span class="token comment">// y拥有42的所有权，x也保留了42的所有权，因为42是Copy类型</span><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"x is &#123;&#125;, y is &#123;&#125;"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可以同时使用x和y</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>而对于没有实现 Copy trait 的类型，比如 String (存储在堆上的类型)，它们在赋值或者传递给函数时，会转移所有权，原来的变量就不能再使用了 34。例如：</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// String::from方法创建字符串"hello",s1拥有"hello"的所有权，内存分配在堆上</span><span class="token keyword">let</span> s2 <span class="token operator">=</span> s1<span class="token punctuation">;</span> <span class="token comment">// s2拥有"hello"的所有权，s1失去了"hello"的所有权，因为String不是Copy类型</span><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"s1 is &#123;&#125;"</span><span class="token punctuation">,</span> s1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 编译错误，s1不能再使用</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>类似于 go 的字符串，string 类型实质上是指向底层字符数组的指针 (指向的底层数组 / 长度 / 容量)，s2 拷贝了 s1 的长度和容量但不拷贝数据，s1 和 s2 都指向了同一个字符数组 &quot;hello&quot; 的内存，s2 拷贝了。当变量离开作用域后，Rust 会自动调用 drop 函数并清理变量的堆内存。而 s1 和 s2 离开作用域后它们都会尝试释放相同的内存，会导致二次释放（double free）的错误，因此为了确保内存安全，所有权转移后 s1 就不再有效，s1 离开作用域后不会释放内存。</p></blockquote><h1 id="clone克隆"><a class="markdownIt-Anchor" href="#clone克隆">#</a> clone (克隆)</h1><p>clone 会分配一块新的内存，拷贝 s1 指向的字符数组的数据，此时 s1 和 s2 指向的底层数组地址是不同的。又可以叫做深拷贝，上面不拷贝数据的则叫做浅拷贝。</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> s2 <span class="token operator">=</span> s1<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"s1 = &#123;&#125;, s2 = &#123;&#125;"</span><span class="token punctuation">,</span> s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// s1 = hello, s2 = hello</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>实现 copy trait 的类型则不需要 clone 也能够复制数据，例如前面的整型类型</p><p><strong>copy trait</strong> (标记类型):</p><ul><li>所有整数类型，比如 u32。</li><li>布尔类型，bool，它的值是 true 和 false。</li><li>所有浮点数类型，比如 f64。</li><li>字符类型，char。</li><li>元组，当且仅当其包含的类型也都实现 Copy 的时候。比如，(i32, + i32) 实现了 Copy，但 (i32, String) 就没有。</li></ul><h1 id="所有权与函数"><a class="markdownIt-Anchor" href="#所有权与函数">#</a> 所有权与函数</h1><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// s 进入作用域</span>    <span class="token function">takes_ownership</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// s 的值移动到函数里 ...</span>                                    <span class="token comment">// ... 所以到这里不再有效</span>    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>                      <span class="token comment">// x 进入作用域</span>    <span class="token function">makes_copy</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">// x 应该移动函数里，</span>                                    <span class="token comment">// 但 i32 是 Copy 的，</span>                                    <span class="token comment">// 所以在后面可继续使用 x</span><span class="token punctuation">&#125;</span> <span class="token comment">// 这里，x 先移出了作用域，然后是 s。但因为 s 的值已被移走，</span>  <span class="token comment">// 没有特殊之处</span><span class="token keyword">fn</span> <span class="token function-definition function">takes_ownership</span><span class="token punctuation">(</span>some_string<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// some_string 进入作用域</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> some_string<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token comment">// 这里，some_string 移出作用域并调用 `drop` 方法。</span>  <span class="token comment">// 占用的内存被释放</span><span class="token keyword">fn</span> <span class="token function-definition function">makes_copy</span><span class="token punctuation">(</span>some_integer<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// some_integer 进入作用域</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> some_integer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token comment">// 这里，some_integer 移出作用域。没有特殊之处</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="返回值-参数与作用域"><a class="markdownIt-Anchor" href="#返回值-参数与作用域">#</a> 返回值、参数与作用域</h1><p>转移返回值的所有权</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token function">gives_ownership</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// gives_ownership 将返回值</span>                                        <span class="token comment">// 转移给 s1</span>    <span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// s2 进入作用域</span>    <span class="token keyword">let</span> s3 <span class="token operator">=</span> <span class="token function">takes_and_gives_back</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// s2 被移动到</span>                                        <span class="token comment">// takes_and_gives_back 中，</span>                                        <span class="token comment">// 它也将返回值移给 s3</span><span class="token punctuation">&#125;</span> <span class="token comment">// 这里，s3 移出作用域并被丢弃。s2 也移出作用域，但已被移走，</span>  <span class="token comment">// 所以什么也不会发生。s1 离开作用域并被丢弃</span><span class="token keyword">fn</span> <span class="token function-definition function">gives_ownership</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>             <span class="token comment">// gives_ownership 会将</span>                                             <span class="token comment">// 返回值移动给</span>                                             <span class="token comment">// 调用它的函数</span>    <span class="token keyword">let</span> some_string <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"yours"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// some_string 进入作用域。</span>    some_string                              <span class="token comment">// 返回 some_string </span>                                             <span class="token comment">// 并移出给调用的函数</span>                                             <span class="token comment">// </span><span class="token punctuation">&#125;</span><span class="token comment">// takes_and_gives_back 将传入字符串并返回该值</span><span class="token keyword">fn</span> <span class="token function-definition function">takes_and_gives_back</span><span class="token punctuation">(</span>a_string<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span> <span class="token comment">// a_string 进入作用域</span>                                                      <span class="token comment">// </span>    a_string  <span class="token comment">// 返回 a_string 并移出给调用的函数</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>返回多个参数的所有权</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token punctuation">(</span>s2<span class="token punctuation">,</span> len<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">calculate_length</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"The length of '&#123;&#125;' is &#123;&#125;."</span><span class="token punctuation">,</span> s2<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">calculate_length</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token keyword">usize</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> length <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// len() 返回字符串的长度</span>    <span class="token punctuation">(</span>s<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="引用与借用"><a class="markdownIt-Anchor" href="#引用与借用">#</a> 引用与借用</h1><p>与上一小节的代码不同的是 calculate_length 函数，以一个对象的引用作为参数而不是获取值的所有权</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> len <span class="token operator">=</span> <span class="token function">calculate_length</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"The length of '&#123;&#125;' is &#123;&#125;."</span><span class="token punctuation">,</span> s1<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">calculate_length</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">usize</span> <span class="token punctuation">&#123;</span>    s<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">// 这里，s 离开了作用域。但因为它并不拥有引用值的所有权，</span>  <span class="token comment">// 所以什么也不会发生</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>s 是指向 s1 的引用，但不拥有，当停止引用时所指的值也不会丢弃。</p></blockquote><ul><li>引用不用获取所有权就可以使用值</li><li>引用像一个指针，因为它是一个地址，我们可以由此访问储存于该地 + 址的属于其他变量的数据。 与指针不同，引用确保指向某个特定类型的有效值</li><li><strong>借用</strong>就是创建一个引用的行为</li><li>正如变量默认是不可变的，引用也一样。（默认）不允许修改引用的 + 值。</li></ul><h1 id="可变引用"><a class="markdownIt-Anchor" href="#可变引用">#</a> 可变引用</h1><p>类似于可变变量，使用 mut 修饰，其格式如下例子</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// let s = String::from("hello");  //默认引用不允许修改</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//可以修改</span>    <span class="token function">change</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">change</span><span class="token punctuation">(</span>some_string<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    some_string<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">", world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>但是可变引用存在限制，如果你有一个对该变量的可变引用，你就不能再创建对该变量的引用。这些尝试创建两个 s 的可变引用的代码会失败：</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> r1 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">;</span><span class="token keyword">let</span> r2 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">;</span><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;, &#123;&#125;"</span><span class="token punctuation">,</span> r1<span class="token punctuation">,</span> r2<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>这样的限制能够避免数据竞争 (data race)</p></blockquote><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> r1 <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">;</span> <span class="token comment">// 没问题</span><span class="token keyword">let</span> r2 <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">;</span> <span class="token comment">// 没问题</span><span class="token keyword">let</span> r3 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">;</span> <span class="token comment">// 大问题</span><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;, &#123;&#125;, and &#123;&#125;"</span><span class="token punctuation">,</span> r1<span class="token punctuation">,</span> r2<span class="token punctuation">,</span> r3<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>允许有多个不可变引用，因为它们都不能对引用进行修改，这是安全的，但是不可变引用不能再创建可变引用，以及不允许同时拥有多个相同的可变引用，这些是不安全的。</p><p>注意是否是同时拥有，以下这样是可行</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> r1 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token comment">// r1 在这里离开了作用域，所以我们完全可以创建一个新的可变引用</span><span class="token keyword">let</span> r2 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="悬垂引用"><a class="markdownIt-Anchor" href="#悬垂引用">#</a> 悬垂引用</h1><p>在具有指针的语言中，很容易通过释放内存时保留指向它的指针而错误地生成一个悬垂指针，其指向的内存可能已经被分配给其它持有者。</p><p>在 Rust 中编译器确保引用永远也不会变成悬垂状态：当你拥有一些数据的引用，编译器确保数据不会在其引用之前离开作用域。</p><h1 id="引用规则总结"><a class="markdownIt-Anchor" href="#引用规则总结">#</a> 引用规则总结</h1><ul><li>在任意给定时间，要么只能有一个可变引用，要么只能有多个不可变引用。</li><li>引用必须总是有效的。</li></ul><h1 id="切片"><a class="markdownIt-Anchor" href="#切片">#</a> 切片</h1><p>切片是特殊的引用，表示引用序列中的一个片段</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">let</span> world <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">..</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> rust </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rust基本语法</title>
      <link href="/2023/04/05/rust%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/"/>
      <url>/2023/04/05/rust%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="环境配置"><a class="markdownIt-Anchor" href="#环境配置">#</a> 环境配置</h1><p>官网安装:<br><a href="https://www.rust-lang.org/zh-CN/">https://www.rust-lang.org/zh-CN/</a><br> 注意：安装 rust 可能需要 gcc 等依赖，可能还需要 visual studio 安装一些必需模块，按照提示进行安装即可</p><p>vscode 插件: rust-analyzer</p><h1 id="hello-world"><a class="markdownIt-Anchor" href="#hello-world">#</a> Hello World</h1><p>创建项目</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cargo</span> new hello<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>编写程序主文件: hello/src/main.rs</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Hello, world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>执行代码:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 进入目录</span><span class="token builtin class-name">cd</span> hello/src<span class="token comment">#　编译文件</span>rustc main.rs<span class="token comment"># 执行</span>main<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>推荐 vscode 插件 <code>Code Runner</code> ，一键编译并执行</p>]]></content>
      
      
      <categories>
          
          <category> rust </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pytorch神经网络训练</title>
      <link href="/2023/03/28/pytorch%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E8%AE%AD%E7%BB%83/"/>
      <url>/2023/03/28/pytorch%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E8%AE%AD%E7%BB%83/</url>
      
        <content type="html"><![CDATA[<p>学自李宏毅老师</p><h1 id="神经网络训练设置"><a class="markdownIt-Anchor" href="#神经网络训练设置">#</a> 神经网络训练设置</h1><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 从数据集中读取数据</span>dataset <span class="token operator">=</span> MyDataset<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token comment"># 将数据放到数据加载器，分批</span>tr_set <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>dataset<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token comment"># 构造模型并指定设备(cpu/cuda(gpu))</span>model <span class="token operator">=</span> MyModel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token comment"># 设置损失函数</span>criterion <span class="token operator">=</span> nn<span class="token punctuation">.</span>MSELoss<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 设置优化器</span>optimizer <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="神经网络训练回路"><a class="markdownIt-Anchor" href="#神经网络训练回路">#</a> 神经网络训练回路</h1><p>感觉这里用回路比循环好听一点</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 迭代 n_epochs</span><span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n_epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># 将模型设置为训练模式</span>    model<span class="token punctuation">.</span>train<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># 通过数据加载器迭代</span>    <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> tr_set<span class="token punctuation">:</span>        <span class="token comment"># 梯度置为 0</span>        optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment"># cpu/cuda</span>        x<span class="token punctuation">,</span> y <span class="token operator">=</span> x<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>        <span class="token comment"># 正向传播（计算输出）</span>        pred <span class="token operator">=</span> model<span class="token punctuation">(</span>x<span class="token punctuation">)</span>        <span class="token comment"># 计算损失</span>        loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>pred<span class="token punctuation">,</span> y<span class="token punctuation">)</span>        <span class="token comment"># 反向传播（计算梯度）</span>        loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment"># 使用优化器更新模型</span>        optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="神经网络验证回路"><a class="markdownIt-Anchor" href="#神经网络验证回路">#</a> 神经网络验证回路</h1><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 将模型设置为评估模式</span>model<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span>total_loss <span class="token operator">=</span> <span class="token number">0</span><span class="token comment"># 通过数据加载器迭代</span><span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> dv_set<span class="token punctuation">:</span>    <span class="token comment"># cpu/cuda(gpu)</span>    x<span class="token punctuation">,</span> y <span class="token operator">=</span> x<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>    <span class="token comment"># 禁用梯度计算</span>    <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># 前向传播（计算输出）</span>        pred <span class="token operator">=</span> model<span class="token punctuation">(</span>x<span class="token punctuation">)</span>        <span class="token comment"># 计算损失</span>        loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>pred<span class="token punctuation">,</span> y<span class="token punctuation">)</span>    <span class="token comment"># 累积损失</span>    total_loss <span class="token operator">+=</span> loss<span class="token punctuation">.</span>cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token builtin">len</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>    <span class="token comment"># 计算平均损失</span>    avg_loss <span class="token operator">=</span> total_loss <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>dv_set<span class="token punctuation">.</span>dataset<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="神经网络测试回路"><a class="markdownIt-Anchor" href="#神经网络测试回路">#</a> 神经网络测试回路</h1><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># # 将模型设置为评估模式</span>model<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span>preds <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">for</span> x <span class="token keyword">in</span> tt_set<span class="token punctuation">:</span>    x <span class="token operator">=</span> x<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>    <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        pred <span class="token operator">=</span> model<span class="token punctuation">(</span>x<span class="token punctuation">)</span>        <span class="token comment"># 收集预测结果</span>        preds<span class="token punctuation">.</span>append<span class="token punctuation">(</span>pred<span class="token punctuation">.</span>cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> pytorch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pytorch-transformer</title>
      <link href="/2023/03/27/pytorch-transformer/"/>
      <url>/2023/03/27/pytorch-transformer/</url>
      
        <content type="html"><![CDATA[<p><a href="https://zhuanlan.zhihu.com/p/338817680">https://zhuanlan.zhihu.com/p/338817680</a><br><a href="https://blog.csdn.net/qq_38890412/article/details/120601834">https://blog.csdn.net/qq_38890412/article/details/120601834</a></p><h1 id="seq2seq从序列到序列"><a class="markdownIt-Anchor" href="#seq2seq从序列到序列">#</a> Seq2Seq (从序列到序列)</h1><p>将一个作为输入的序列映射为一个作为输出的序列，这一过程由编码（Encoder）输入与解码（Decoder）输出两个环节组成，前者负责把序列编码成一个固定长度的向量，这个向量作为输入传给后者，输出可变长度的向量。<br>RNN-CNN-Transformer 都是如此</p><h1 id="rnn循环神经网络"><a class="markdownIt-Anchor" href="#rnn循环神经网络">#</a> RNN (循环神经网络)</h1><p>简单来说，我们想翻译 <code>I like deep learning</code>  为中文，将这七个汉字的输入序列映射为输出序列 <code>我喜欢深度学习</code> 。在输出 <code>我</code> 时，会根据输入 <code>I</code>  来翻译，在输出 <code>喜欢</code> 时，会根据 <code>I like</code>  来翻译，输出 <code>深度</code> 时会・根据 <code>I like deep</code>  来翻译，输出 <code>学习</code> 是，会根据 <code>I like deep learning</code>  来翻译</p><p>RNN 不能并行，指的是当前的状态会依赖前一个状态，前一个状态的计算结果会作为当前状态的输入。</p><h1 id="cnn卷积神经网络"><a class="markdownIt-Anchor" href="#cnn卷积神经网络">#</a> CNN (卷积神经网络)</h1><p>简单来说是窗口式遍历，要翻译 <code>I like deep learning</code> ，假设每两个词一组，, <code>I like</code> , <code>like deep</code> , <code>deep learning</code> ，分别提取每组的特征进行计算，所以 CNN 能够并行。但是仅如此这个神经网络并不能覆盖整个句子，所以需要再叠加 CNN，将多组的特征再提取一次进行计算， <code>I like</code> , <code>like deep</code>  为一组以及 <code>like deep</code> , <code>deep learning</code>  为一组，以此类推地叠加，最后得到结果。</p><p>CNN 能并行，指的是每一组的计算都能够同时进行，并不会依赖其他组的计算结果。</p><h1 id="transformer"><a class="markdownIt-Anchor" href="#transformer">#</a> Transformer</h1><h2 id="self-attention自注意力机制"><a class="markdownIt-Anchor" href="#self-attention自注意力机制">#</a> self-attention (自注意力机制)</h2><p>注意力机制：权重分配机制，给需要关注的地方分配更高的权重，不相关的分配更低的权重。<br><a href="https://blog.csdn.net/qq_38890412/article/details/120601834">https://blog.csdn.net/qq_38890412/article/details/120601834</a></p><h3 id="xxt-的含义"><a class="markdownIt-Anchor" href="#xxt-的含义">#</a> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><msup><mi>X</mi><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">XX^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span> 的含义</h3><p>对于二维矩阵，用行向量<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>A</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">A_1,A_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 表示</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>X</mi><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>11</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>12</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>21</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>22</mn></msub></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>A</mi><mn>1</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>A</mi><mn>2</mn></msub></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">X= \begin{bmatrix}   a_{11} &amp; a_{12} \\   a_{21} &amp; a_{22} \\  \end{bmatrix} =  \begin{bmatrix}   A_1 \\   A_2 \\  \end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>A</mi><mn>1</mn></msub><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>11</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>12</mn></msub></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo separator="true">,</mo><msub><mi>A</mi><mn>2</mn></msub><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>21</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>22</mn></msub></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">A_1=\begin{bmatrix}   a_{11} &amp; a_{12} \\\end{bmatrix},A_2=\begin{bmatrix}   a_{21} &amp; a_{22} \\\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.20001em;vertical-align:-0.35001em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8500000000000001em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35000000000000003em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8500000000000001em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35000000000000003em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">]</span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.20001em;vertical-align:-0.35001em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8500000000000001em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35000000000000003em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8500000000000001em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35000000000000003em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">]</span></span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>X</mi><msup><mi>X</mi><mi>T</mi></msup><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>11</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>12</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>21</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>22</mn></msub></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo separator="true">⋅</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>11</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>21</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>12</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>22</mn></msub></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>A</mi><mn>1</mn></msub><msub><mi>A</mi><mn>1</mn></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>A</mi><mn>1</mn></msub><msub><mi>A</mi><mn>2</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>A</mi><mn>2</mn></msub><msub><mi>A</mi><mn>1</mn></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>A</mi><mn>2</mn></msub><msub><mi>A</mi><mn>2</mn></msub></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">XX^T=\begin{bmatrix}   a_{11} &amp; a_{12} \\   a_{21} &amp; a_{22} \\  \end{bmatrix}   ·  \begin{bmatrix}   a_{11} &amp; a_{21} \\   a_{12} &amp; a_{22} \\  \end{bmatrix}=  \begin{bmatrix}   A_1A_1 &amp; A_1A_2 \\   A_2A_1 &amp; A_2A_2 \\  \end{bmatrix} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8913309999999999em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span></span></p><p>N 维矩阵同理，对于<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><msup><mi>X</mi><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">XX^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span> 得到的矩阵，其元素为原矩阵<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> 的 n 个向量的两两内积，向量的内积的几何意义是</p><ol><li>表征或计算两个向量之间的夹角</li><li>一个向量在另一个向量方向上的投影</li></ol><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>A</mi><mn>1</mn></msub><mo separator="true">⋅</mo><msub><mi>A</mi><mn>2</mn></msub><mo>=</mo><mi mathvariant="normal">∣</mi><msub><mi>A</mi><mn>1</mn></msub><mi mathvariant="normal">∣</mi><mo>∗</mo><mi mathvariant="normal">∣</mi><msub><mi>A</mi><mn>2</mn></msub><mi mathvariant="normal">∣</mi><mo>∗</mo><mi>c</mi><mi>o</mi><mi>s</mi><mi>θ</mi></mrow><annotation encoding="application/x-tex">A_1·A_2=|A_1|*|A_2|*cos\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">o</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span></span></span></p><p>投影值大小和夹角则表示向量之间的相关性，投影值大则意味两个向量相关度高，夹角为 90 度则两者线性无关</p><p>故矩阵 $ XX^T$ 是一个方阵，我们以行向量的角度理解，里面保存了每个向量和自己与其他向量进行内积运算的结果。</p><h3 id="softmax函数的含义"><a class="markdownIt-Anchor" href="#softmax函数的含义">#</a> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>o</mi><mi>f</mi><mi>t</mi><mi>m</mi><mi>a</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">Softmax</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">t</span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span></span></span></span> 函数的含义</h3><p>对 C 个元素中的第 i 个元素的 softmax 值为:</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>S</mi><mi>o</mi><mi>f</mi><mi>t</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><msub><mi>z</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mstyle displaystyle="false" scriptlevel="0"><mfrac><msup><mi>e</mi><msub><mi>z</mi><mi>i</mi></msub></msup><mrow><munderover><mo>∑</mo><mrow><mi>c</mi><mo>=</mo><mn>1</mn></mrow><mi>C</mi></munderover><msup><mi>e</mi><msub><mi>z</mi><mi>c</mi></msub></msup></mrow></mfrac></mstyle></mrow><annotation encoding="application/x-tex">Softmax(z_i)=\tfrac{e^{z_i}}{\sum^C_{c=1}e^{z_c}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">t</span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.565652em;vertical-align:-0.654672em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.91098em;"><span style="top:-2.570335em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mop op-symbol small-op mtight" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8852357142857143em;"><span style="top:-2.1785614285714283em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-2.8971428571428572em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.32143857142857146em;"><span></span></span></span></span></span></span><span class="mspace mtight" style="margin-right:0.19516666666666668em;"></span><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5935428571428571em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.23056em;"><span style="top:-2.3em;margin-left:-0.04398em;margin-right:0.1em;"><span class="pstrut" style="height:2.5em;"></span><span class="mord mathnormal mtight">c</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7385428571428572em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3448em;margin-left:-0.04398em;margin-right:0.1em;"><span class="pstrut" style="height:2.65952em;"></span><span class="mord mathnormal mtight">i</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.31472em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.654672em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>如 {ln1,ln2,ln3} , 其 softmax 值分别为 1/6,2/6,3/6<br> 其意义在于将每个输出的结果都赋予一个概率值，比如在分类时可以用来表示属于每个类别的可能性</p><h3 id="softmaxxxtx"><a class="markdownIt-Anchor" href="#softmaxxxtx">#</a> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>o</mi><mi>f</mi><mi>t</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><mi>X</mi><msup><mi>X</mi><mi>T</mi></msup><mo stretchy="false">)</mo><mi>X</mi></mrow><annotation encoding="application/x-tex">Softmax(XX^T)X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0913309999999998em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">t</span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span></h3><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><msup><mi>X</mi><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">XX^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span> 得到可以表示两两向量之间的相关性的值，Softmax 函数将这个值转换成概率值，其实就是为了得到权重，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>o</mi><mi>f</mi><mi>t</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><mi>X</mi><msup><mi>X</mi><mi>T</mi></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Softmax(XX^T)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0913309999999998em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">t</span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> 再与原来的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> 的积，其实就意味着加权求和，得到向量之间的相关度。</p><p>将<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> 作为一个句子，那么其中的向量则为一个个词向量，通过这个算法得到这个句子本身中字词之间的相关度，所以叫 <code>自注意</code> ，例如对于 <code>早上好</code> 这句话中 <code>早</code>   <code>上</code>   <code>好</code> 三个字对于其中的 <code>早</code> 来说， <code>早上</code> 的关联度就比 <code>早早</code> 、 <code>早好</code> 的关联度高。</p><h3 id="q-k-v-矩阵"><a class="markdownIt-Anchor" href="#q-k-v-矩阵">#</a> Q K V 矩阵</h3><p>深度学习中不会直接使用<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>X</mi><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">X^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span>, 为了增强模型的拟合能力，会使用可训练的参数矩阵:</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>W</mi><mi>Q</mi></msup><mo separator="true">,</mo><msup><mi>W</mi><mi>K</mi></msup><mo separator="true">,</mo><msup><mi>W</mi><mi>V</mi></msup></mrow><annotation encoding="application/x-tex">W^Q,W^K,W^V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.085771em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.891331em;"><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">Q</span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">V</span></span></span></span></span></span></span></span></span></span></span></span></p><p>输入矩阵<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> 分别与它们相乘得到 Q (query)、K (key)、V (value)</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo stretchy="false">(</mo><mi>Q</mi><mo separator="true">,</mo><mi>K</mi><mo separator="true">,</mo><mi>V</mi><mo stretchy="false">)</mo><mo>=</mo><mi>s</mi><mi>o</mi><mi>f</mi><mi>t</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><mfrac><mrow><mi>Q</mi><msup><mi>K</mi><mi>T</mi></msup></mrow><msqrt><msub><mi>d</mi><mi>k</mi></msub></msqrt></mfrac><mo stretchy="false">)</mo><mi>V</mi></mrow><annotation encoding="application/x-tex">Attention(Q,K,V)=softmax(\tfrac{QK^T}{\sqrt{d_k}})V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal">t</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord mathnormal">Q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.627473em;vertical-align:-0.538em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">t</span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.089473em;"><span style="top:-2.5864385em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8622307142857143em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15122857142857138em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.8222307142857144em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221l0 -0c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47zM834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.17776928571428574em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.446108em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">Q</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9190928571428572em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.538em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span><br> 上述表示了 Scaled Dot-Product Attention (缩放点积注意力)</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">{d_k}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span> 为方差，总之就是使得 Transformer 在训练过程中的梯度值保持稳定</p><h2 id="multi-headed-attention多头注意力机制"><a class="markdownIt-Anchor" href="#multi-headed-attention多头注意力机制">#</a> multi-headed attention (多头注意力机制)</h2><p>自注意力机制的缺陷就是：模型在对当前位置的信息进行编码时，会过度的将注意力集中于自身的位置， 使用多头注意力机制能增强 self-attention 关注多个位置的能力</p><p>例如 <code>我养了一只猫，它很可爱</code> 中， <code>它</code> 可以指代前文的 <code>猫</code> ，但从另一个维度 (形容词的角度) 看 <code>可爱</code> 也是可以用来修饰 <code>它</code> 的， <code>它</code> 与两者都有一定关联，使用多头注意力会使原本输出的一个向量变为多个向量</p><p>① 输入句子<br>② 将句子进行标记，转换成词向量矩阵 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span><br>③ 将 X 切分成 8 份，并与权重矩阵<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">W_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 相乘，构成输入向量<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mi>i</mi></msub><mi>X</mi></mrow><annotation encoding="application/x-tex">W_iX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span><br>④ 计算 Attention 权重矩阵：$$Attention (Q,K,V)=softmax (\tfrac<ruby>QK<rp>【</rp><rt>T</rt><rp>】</rp></ruby>{\sqrt{d_k}})V$$<br>⑤ 最后将 8 个头的结果合并</p><h2 id="位置编码"><a class="markdownIt-Anchor" href="#位置编码">#</a> 位置编码</h2><p>上面的计算只是知道词之间的关联关系，但并不知道可以将词放在句子的什么位置，即如何分析词序<br>以前的位置编码:</p><ol><li>1-N 分配:<br> 太阳晒屁股啦 [1 2 3 4 5]<br> 问题：越后面的数字越大，体现不了权重</li><li>[0,1] 分配:<br> 太阳晒屁股啦 [0 0.2 0.4 0.6 0.8 1]<br> 问题：句子长度不同位置编码不一样</li></ol><p>Transformer 模型的位置编码使用三角函数式的相对位置编码：有兴趣可以了解<br><a href="https://blog.csdn.net/u013853733/article/details/107853989"> https://blog.csdn.net/u013853733/article/details/107853989</a></p><p><a href="https://zhuanlan.zhihu.com/p/106644634">https://zhuanlan.zhihu.com/p/106644634</a></p><p><a href="https://kazemnejad.com/blog/transformer_architecture_positional_encoding/">https://kazemnejad.com/blog/transformer_architecture_positional_encoding/</a></p>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> pytorch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pytorch-神经网络基础</title>
      <link href="/2023/03/25/pytorch-%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/"/>
      <url>/2023/03/25/pytorch-%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<p>碎碎念：知识还没有完全还给老师 😄</p><span id="more"></span><h1 id="张量tensor"><a class="markdownIt-Anchor" href="#张量tensor">#</a> 张量 (Tensor)</h1><h2 id="简单理解张量"><a class="markdownIt-Anchor" href="#简单理解张量">#</a> 简单理解张量</h2><p>张量 - 多维数组 - 维度则为数组嵌套的层数<br> 0 维张量 - 标量</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>1 维张量 - 向量</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>2 维张量 - 矩阵 (3x3)</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">[</span>    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3 维张量 (2x2x3)</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">[</span>    <span class="token punctuation">[</span>        <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span>        <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">]</span>    <span class="token punctuation">]</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>更直观地类比:</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token number">0</span>维张量<span class="token operator">-</span>点<span class="token number">1</span>维张量<span class="token operator">-</span>线<span class="token punctuation">(</span>长<span class="token punctuation">)</span><span class="token number">2</span>维张量<span class="token operator">-</span>面<span class="token punctuation">(</span>长、宽<span class="token punctuation">)</span><span class="token number">3</span>维张量<span class="token operator">-</span>体<span class="token punctuation">(</span>长、宽、高<span class="token punctuation">)</span><span class="token number">4</span>维张量<span class="token operator">-</span>时空<span class="token punctuation">(</span>再多一个时间维度<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>维度可以说是描述事物的参数个数，例如要描述食物的色、香、味，则需要 3 个参数，即使用 3 维张量。</p><h2 id="常用-api"><a class="markdownIt-Anchor" href="#常用-api">#</a> 常用 API</h2><p><a href="https://blog.csdn.net/qq_49134563/article/details/108200828">https://blog.csdn.net/qq_49134563/article/details/108200828</a></p><h1 id="微分与梯度"><a class="markdownIt-Anchor" href="#微分与梯度">#</a> 微分与梯度</h1><p>公式和画图似乎不兼容 md 语法，数学公式会重复两遍，将就着看吧</p><h2 id="微分"><a class="markdownIt-Anchor" href="#微分">#</a> 微分</h2><p>对于一元函数，描述了函数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span> 在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> 处的变化率，直观表示为函数在该点的切线的斜率，为标量</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>d</mi><mi>y</mi><mo>=</mo><msup><mi>f</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>∗</mo><mi>d</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">dy=f&#x27;(x)*dx </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.051892em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">x</span></span></span></span></span></p><p>多元函数的全微分:</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>d</mi><mi>f</mi><mo>=</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>f</mi></mrow><mrow><mi mathvariant="normal">∂</mi><mi>x</mi></mrow></mfrac><mo>∗</mo><mi>d</mi><mi>x</mi><mo>+</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>f</mi></mrow><mrow><mi mathvariant="normal">∂</mi><mi>y</mi></mrow></mfrac><mo>∗</mo><mi>d</mi><mi>y</mi><mo>+</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>f</mi></mrow><mrow><mi mathvariant="normal">∂</mi><mi>z</mi></mrow></mfrac><mo>∗</mo><mi>d</mi><mi>z</mi><mo>+</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">df=\frac{∂f}{∂x}*dx+\frac{∂f}{∂y}*dy+\frac{∂f}{∂z}*dz+...</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.0574399999999997em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714399999999998em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.25188em;vertical-align:-0.8804400000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714399999999998em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.0574399999999997em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714399999999998em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.10556em;vertical-align:0em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span></span></span></p><h2 id="梯度"><a class="markdownIt-Anchor" href="#梯度">#</a> 梯度</h2><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>▽</mtext><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>=</mo><mi>g</mi><mi>r</mi><mi>a</mi><mi>d</mi><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>x</mi></mrow><mrow><mi mathvariant="normal">∂</mi><mi>f</mi></mrow></mfrac><mo separator="true">,</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>y</mi></mrow><mrow><mi mathvariant="normal">∂</mi><mi>f</mi></mrow></mfrac><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">▽f(x,y)=gradf(x,y)=( \frac{∂x}{∂f}, \frac{∂y}{∂f})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">▽</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.25188em;vertical-align:-0.8804400000000001em;"></span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714399999999998em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span></span></span></span></p><p>梯度是一个向量，是多元函数在某一点处的偏导数构成的向量<br>在一元函数中，导数与梯度在 <code>数值</code> 上是相等的</p><h2 id="自动微分求导autograd"><a class="markdownIt-Anchor" href="#自动微分求导autograd">#</a> 自动微分 / 求导 (autograd)</h2><p>pytorch 中，设置了 require_grads=True 的 tensor 可以被计算梯度。在 backward (反向传播) 过程中会被 autograd 模块自动计算梯度并保存在 tensor.grad</p><h2 id="梯度下降"><a class="markdownIt-Anchor" href="#梯度下降">#</a> 梯度下降</h2><p>沿着梯度向量的方向是函数增加的最快，更容易找到函数的极大值；<br>反之，沿着梯度向量相反的地方，梯度减少的最快，更容易找到极小值。</p><p>梯度下降，即每一点都沿着梯度方向的反方向求解，找到极小值 (不一定是最小值)，反之为梯度上升。</p><blockquote><p>类比：从山上下山，想要最快地到达山底，每一步都考虑最优，则每一步都沿着最陡峭的地方下山，但很可能走不到山脚，因为可能会走到山峰局部的低谷。</p></blockquote><h1 id="神经网络"><a class="markdownIt-Anchor" href="#神经网络">#</a> 神经网络</h1><p>markdown 画的图有点丑，例如两个输入的神经网络<br>在输入层 (第一层) 与输出层 (最后一层) 之间的都是隐藏层</p><pre class="mermaid">graph LR;  subgraph 输入层  X((x1))  Y((x2))  end  subgraph 隐藏层  P((h1))  Q((h2))  end  subgraph 输出层    F((o1))  end  X--w11-->P  Y--w21-->P  X--w12-->Q  Y--w22-->Q  P-->F  Q-->F</pre><p>图渲染不了，请自行搜索 <code>神经网络简单示例</code></p><h2 id="前向传播forward"><a class="markdownIt-Anchor" href="#前向传播forward">#</a> 前向传播 (forward)</h2><p>将上一层的输出作为下一层的输入，并计算下一层的输出，一直到运算到输出层为止。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>h</mi><mn>1</mn></msub><mo>=</mo><msub><mi>w</mi><mn>11</mn></msub><mo>∗</mo><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msub><mi>w</mi><mn>21</mn></msub><mo>∗</mo><msub><mi>x</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">h_1=w_{11} *x_1+w_{21}*x_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.61528em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.61528em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>h</mi><mn>2</mn></msub><mo>=</mo><msub><mi>w</mi><mn>12</mn></msub><mo>∗</mo><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msub><mi>w</mi><mn>22</mn></msub><mo>∗</mo><msub><mi>x</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">h_2=w_{12} *x_1+w_{22}*x_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.61528em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.61528em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>变为向量的形式:</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>H</mi><mo>=</mo><mi>W</mi><mo>∗</mo><mi>X</mi><mo>+</mo><mi>B</mi></mrow><annotation encoding="application/x-tex">H=W *X+B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span></span></p><p>当然无论多少次线性运算最终的结果都会与原来是线性相关的，所以会使用激活函数使每一层的计算结果变为非线性，作为下一层计算的输入。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>z</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><msup><mi>W</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo></mrow></msup><mo>∗</mo><msup><mi>a</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msup><mo>+</mo><msup><mi>b</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">z^{(l)}=W^{(l)} *a^{(l-1)}+b^{(l)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.938em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.938em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.0213299999999998em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.938em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>a</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mi>σ</mi><mo stretchy="false">(</mo><mi>z</mi><msup><mo stretchy="false">)</mo><mrow><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">a^{(l)}=σ(z)^{(l)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.938em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.188em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></span></p><p>其中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi></mrow><annotation encoding="application/x-tex">l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span></span></span></span> 是层数</p><h2 id="反向传播backforward"><a class="markdownIt-Anchor" href="#反向传播backforward">#</a> 反向传播 (backforward)</h2><p>数学知识比较复杂，已经好多年没学数学了～只简述其原理<br>以下文章应该算是比较有价值的<br><a href="https://zhuanlan.zhihu.com/p/32368246"> https://zhuanlan.zhihu.com/p/32368246</a><br><a href="https://zhuanlan.zhihu.com/p/71892752">https://zhuanlan.zhihu.com/p/71892752</a></p><h3 id="链式法则"><a class="markdownIt-Anchor" href="#链式法则">#</a> 链式法则</h3><p>如果某个函数由复合函数表示，则该复合函数的导数可以用构成复合函数的各个函数的导数的乘积表示。</p><p>若 $$y=g (x),z=f (g (x))=f (y),$$ 则</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><mi>d</mi><mi>z</mi></mrow><mrow><mi>d</mi><mi>x</mi></mrow></mfrac><mo>=</mo><mfrac><mrow><mi>d</mi><mi>z</mi></mrow><mrow><mi>d</mi><mi>y</mi></mrow></mfrac><mo>∗</mo><mfrac><mrow><mi>d</mi><mi>y</mi></mrow><mrow><mi>d</mi><mi>x</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{dz}{dx}=\frac{dz}{dy}*\frac{dy}{dx}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.05744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.25188em;vertical-align:-0.8804400000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.0574399999999997em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714399999999998em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>神经网络显然是复杂的复合函数，在计算梯度时遵循链式法则</p><h3 id="损失函数"><a class="markdownIt-Anchor" href="#损失函数">#</a> 损失函数</h3><p>度量训练样本计算出的输出和真实的训练样本输出之间的损失。我们使用最常见的均方误差（MSE）来作为损失函数，</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>C</mi><mo stretchy="false">(</mo><mi>W</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><msup><mi>a</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo></mrow></msup><mo>−</mo><mi>y</mi><mi mathvariant="normal">∣</mi><msubsup><mi mathvariant="normal">∣</mi><mn>2</mn><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">C(W,b)=\frac{1}{2}||a^{(l)}-y||^2_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord">∣</span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">∣</span><span class="mord"><span class="mord">∣</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>其中为训练样本计算出的输出，y 为训练样本的真实值。加入系数 是为了抵消微分出来的指数。</p><h3 id="反向传播算法"><a class="markdownIt-Anchor" href="#反向传播算法">#</a> 反向传播算法</h3><p>根据前向传播计算的输出与损失函数，根据链式法则推导，根据梯度下降更新神经网络，然后不断迭代得到最终的神经网络模型</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>z</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><msup><mi>W</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo></mrow></msup><mo>∗</mo><msup><mi>a</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msup><mo>+</mo><msup><mi>b</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">z^{(l)}=W^{(l)} *a^{(l-1)}+b^{(l)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.938em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.938em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.0213299999999998em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.938em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>a</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mi>σ</mi><mo stretchy="false">(</mo><mi>z</mi><msup><mo stretchy="false">)</mo><mrow><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">a^{(l)}=σ(z)^{(l)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.938em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.188em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></span></p><p>感兴趣的可以看：<a href="https://zhuanlan.zhihu.com/p/71892752">https://zhuanlan.zhihu.com/p/71892752</a></p><h2 id="总结"><a class="markdownIt-Anchor" href="#总结">#</a> 总结</h2><ol><li>初始化权重 w 与偏置 b，</li><li>通过前向传播算法计算输出，</li><li>通过损失函数计算输出层的梯度</li><li>使用反向传播算法计算</li><li>通过梯度下降算法更新权重 w 与偏置 b</li><li>当所有的 w 与 b 的变化值都小于迭代阈值时结束循环</li><li>输出各隐藏层与输出层的线性关系系数矩阵 W 和偏置 b，得到确定的模型</li></ol>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> pytorch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pytorch环境</title>
      <link href="/2023/03/25/pytorch%E7%8E%AF%E5%A2%83/"/>
      <url>/2023/03/25/pytorch%E7%8E%AF%E5%A2%83/</url>
      
        <content type="html"><![CDATA[<p>深度学习，从 pytorch 开始<br> pytorch 中文手册<br><a href="https://github.com/zergtant/pytorch-handbook"> https://github.com/zergtant/pytorch-handbook</a></p><h1 id="linux下"><a class="markdownIt-Anchor" href="#linux下">#</a> Linux 下</h1><h2 id="安装anaconda"><a class="markdownIt-Anchor" href="#安装anaconda">#</a> 安装 Anaconda</h2><p>在 archlinux 下</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 完全版</span>yay <span class="token parameter variable">-S</span> annaconda<span class="token comment"># 本人安装的轻量版</span>yay <span class="token parameter variable">-S</span> miniconda<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>按照提示</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">If your shell is Bash or a Bourne variant, <span class="token builtin class-name">enable</span> conda <span class="token keyword">for</span> the current user with    $ <span class="token builtin class-name">source</span> /opt/miniconda/etc/profile.d/conda.shYou could also <span class="token function">add</span> the above line to <span class="token variable"><span class="token variable">`</span>~/.bashrc<span class="token variable">`</span></span>or, <span class="token keyword">for</span> all users, <span class="token builtin class-name">enable</span> conda with    $ <span class="token function">sudo</span> <span class="token function">ln</span> <span class="token parameter variable">-s</span> /opt/miniconda/etc/profile.d/conda.sh /etc/profile.d/conda.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在终端输入以下命令以启用 conda</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">source</span> /opt/miniconda/etc/profile.d/conda.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="创建conda环境"><a class="markdownIt-Anchor" href="#创建conda环境">#</a> 创建 conda 环境</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 查看 python 版本</span>python<span class="token comment"># 使用 exit() 或 Ctrl+D 退出 python 环境</span><span class="token comment"># 创建 conda 环境</span><span class="token comment"># ( our_envName 是你定义的环境名，这里使用 pytorch )</span><span class="token comment"># ( x.x 是指定的 python 版本，我这里是 3.10 )</span>conda create <span class="token parameter variable">-n</span> your_envName <span class="token assign-left variable">python</span><span class="token operator">=</span>x.x<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>激活环境</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 激活环境，pytorch 是你之前定义的环境名</span>conda activate pytorch<span class="token comment"># 取消激活状态</span>conda deactivate<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="安装pytorch"><a class="markdownIt-Anchor" href="#安装pytorch">#</a> 安装 pytorch</h2><p>如果需要换源：换清华源<br><a href="https://blog.csdn.net/weixin_42570192/article/details/124760665"> https://blog.csdn.net/weixin_42570192/article/details/124760665</a></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">conda config <span class="token parameter variable">--add</span> channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/conda config <span class="token parameter variable">--add</span> channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/conda config <span class="token parameter variable">--set</span> show_channel_urls <span class="token function">yes</span>conda config <span class="token parameter variable">--add</span> channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/pytorch/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>如果需要安装 cuda</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yay <span class="token parameter variable">-S</span> cuda<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这里不安装 cuda，选择 cpu, 在官网选择对应的安装命令复制粘贴</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">conda <span class="token function">install</span> pytorch torchvision torchaudio cpuonly <span class="token parameter variable">-c</span> pytorch <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>安装好 pytorch 后</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">import</span> torch<span class="token function">import</span> torchvision<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="更多操作命令"><a class="markdownIt-Anchor" href="#更多操作命令">#</a> 更多操作命令</h2><p><a href="https://blog.csdn.net/qq_38870718/article/details/122796306">https://blog.csdn.net/qq_38870718/article/details/122796306</a></p><h1 id="windows下"><a class="markdownIt-Anchor" href="#windows下">#</a> Windows 下</h1><p>windows 在虚拟机里用 linux 感觉挺卡的，直接用 windows 算了</p><h2 id="安装anaconda-2"><a class="markdownIt-Anchor" href="#安装anaconda-2">#</a> 安装 Anaconda</h2><h3 id="安装配置"><a class="markdownIt-Anchor" href="#安装配置">#</a> 安装配置</h3><p>镜像站：<br><a href="https://repo.anaconda.com/archive/">https://repo.anaconda.com/archive/</a></p><p>安装后添加环境变量:</p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">D:\anaconda3D:\anaconda3\ScriptsD:\anaconda3\Library\bin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>其中 <code>D:\anaconda3</code>  是选择的 Anaconda 安装路径</p><h3 id="修改镜像源配置"><a class="markdownIt-Anchor" href="#修改镜像源配置">#</a> 修改镜像源配置</h3><p>清华源</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">conda config <span class="token parameter variable">--add</span> channels http://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/win-64/conda config <span class="token parameter variable">--add</span> channels http://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/win-64/conda config <span class="token parameter variable">--set</span> show_channel_urls <span class="token function">yes</span>conda config <span class="token parameter variable">--add</span> channels http://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/pytorch/win-64/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>如果要恢复原来的默认配置</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">conda config --remove-key channels<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="创建虚拟环境"><a class="markdownIt-Anchor" href="#创建虚拟环境">#</a> 创建虚拟环境</h3><p>创建环境:<br> 命令 python 可以查看 python 版本，命令 exit () 退出 python 环境</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">conda create <span class="token parameter variable">-n</span> pytorch_cpu <span class="token assign-left variable">python</span><span class="token operator">=</span><span class="token number">3.10</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>命令 python 可以查看 python 版本，命令 exit () 退出 python 环境<br>激活环境:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">activate pytorch<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>退出激活环境:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">deactivate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="安装pytorch-2"><a class="markdownIt-Anchor" href="#安装pytorch-2">#</a> 安装 pytorch</h2><p>官网: <a href="https://pytorch.org/">https://pytorch.org/</a><br> 根据环境选择版本，选择 stable-windows-conda-python-none，此配置下的安装命令:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">conda <span class="token function">install</span> pytorch torchvision torchaudio cpuonly <span class="token parameter variable">-c</span> pytorch<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>查看已安装的库</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">conda list<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="编辑器配置-vscode"><a class="markdownIt-Anchor" href="#编辑器配置-vscode">#</a> 编辑器配置 - vscode</h2><ul><li>安装 python 插件，其中包含 python 相关多个插件</li><li>选择编译环境:<ul><li>随便新建一个 python 文件</li><li>点击右下角 python 语言模式的右边选择解释器 (python.exe)</li></ul></li><li>注意：选择的是带’base’的那个！不是带’pytorch’的那个！它的路径应该为你的 Anaconda 安装根目录下的 python.exe，例如 D:\anaconda3\python.exe</li></ul><p>至此，环境配置完毕</p>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> pytorch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gorm 数据库操作</title>
      <link href="/2023/03/20/gorm%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C/"/>
      <url>/2023/03/20/gorm%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C/</url>
      
        <content type="html"><![CDATA[<h1 id="数据库连接"><a class="markdownIt-Anchor" href="#数据库连接">#</a> 数据库连接</h1><pre class="line-numbers language-go" data-language="go"><code class="language-go">dsn<span class="token operator">:=</span><span class="token string">"host=localhost user=postgres password=123456 dbname=iot-platform port=5432 sslmode=disable TimeZone=Asia/Shanghai"</span>db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>postgres<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>dsn<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h1 id="数据模型定义"><a class="markdownIt-Anchor" href="#数据模型定义">#</a> 数据模型定义</h1><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> UserBasic <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>    gorm<span class="token punctuation">.</span>Model    Name <span class="token builtin">string</span>    Age <span class="token builtin">int</span><span class="token punctuation">&#125;</span><span class="token keyword">func</span> <span class="token punctuation">(</span>table UserBasic<span class="token punctuation">)</span><span class="token function">TableName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token string">"user_basic"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="数据模型-数据表映射"><a class="markdownIt-Anchor" href="#数据模型-数据表映射">#</a> 数据模型 - 数据表映射</h1><pre class="line-numbers language-go" data-language="go"><code class="language-go">db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>UserBasic<span class="token punctuation">,</span><span class="token operator">...</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="crud"><a class="markdownIt-Anchor" href="#crud">#</a> CRUD</h1><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// 创建记录</span>user <span class="token operator">:=</span> User<span class="token punctuation">&#123;</span>Name<span class="token punctuation">:</span> <span class="token string">"John"</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">&#125;</span>db<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token comment">// 查询记录</span><span class="token keyword">var</span> users <span class="token punctuation">[</span><span class="token punctuation">]</span>Userdb<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>db<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">// 更新记录</span>user<span class="token punctuation">.</span>Name <span class="token operator">=</span> <span class="token string">"Tom"</span>db<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token comment">// 删除记录</span>db<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="原生sql"><a class="markdownIt-Anchor" href="#原生sql">#</a> 原生 SQL</h1><pre class="line-numbers language-go" data-language="go"><code class="language-go">rows<span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Raw</span><span class="token punctuation">(</span><span class="token string">"SELECT name, age FROM users WHERE age > ?"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Rows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">defer</span> rows<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">for</span> rows<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> name <span class="token builtin">string</span>    <span class="token keyword">var</span> age <span class="token builtin">int</span>    rows<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>name<span class="token punctuation">,</span> <span class="token operator">&amp;</span>age<span class="token punctuation">)</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="事务"><a class="markdownIt-Anchor" href="#事务">#</a> 事务</h1><pre class="line-numbers language-go" data-language="go"><code class="language-go">tx <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 在事务中执行操作</span><span class="token keyword">if</span> err <span class="token operator">:=</span> tx<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">&#123;</span>Name<span class="token punctuation">:</span> <span class="token string">"John"</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Error<span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 发生错误时回滚事务</span>    tx<span class="token punctuation">.</span><span class="token function">Rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">// 成功时提交事务</span>tx<span class="token punctuation">.</span><span class="token function">Commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="联合查询"><a class="markdownIt-Anchor" href="#联合查询">#</a> 联合查询</h1><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">var</span> user User<span class="token keyword">var</span> email Emaildb<span class="token punctuation">.</span><span class="token function">Joins</span><span class="token punctuation">(</span><span class="token string">"JOIN emails ON users.id = emails.user_id"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">"users.name = ?"</span><span class="token punctuation">,</span> <span class="token string">"John"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">,</span> <span class="token operator">&amp;</span>email<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git大全</title>
      <link href="/2023/03/13/git%E5%A4%A7%E5%85%A8/"/>
      <url>/2023/03/13/git%E5%A4%A7%E5%85%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="拉取"><a class="markdownIt-Anchor" href="#拉取">#</a> 拉取</h1><h2 id="git-clone"><a class="markdownIt-Anchor" href="#git-clone">#</a> git clone:</h2><p>有无权限均可拉取，从 0 到 1，本地无代码才能用</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 克隆默认分支</span><span class="token function">git</span> clone <span class="token operator">&lt;</span>远程仓库地址.git<span class="token operator">></span><span class="token comment"># 克隆指定分支</span><span class="token function">git</span> clone <span class="token parameter variable">-b</span> <span class="token operator">&lt;</span>远程分支名<span class="token operator">></span> <span class="token operator">&lt;</span>远程仓库地址.git<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="git-pull"><a class="markdownIt-Anchor" href="#git-pull">#</a> git pull:</h2><p>有权限才能拉取，更新代码时使用</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> init<span class="token comment"># 关联远程仓库，可关联多个仓库，origin会设置为仓库名</span><span class="token comment"># 跳过这一步执行 git pull 也可以拉取</span><span class="token function">git</span> remote <span class="token function">add</span> origin <span class="token operator">&lt;</span>远程仓库地址.git<span class="token operator">></span><span class="token comment"># 可选：设置多个远程地址，origin为仓库名</span><span class="token function">git</span> remote set-url <span class="token parameter variable">--add</span> origin <span class="token operator">&lt;</span>远程仓库地址2.git<span class="token operator">></span><span class="token comment"># 拉取远程分支到某个本地分支</span><span class="token function">git</span> pull <span class="token operator">&lt;</span>远程仓库地址.git<span class="token operator">></span> <span class="token operator">&lt;</span>远程分支名<span class="token operator">></span>:<span class="token operator">&lt;</span>本地分支名<span class="token operator">></span><span class="token comment"># 本地分支名可忽略，默认为拉取到当前分支</span><span class="token function">git</span> pull <span class="token operator">&lt;</span>远程仓库地址.git<span class="token operator">></span> <span class="token operator">&lt;</span>远程分支名<span class="token operator">></span><span class="token comment"># 可选:移除远程仓库关联</span><span class="token function">git</span> remote remove <span class="token operator">&lt;</span>远程仓库地址.git<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="提交-git-push"><a class="markdownIt-Anchor" href="#提交-git-push">#</a> 提交 - git push</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># git初始化，添加 .git 文件</span><span class="token function">git</span> init<span class="token comment"># 将文件提交到暂存区</span><span class="token function">git</span> <span class="token function">add</span> <span class="token builtin class-name">.</span><span class="token comment"># commit</span><span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token operator">&lt;</span>commit的内容<span class="token operator">></span><span class="token comment"># 可选:新建分支</span><span class="token function">git</span> branch <span class="token operator">&lt;</span>分支名<span class="token operator">></span><span class="token comment"># 可选:切换到分支</span><span class="token function">git</span> checkout <span class="token operator">&lt;</span>分支名<span class="token operator">></span><span class="token comment"># 提交前，如未与远程仓库关联则先与远程仓库关联</span><span class="token comment"># 仓库名一般用 origin </span><span class="token function">git</span> remote <span class="token function">add</span> <span class="token operator">&lt;</span>仓库名<span class="token operator">></span> <span class="token operator">&lt;</span>远程仓库地址.git<span class="token operator">></span><span class="token comment"># 以当前分支提交到远程分支</span><span class="token function">git</span> push <span class="token parameter variable">-u</span> <span class="token operator">&lt;</span>仓库名<span class="token operator">></span> <span class="token operator">&lt;</span>远程分支名<span class="token operator">></span><span class="token comment"># 可选:指定本地分支提交到远程分支</span><span class="token function">git</span> push <span class="token parameter variable">-u</span> <span class="token operator">&lt;</span>仓库名<span class="token operator">></span> <span class="token operator">&lt;</span>本地分支名<span class="token operator">></span>:<span class="token operator">&lt;</span>远程分支名<span class="token operator">></span><span class="token comment"># 如出现冲突则先git pull拉取，解决冲突再提交</span><span class="token comment"># git 拉取，没有指定分支则拉取默认分支</span><span class="token function">git</span> pull <span class="token operator">&lt;</span>远程仓库地址.git<span class="token operator">></span> <span class="token operator">&lt;</span>远程分支名<span class="token operator">></span><span class="token comment"># 允许拉取非关联的仓库</span><span class="token function">git</span> pull <span class="token operator">&lt;</span>远程仓库地址.git<span class="token operator">></span> <span class="token operator">&lt;</span>远程分支名<span class="token operator">></span> --allow-unrelated-histories<span class="token comment"># 根据提示手动修改冲突文件</span><span class="token comment"># 从git add开始重来 git 提交流程</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="删除-git-rm"><a class="markdownIt-Anchor" href="#删除-git-rm">#</a> 删除 - git rm</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 查看文件</span><span class="token function">dir</span><span class="token comment"># 删除指定文件</span><span class="token function">git</span> <span class="token function">rm</span>  <span class="token operator">&lt;</span>文件<span class="token operator">></span><span class="token comment"># 删除指定文件夹</span><span class="token function">git</span> <span class="token function">rm</span> <span class="token parameter variable">-r</span> <span class="token operator">&lt;</span>文件夹<span class="token operator">></span><span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">""</span><span class="token function">git</span> push<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="暂存-git-add"><a class="markdownIt-Anchor" href="#暂存-git-add">#</a> 暂存 - git add</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#保存所有的修改,包括删除</span><span class="token function">git</span> <span class="token function">add</span> <span class="token parameter variable">-A</span>  <span class="token comment"># 保存新的添加和修改，但是不包括删除</span><span class="token function">git</span> <span class="token function">add</span> <span class="token builtin class-name">.</span> <span class="token comment">#保存修改和删除，但是不包括新建文件</span><span class="token function">git</span> <span class="token function">add</span> <span class="token parameter variable">-u</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="覆盖"><a class="markdownIt-Anchor" href="#覆盖">#</a> 覆盖</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 以远程仓库为准</span><span class="token comment"># 拉取所有更新，不同步</span><span class="token function">git</span> fetch <span class="token parameter variable">--all</span><span class="token comment"># 本地代码同步线上最新版本(会覆盖本地所有与远程仓库上同名的文件)；</span><span class="token function">git</span> reset <span class="token parameter variable">--hard</span> origin/master<span class="token comment"># 以本地仓库为准</span><span class="token comment"># 强制推送到远程仓库，并覆盖远程代码库</span><span class="token function">git</span> push <span class="token parameter variable">-f</span> --set-upstream origin master:master<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="合并-git-merge"><a class="markdownIt-Anchor" href="#合并-git-merge">#</a> 合并 - git merge</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> merge <span class="token operator">&lt;</span>远程分支名<span class="token operator">></span> --allow-unrelated-histories<span class="token comment"># 出现冲突，解决冲突</span><span class="token comment"># 添加冲突文件</span><span class="token function">git</span> <span class="token function">add</span> <span class="token builtin class-name">.</span><span class="token comment"># 然后继续合并</span><span class="token function">git</span> merge <span class="token parameter variable">--continue</span><span class="token comment"># 如果放弃合并则</span><span class="token function">git</span> merge <span class="token parameter variable">--abort</span><span class="token comment"># 再推送</span><span class="token function">git</span> push<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="迁移"><a class="markdownIt-Anchor" href="#迁移">#</a> 迁移</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 裸仓库</span><span class="token function">git</span> clone <span class="token parameter variable">--bare</span> xxx<span class="token comment"># 或镜像仓库</span><span class="token function">git</span> clone <span class="token parameter variable">--mirror</span> xxx<span class="token comment"># 关联另一个仓库</span><span class="token function">git</span> remote <span class="token function">add</span> remote2 xxx <span class="token comment"># 推送到另一个仓库</span>$ <span class="token function">git</span> push <span class="token parameter variable">--mirror</span> remote2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于 string、rune 与 byte</title>
      <link href="/2023/03/13/%E5%85%B3%E4%BA%8Estring%E3%80%81rune%E4%B8%8Ebyte/"/>
      <url>/2023/03/13/%E5%85%B3%E4%BA%8Estring%E3%80%81rune%E4%B8%8Ebyte/</url>
      
        <content type="html"><![CDATA[<h1 id="关于引号"><a class="markdownIt-Anchor" href="#关于引号">#</a> 关于引号</h1><p><code>&quot;&quot;</code> : 双引号，包裹的类型是 string<br> <code>''</code> : 单引号，包裹的类型是 rune,rune 是 int32 的别名，只能是单个字符<br> <code>``</code> : 反引号，包裹的类型是 string</p><ol><li><code>``</code>  不会解析转义符， <code>&quot;&quot;</code>  会解析转义符</li><li>在编辑器里 <code>``</code>  中 可以回车换行</li><li>使用 <code>&quot;&quot;</code>  时不管有没有转义符都会遍历字符数组一遍寻找转义符，而使用 <code>``</code>  则是直接输出，所以 <code>``</code>  性能好一点</li></ol><pre class="line-numbers language-go" data-language="go"><code class="language-go">char1 <span class="token operator">:=</span> <span class="token string">"A"</span>char2 <span class="token operator">:=</span> <span class="token char">'A'</span>char3 <span class="token operator">:=</span> <span class="token string">`A`</span>char4 <span class="token operator">:=</span> <span class="token string">"asd\nfghjkl"</span><span class="token comment">//在编辑器里这串字符换行后有两个缩进</span>char5 <span class="token operator">:=</span> <span class="token string">`asd\nfgnhjkl`</span><span class="token comment">// char4:='AB' 不行，只能单个字符</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"char1:%v(类型:%T)\n"</span><span class="token punctuation">,</span> char1<span class="token punctuation">,</span> char1<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"char2:%v(类型:%T)\n"</span><span class="token punctuation">,</span> char2<span class="token punctuation">,</span> char2<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"char3:%v(类型:%T)\n"</span><span class="token punctuation">,</span> char3<span class="token punctuation">,</span> char3<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"char4:%v(类型:%T)\n"</span><span class="token punctuation">,</span> char4<span class="token punctuation">,</span> char4<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"char5:%v(类型:%T)\n"</span><span class="token punctuation">,</span> char5<span class="token punctuation">,</span> char5<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-go" data-language="go"><code class="language-go">char1<span class="token punctuation">:</span><span class="token function">A</span><span class="token punctuation">(</span>类型<span class="token punctuation">:</span><span class="token builtin">string</span><span class="token punctuation">)</span>char2<span class="token punctuation">:</span><span class="token function">65</span><span class="token punctuation">(</span>类型<span class="token punctuation">:</span><span class="token builtin">int32</span><span class="token punctuation">)</span>char3<span class="token punctuation">:</span><span class="token function">A</span><span class="token punctuation">(</span>类型<span class="token punctuation">:</span><span class="token builtin">string</span><span class="token punctuation">)</span>char4<span class="token punctuation">:</span>asd<span class="token function">fghjkl</span><span class="token punctuation">(</span>类型<span class="token punctuation">:</span><span class="token builtin">string</span><span class="token punctuation">)</span>char5<span class="token punctuation">:</span>asd\nfg<span class="token function">nhjkl</span><span class="token punctuation">(</span>类型<span class="token punctuation">:</span><span class="token builtin">string</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="byte-与-rune"><a class="markdownIt-Anchor" href="#byte-与-rune">#</a> byte 与 rune</h1><p>byte: unit8 的别名。代表 ASCII 码的一个字符（占一个字节）<br>rune: int32 的别名。用于标识 Unicode 字符，代表一个 UTF-8 字符 (占多个字节，例如英文字母占一个字节，中文汉字一般占三个字节)<br> 因为识别的字节数不一样，所以使用不同的处理方式结果会有所不同，请看下一小节</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">var</span> char1 <span class="token builtin">byte</span> <span class="token operator">=</span> <span class="token char">'A'</span>char2 <span class="token operator">:=</span> <span class="token char">'A'</span><span class="token comment">// 默认是 int32/rune</span><span class="token keyword">var</span> char3 <span class="token builtin">byte</span> <span class="token operator">=</span> <span class="token number">65</span><span class="token keyword">var</span> char4 <span class="token builtin">byte</span> <span class="token operator">=</span> <span class="token char">'\x41'</span><span class="token keyword">var</span> char5 <span class="token builtin">byte</span> <span class="token operator">=</span> <span class="token char">'\101'</span><span class="token comment">// %c:字符的unicode码值; %T：变量的类型; %v:值的默认格式; %U:表示为Unicode格式</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"char1:%c(类型:%T)(%v)(%U)\n"</span><span class="token punctuation">,</span> char1<span class="token punctuation">,</span> char1<span class="token punctuation">,</span>char1<span class="token punctuation">,</span>char1<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"char2:%c(类型:%T)(%v)\n"</span><span class="token punctuation">,</span> char2<span class="token punctuation">,</span> char2<span class="token punctuation">,</span>char2<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"char3:%c(类型:%T)(%v)\n"</span><span class="token punctuation">,</span> char3<span class="token punctuation">,</span> char3<span class="token punctuation">,</span>char3<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"char4:%c(类型:%T)(%v)\n"</span><span class="token punctuation">,</span> char4<span class="token punctuation">,</span> char4<span class="token punctuation">,</span>char4<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"char5:%c(类型:%T)(%v)\n"</span><span class="token punctuation">,</span> char5<span class="token punctuation">,</span> char5<span class="token punctuation">,</span>char5<span class="token punctuation">)</span><span class="token keyword">var</span> char6 <span class="token builtin">rune</span> <span class="token operator">=</span><span class="token char">'\u0041'</span><span class="token keyword">var</span> char7 <span class="token builtin">int64</span><span class="token operator">=</span><span class="token char">'\U00000041'</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"char6:%c(类型:%T)(%v)(%U)\n"</span><span class="token punctuation">,</span> char6<span class="token punctuation">,</span> char6<span class="token punctuation">,</span>char6<span class="token punctuation">,</span>char6<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"char7:%c(类型:%T)(%v)(%U)\n"</span><span class="token punctuation">,</span> char7<span class="token punctuation">,</span> char7<span class="token punctuation">,</span>char7<span class="token punctuation">,</span>char7<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-go" data-language="go"><code class="language-go">char1<span class="token punctuation">:</span><span class="token function">A</span><span class="token punctuation">(</span>类型<span class="token punctuation">:</span><span class="token builtin">uint8</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">65</span><span class="token punctuation">)</span><span class="token punctuation">(</span>U<span class="token operator">+</span><span class="token number">0041</span><span class="token punctuation">)</span>char2<span class="token punctuation">:</span><span class="token function">A</span><span class="token punctuation">(</span>类型<span class="token punctuation">:</span><span class="token builtin">int32</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">65</span><span class="token punctuation">)</span>char3<span class="token punctuation">:</span><span class="token function">A</span><span class="token punctuation">(</span>类型<span class="token punctuation">:</span><span class="token builtin">uint8</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">65</span><span class="token punctuation">)</span>char4<span class="token punctuation">:</span><span class="token function">A</span><span class="token punctuation">(</span>类型<span class="token punctuation">:</span><span class="token builtin">uint8</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">65</span><span class="token punctuation">)</span>char5<span class="token punctuation">:</span><span class="token function">A</span><span class="token punctuation">(</span>类型<span class="token punctuation">:</span><span class="token builtin">uint8</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">65</span><span class="token punctuation">)</span>char6<span class="token punctuation">:</span><span class="token function">A</span><span class="token punctuation">(</span>类型<span class="token punctuation">:</span><span class="token builtin">int32</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">65</span><span class="token punctuation">)</span><span class="token punctuation">(</span>U<span class="token operator">+</span><span class="token number">0041</span><span class="token punctuation">)</span>char7<span class="token punctuation">:</span><span class="token function">A</span><span class="token punctuation">(</span>类型<span class="token punctuation">:</span><span class="token builtin">int64</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">65</span><span class="token punctuation">)</span><span class="token punctuation">(</span>U<span class="token operator">+</span><span class="token number">0041</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="string"><a class="markdownIt-Anchor" href="#string">#</a> string</h1><h2 id="字符数组"><a class="markdownIt-Anchor" href="#字符数组">#</a> 字符数组</h2><p>string 的底层是字符数组</p><p>使用传统的 <code>for-i++</code>  循环时会按 ASCII 处理，按 unit8 的格式进行解析，得到的是 [] byte;</p><p>使用 <code>for-range</code>  循环时则是按 int32 的格式进行解析，得到的是 [] rune;</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">str <span class="token operator">:=</span> <span class="token string">"goの世界"</span><span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">len</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span><span class="token comment">// byte/unit8类型，按 ASCII 处理,会有乱码</span>    <span class="token comment">// %c:字符的unicode码值; %T：变量的类型; %v:值的默认格式; %U:表示为Unicode格式</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"str[%v]:%c(类型:%T)(%U)\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> str<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> str<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> str<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"--------"</span><span class="token punctuation">)</span><span class="token keyword">for</span> i<span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> str <span class="token punctuation">&#123;</span><span class="token comment">// rune/int32类型,按 UTF-8 处理</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"str[%v]:%c(类型:%T)(%U)\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> v<span class="token punctuation">,</span> v<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">&#125;</span>str1 <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>str2 <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">rune</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"str1:%c,%v,%U\n"</span><span class="token punctuation">,</span> str1<span class="token punctuation">,</span> str1<span class="token punctuation">,</span> str1<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"str2:%c,%v,%U\n"</span><span class="token punctuation">,</span> str2<span class="token punctuation">,</span> str2<span class="token punctuation">,</span> str2<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"str的ASCII长度:%v\n"</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"str的UTF-8长度:%v\n"</span><span class="token punctuation">,</span> utf8<span class="token punctuation">.</span><span class="token function">RuneCountInString</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-go" data-language="go"><code class="language-go">str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token function">g</span><span class="token punctuation">(</span>类型<span class="token punctuation">:</span><span class="token builtin">uint8</span><span class="token punctuation">)</span><span class="token punctuation">(</span>U<span class="token operator">+</span><span class="token number">0067</span><span class="token punctuation">)</span>str<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token function">o</span><span class="token punctuation">(</span>类型<span class="token punctuation">:</span><span class="token builtin">uint8</span><span class="token punctuation">)</span><span class="token punctuation">(</span>U<span class="token operator">+</span>006F<span class="token punctuation">)</span>str<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">:</span>ã<span class="token punctuation">(</span>类型<span class="token punctuation">:</span><span class="token builtin">uint8</span><span class="token punctuation">)</span><span class="token punctuation">(</span>U<span class="token operator">+</span><span class="token number">00E3</span><span class="token punctuation">)</span>str<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token punctuation">(</span>类型<span class="token punctuation">:</span><span class="token builtin">uint8</span><span class="token punctuation">)</span><span class="token punctuation">(</span>U<span class="token operator">+</span><span class="token number">0081</span><span class="token punctuation">)</span>str<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">:</span>®<span class="token punctuation">(</span>类型<span class="token punctuation">:</span><span class="token builtin">uint8</span><span class="token punctuation">)</span><span class="token punctuation">(</span>U<span class="token operator">+</span>00AE<span class="token punctuation">)</span>str<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">:</span>ä<span class="token punctuation">(</span>类型<span class="token punctuation">:</span><span class="token builtin">uint8</span><span class="token punctuation">)</span><span class="token punctuation">(</span>U<span class="token operator">+</span><span class="token number">00E4</span><span class="token punctuation">)</span>str<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">:</span>¸<span class="token punctuation">(</span>类型<span class="token punctuation">:</span><span class="token builtin">uint8</span><span class="token punctuation">)</span><span class="token punctuation">(</span>U<span class="token operator">+</span>00B8<span class="token punctuation">)</span>str<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token punctuation">(</span>类型<span class="token punctuation">:</span><span class="token builtin">uint8</span><span class="token punctuation">)</span><span class="token punctuation">(</span>U<span class="token operator">+</span><span class="token number">0096</span><span class="token punctuation">)</span>str<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">:</span>ç<span class="token punctuation">(</span>类型<span class="token punctuation">:</span><span class="token builtin">uint8</span><span class="token punctuation">)</span><span class="token punctuation">(</span>U<span class="token operator">+</span><span class="token number">00E7</span><span class="token punctuation">)</span>str<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token punctuation">(</span>类型<span class="token punctuation">:</span><span class="token builtin">uint8</span><span class="token punctuation">)</span><span class="token punctuation">(</span>U<span class="token operator">+</span><span class="token number">0095</span><span class="token punctuation">)</span>str<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token punctuation">(</span>类型<span class="token punctuation">:</span><span class="token builtin">uint8</span><span class="token punctuation">)</span><span class="token punctuation">(</span>U<span class="token operator">+</span>008C<span class="token punctuation">)</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token function">g</span><span class="token punctuation">(</span>类型<span class="token punctuation">:</span><span class="token builtin">int32</span><span class="token punctuation">)</span><span class="token punctuation">(</span>U<span class="token operator">+</span><span class="token number">0067</span><span class="token punctuation">)</span>str<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token function">o</span><span class="token punctuation">(</span>类型<span class="token punctuation">:</span><span class="token builtin">int32</span><span class="token punctuation">)</span><span class="token punctuation">(</span>U<span class="token operator">+</span>006F<span class="token punctuation">)</span>str<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">:</span>の<span class="token punctuation">(</span>类型<span class="token punctuation">:</span><span class="token builtin">int32</span><span class="token punctuation">)</span><span class="token punctuation">(</span>U<span class="token operator">+</span>306E<span class="token punctuation">)</span>str<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">:</span>世<span class="token punctuation">(</span>类型<span class="token punctuation">:</span><span class="token builtin">int32</span><span class="token punctuation">)</span><span class="token punctuation">(</span>U<span class="token operator">+</span><span class="token number">4E16</span><span class="token punctuation">)</span>str<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">:</span>界<span class="token punctuation">(</span>类型<span class="token punctuation">:</span><span class="token builtin">int32</span><span class="token punctuation">)</span><span class="token punctuation">(</span>U<span class="token operator">+</span>754C<span class="token punctuation">)</span>str1<span class="token punctuation">:</span><span class="token punctuation">[</span>g o ã  ® ä ¸  ç  <span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">103</span> <span class="token number">111</span> <span class="token number">227</span> <span class="token number">129</span> <span class="token number">174</span> <span class="token number">228</span> <span class="token number">184</span> <span class="token number">150</span> <span class="token number">231</span> <span class="token number">149</span> <span class="token number">140</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>U<span class="token operator">+</span><span class="token number">0067</span> U<span class="token operator">+</span>006F U<span class="token operator">+</span><span class="token number">00E3</span> U<span class="token operator">+</span><span class="token number">0081</span> U<span class="token operator">+</span>00AE U<span class="token operator">+</span><span class="token number">00E4</span> U<span class="token operator">+</span>00B8 U<span class="token operator">+</span><span class="token number">0096</span> U<span class="token operator">+</span><span class="token number">00E7</span> U<span class="token operator">+</span><span class="token number">0095</span> U<span class="token operator">+</span>008C<span class="token punctuation">]</span>str2<span class="token punctuation">:</span><span class="token punctuation">[</span>g o の 世 界<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">103</span> <span class="token number">111</span> <span class="token number">12398</span> <span class="token number">19990</span> <span class="token number">30028</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>U<span class="token operator">+</span><span class="token number">0067</span> U<span class="token operator">+</span>006F U<span class="token operator">+</span>306E U<span class="token operator">+</span><span class="token number">4E16</span> U<span class="token operator">+</span>754C<span class="token punctuation">]</span>str的ASCII长度<span class="token punctuation">:</span><span class="token number">11</span>str的UTF<span class="token operator">-</span><span class="token number">8</span>长度<span class="token punctuation">:</span><span class="token number">5</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>分割为 [] byte 字符数组自然显示不了 UTF-8 编码的字符，就会出现乱码。分割为 [] rune 字符数组才是按 UTF-8 处理的<br> <code>g</code>  和 <code>o</code>  分别由 str [0] 和 str [1] 表示；<br> <code>の</code> 由 str [2]、str [3] 和 str [4] 表示；<br> <code>世</code> 由 str [5]、str [6] 和 str [7] 表示；<br> <code>界</code> 由 str [8]、str [9] 和 str [10] 表示。</p><h2 id="修改string"><a class="markdownIt-Anchor" href="#修改string">#</a> 修改 string</h2><p>对一个字符串 str，要修改其中某个字符，类似 str [i]='A’这种修改方式是不行的。<br>虽说字符串可以当成字符数组来处理，但字符串的本质是有一个指针指向其底层的字符数组的，上述的修改方式并不会修改它的底层数组。<br>当然直接 str=&quot;newString&quot; 直接替换掉 str 指向的字符数组也是可以的，不过这里讨论一下只替换部分字符</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// string --> []byte -->string</span>s1<span class="token operator">:=</span><span class="token string">"wasd"</span>s2<span class="token operator">:=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span>s2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token char">'W'</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//Wasd</span><span class="token comment">// string --> []rune -->string</span>s3<span class="token operator">:=</span><span class="token string">"早上好"</span>s4<span class="token operator">:=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">rune</span><span class="token punctuation">(</span>s3<span class="token punctuation">)</span>s4<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token char">'晚'</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>s4<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//晚上好</span><span class="token comment">// strings中的方法</span>s5 <span class="token operator">:=</span> <span class="token string">"abcdab"</span>old <span class="token operator">:=</span> <span class="token string">"ab"</span><span class="token builtin">new</span> <span class="token operator">:=</span><span class="token string">"AB"</span><span class="token comment">// 把s5里old的字符换成new的字符，第四个参数是替换次数，-1是全部替换</span>s6 <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> old<span class="token punctuation">,</span> <span class="token builtin">new</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>s4<span class="token punctuation">)</span> <span class="token comment">//ABcdAB</span><span class="token comment">// 全部替换，将指针指向其他字符数组</span>str<span class="token operator">:=</span><span class="token string">"abcd"</span>str<span class="token operator">=</span><span class="token string">"ABcd"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JSON</title>
      <link href="/2023/03/06/JSON/"/>
      <url>/2023/03/06/JSON/</url>
      
        <content type="html"><![CDATA[<h2 id="struct-与-json-的序列反序列化"><a class="markdownIt-Anchor" href="#struct-与-json-的序列反序列化">#</a> struct 与 json 的序列 / 反序列化</h2><p>结构体</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> Person <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>Name   <span class="token builtin">string</span>  Age    <span class="token builtin">int</span>     Weight <span class="token builtin">float64</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>json</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>       <span class="token property">"Name"</span><span class="token operator">:</span><span class="token string">"小明"</span><span class="token punctuation">,</span>    <span class="token property">"Age"</span><span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">,</span>    <span class="token property">"Weight"</span><span class="token operator">:</span><span class="token number">66.6</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>将结构体序列化为 json</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// 将结构体序列化为json</span><span class="token keyword">func</span> json<span class="token punctuation">.</span><span class="token function">Marshal</span><span class="token punctuation">(</span>v any<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span><span class="token comment">// 将json反序列化为结构体</span><span class="token keyword">func</span> json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>data <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> v any<span class="token punctuation">)</span> <span class="token builtin">error</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>Unmarshal () 接收的是 <code>[]byte</code>  类型参数，其他类型需要使用 <code>[]byte()</code>  进行转换；同样的， Marshal () 输出的也是 <code>[]byte</code>  类型</p><h2 id="tag-标签"><a class="markdownIt-Anchor" href="#tag-标签">#</a> tag 标签</h2><h3 id="指定字段名"><a class="markdownIt-Anchor" href="#指定字段名">#</a> 指定字段名</h3><p>将结构体解析后输出的字段名改为标签中的名称，比如 go 中变量公开要首字母大写，需要将其序列化后的字段为小写。<br>fmt 格式化输出中的 % s 占位符是自动转换为 string 再输出</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> Person <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>Name   <span class="token builtin">string</span>  <span class="token string">`json:"name"`</span>Age    <span class="token builtin">int</span>     <span class="token string">`json:"age"`</span>Weight <span class="token builtin">float64</span> <span class="token string">`json:"weight"`</span><span class="token punctuation">&#125;</span><span class="token keyword">func</span> main<span class="token punctuation">&#123;</span>   <span class="token comment">// 结构体转json</span>p1 <span class="token operator">:=</span> Person<span class="token punctuation">&#123;</span>Name<span class="token punctuation">:</span>   <span class="token string">"小明"</span><span class="token punctuation">,</span>Age<span class="token punctuation">:</span>    <span class="token number">18</span><span class="token punctuation">,</span>Weight<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span>b<span class="token punctuation">,</span>err<span class="token operator">:=</span>json<span class="token punctuation">.</span><span class="token function">Marshal</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>fmt<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">&#125;</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"str:%s\n"</span><span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token comment">// json转结构体</span><span class="token keyword">var</span> p2 Personerr<span class="token operator">=</span>json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token operator">&amp;</span>p2<span class="token punctuation">)</span><span class="token keyword">if</span> err<span class="token operator">!=</span><span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">&#125;</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"p2:%#v\n"</span><span class="token punctuation">,</span>p2<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>    <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"小明"</span><span class="token punctuation">,</span>    <span class="token property">"age"</span><span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">,</span>    <span class="token property">"weight"</span><span class="token operator">:</span><span class="token number">66.6</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="忽略字段"><a class="markdownIt-Anchor" href="#忽略字段">#</a> 忽略字段</h3><p>添加 tag 以忽略某些字段<br> <code>&quot;-&quot;</code> : 指定 json 序列化 / 反序列化时忽略此字段<br> <code>&quot;omitempty&quot;</code> : 字段值为空时 (不是零值，是没有该字段)，序列化 / 反序列化时忽略此字段</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> Person <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>Name   <span class="token builtin">string</span>  <span class="token string">`json:"name"`</span>            <span class="token comment">// 指定序列化/反序列化的字段名</span>Age    <span class="token builtin">int</span>     <span class="token string">`json:"age,omitempty"`</span>   <span class="token comment">// 若字段值为空,序列化/反序列化时忽略此字段</span>Weight <span class="token builtin">float64</span> <span class="token string">`json:"-"`</span>               <span class="token comment">// 序列化/反序列化时忽略此字段</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="嵌套结构体"><a class="markdownIt-Anchor" href="#嵌套结构体">#</a> 嵌套结构体</h3><h4 id="解析为单层json"><a class="markdownIt-Anchor" href="#解析为单层json">#</a> 解析为单层 json</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>Name    <span class="token builtin">string</span>   <span class="token string">`json:"name"`</span>Email   <span class="token builtin">string</span>   <span class="token string">`json:"email"`</span>Hobby   <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token string">`json:"hobby"`</span>Profile <span class="token punctuation">&#125;</span><span class="token keyword">type</span> Profile <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>Website <span class="token builtin">string</span> <span class="token string">`json:"site"`</span>Slogan  <span class="token builtin">string</span> <span class="token string">`json:"slogan"`</span><span class="token punctuation">&#125;</span>u1 <span class="token operator">:=</span> User<span class="token punctuation">&#123;</span>Name<span class="token punctuation">:</span>  <span class="token string">"小明"</span><span class="token punctuation">,</span>Hobby<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">&#123;</span><span class="token string">"足球"</span><span class="token punctuation">,</span> <span class="token string">"篮球"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>    <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"小明"</span><span class="token punctuation">,</span>    <span class="token property">"email"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span>    <span class="token property">"hobby"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"足球"</span><span class="token punctuation">,</span><span class="token string">"篮球"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"site"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span>    <span class="token property">"slogan"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="解析为多层嵌套json"><a class="markdownIt-Anchor" href="#解析为多层嵌套json">#</a> 解析为多层嵌套 json</h4><p>只需要添加给嵌套的字段 json 标签</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>Name    <span class="token builtin">string</span>   <span class="token string">`json:"name"`</span>Email   <span class="token builtin">string</span>   <span class="token string">`json:"email"`</span>Hobby   <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token string">`json:"hobby"`</span>Profile <span class="token string">`json:"profile"`</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>    <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"小明"</span><span class="token punctuation">,</span>    <span class="token property">"email"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span>    <span class="token property">"hobby"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"足球"</span><span class="token punctuation">,</span><span class="token string">"篮球"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"profile"</span><span class="token operator">:</span>        <span class="token punctuation">&#123;</span>            <span class="token property">"site"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span>            <span class="token property">"slogan"</span><span class="token operator">:</span><span class="token string">""</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="忽略嵌套结构体的空值"><a class="markdownIt-Anchor" href="#忽略嵌套结构体的空值">#</a> 忽略嵌套结构体的空值</h4><p>嵌套字段只使用 omitempty 标签是不行的，还需要加指针才能忽略空值情况</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>Name    <span class="token builtin">string</span>   <span class="token string">`json:"name"`</span>Email   <span class="token builtin">string</span>   <span class="token string">`json:"email,omitempty"`</span>Hobby   <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token string">`json:"hobby,omitempty"`</span><span class="token operator">*</span>Profile <span class="token string">`json:"profile,omitempty"`</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="不修改原结构体忽略空值字段"><a class="markdownIt-Anchor" href="#不修改原结构体忽略空值字段">#</a> 不修改原结构体忽略空值字段</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>Name     <span class="token builtin">string</span> <span class="token string">`json:"name"`</span>Password <span class="token builtin">string</span> <span class="token string">`json:"password"`</span><span class="token punctuation">&#125;</span><span class="token keyword">type</span> PublicUser <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span><span class="token operator">*</span>User             <span class="token comment">// 匿名嵌套</span>Password <span class="token operator">*</span><span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token string">`json:"password,omitempty"`</span><span class="token punctuation">&#125;</span><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>Name     <span class="token builtin">string</span> <span class="token string">`json:"name"`</span>Password <span class="token builtin">string</span> <span class="token string">`json:"password"`</span><span class="token punctuation">&#125;</span><span class="token keyword">type</span> PublicUser <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span><span class="token operator">*</span>User             <span class="token comment">// 匿名嵌套</span>Password <span class="token operator">*</span><span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token string">`json:"password,omitempty"`</span><span class="token punctuation">&#125;</span><span class="token keyword">func</span> <span class="token function">omitPasswordDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>u1 <span class="token operator">:=</span> User<span class="token punctuation">&#123;</span>Name<span class="token punctuation">:</span>     <span class="token string">"七米"</span><span class="token punctuation">,</span>Password<span class="token punctuation">:</span> <span class="token string">"123456"</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span>b<span class="token punctuation">,</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Marshal</span><span class="token punctuation">(</span>PublicUser<span class="token punctuation">&#123;</span>User<span class="token punctuation">:</span> <span class="token operator">&amp;</span>u1<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"json.Marshal u1 failed, err:%v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">&#125;</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"str:%s\n"</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span>  <span class="token comment">// str:&#123;"name":"七米"&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="字符串类型的数字解析"><a class="markdownIt-Anchor" href="#字符串类型的数字解析">#</a> 字符串类型的数字解析</h3><p>因为数据是 string 类型，所以不能对应相应数据类型的字段。使用 string 标签。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> Card <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>ID    <span class="token builtin">int64</span>   <span class="token string">`json:"id,string"`</span>    <span class="token comment">// 添加string tag</span>Score <span class="token builtin">float64</span> <span class="token string">`json:"score,string"`</span> <span class="token comment">// 添加string tag</span><span class="token punctuation">&#125;</span>jsonStr1 <span class="token operator">:=</span> <span class="token string">`&#123;"id": "1234567","score": "88.50"&#125;`</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>slice与map操作</title>
      <link href="/2023/03/06/slice%E4%B8%8Emap%E6%93%8D%E4%BD%9C/"/>
      <url>/2023/03/06/slice%E4%B8%8Emap%E6%93%8D%E4%BD%9C/</url>
      
        <content type="html"><![CDATA[<p><a href="https://github.com/unknwon/the-way-to-go_ZH_CN/blob/master/eBook/07.6.md">https://github.com/unknwon/the-way-to-go_ZH_CN/blob/master/eBook/07.6.md</a></p><h2 id="slice操作"><a class="markdownIt-Anchor" href="#slice操作">#</a> slice 操作</h2><h3 id="插入"><a class="markdownIt-Anchor" href="#插入">#</a> 插入</h3><ol><li>在切片 a 后追加元素 x</li></ol><pre class="line-numbers language-go" data-language="go"><code class="language-go">a<span class="token operator">=</span><span class="token function">append</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>在切片 a 后追加切片 b 的元素:</li></ol><pre class="line-numbers language-go" data-language="go"><code class="language-go">a<span class="token operator">=</span><span class="token function">append</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token operator">...</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="3"><li>将切片 a 的元素复制到切片 b:</li></ol><pre class="line-numbers language-go" data-language="go"><code class="language-go">b<span class="token operator">:=</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span><span class="token function">len</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token function">copy</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="4"><li>切片 a 扩展 m 个长度</li></ol><pre class="line-numbers language-go" data-language="go"><code class="language-go">a<span class="token operator">=</span><span class="token function">append</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="5"><li>在索引 i 处插入元素 x</li></ol><pre class="line-numbers language-go" data-language="go"><code class="language-go">a <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token punctuation">:</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">append</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>T<span class="token punctuation">&#123;</span>x<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span>i<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token operator">...</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="6"><li>在索引 i 处插入 j 长度的切片</li></ol><pre class="line-numbers language-go" data-language="go"><code class="language-go">a<span class="token operator">=</span><span class="token function">append</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token punctuation">:</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>T<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">,</span>a<span class="token punctuation">[</span>i<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token operator">...</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="7"><li>在索引 i 处插入切片 b 的所有元素</li></ol><pre class="line-numbers language-go" data-language="go"><code class="language-go">a<span class="token operator">=</span><span class="token function">append</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token punctuation">:</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token function">append</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>a<span class="token punctuation">[</span>i<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token operator">...</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="删除"><a class="markdownIt-Anchor" href="#删除">#</a> 删除</h3><ol><li>删除切片索引 i 的元素</li></ol><pre class="line-numbers language-go" data-language="go"><code class="language-go">a<span class="token operator">=</span><span class="token function">append</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token punctuation">:</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>a<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">...</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>删除切片索引 i 到 j 的元素:</li></ol><pre class="line-numbers language-go" data-language="go"><code class="language-go">a<span class="token operator">=</span><span class="token function">append</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token punctuation">:</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>a<span class="token punctuation">[</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">...</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="查询"><a class="markdownIt-Anchor" href="#查询">#</a> 查询</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// 索引i的元素</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token comment">// 切片的的长度</span><span class="token function">len</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token comment">// 切片a的容量</span><span class="token function">cap</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="排序"><a class="markdownIt-Anchor" href="#排序">#</a> 排序</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// 均为快速排序</span><span class="token comment">// a为int切片、b为float64切片、c为string切片</span><span class="token comment">// int类型的排序</span>sort<span class="token punctuation">.</span><span class="token function">Ints</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token comment">// float64类型的排序</span>sort<span class="token punctuation">.</span><span class="token function">Float64s</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token comment">// string类型的排序</span>sort<span class="token punctuation">.</span><span class="token function">Strings</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// 倒序</span>sort<span class="token punctuation">.</span><span class="token function">Sort</span><span class="token punctuation">(</span>sort<span class="token punctuation">.</span><span class="token function">Reverse</span><span class="token punctuation">(</span>sort<span class="token punctuation">.</span><span class="token function">IntSlice</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>sort<span class="token punctuation">.</span><span class="token function">Sort</span><span class="token punctuation">(</span>sort<span class="token punctuation">.</span><span class="token function">Reverse</span><span class="token punctuation">(</span>sort<span class="token punctuation">.</span><span class="token function">Float64Slice</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>sort<span class="token punctuation">.</span><span class="token function">Sort</span><span class="token punctuation">(</span>sort<span class="token punctuation">.</span><span class="token function">Reverse</span><span class="token punctuation">(</span>sort<span class="token punctuation">.</span><span class="token function">StringSlice</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="遍历"><a class="markdownIt-Anchor" href="#遍历">#</a> 遍历</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">for</span> i<span class="token punctuation">,</span>v<span class="token operator">:=</span><span class="token keyword">range</span> slice<span class="token punctuation">&#123;</span>   fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%d:%v\n"</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span>v<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="map操作"><a class="markdownIt-Anchor" href="#map操作">#</a> map 操作</h2><h3 id="插入和更新"><a class="markdownIt-Anchor" href="#插入和更新">#</a> 插入和更新</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">map</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token operator">=</span>value<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="删除-2"><a class="markdownIt-Anchor" href="#删除-2">#</a> 删除</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token function">delete</span><span class="token punctuation">(</span>mapName<span class="token punctuation">,</span>key<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="单个查询"><a class="markdownIt-Anchor" href="#单个查询">#</a> 单个查询</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go">value<span class="token punctuation">,</span>ok<span class="token operator">:=</span><span class="token keyword">map</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token keyword">if</span> ok<span class="token punctuation">&#123;</span>    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"存在/%v,值为%v"</span><span class="token punctuation">,</span>key<span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"不存在/%v"</span><span class="token punctuation">,</span>key<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="遍历-2"><a class="markdownIt-Anchor" href="#遍历-2">#</a> 遍历</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">for</span> i<span class="token punctuation">,</span>v<span class="token operator">:=</span><span class="token keyword">range</span> <span class="token keyword">map</span><span class="token punctuation">&#123;</span>    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%d:%v\n"</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span>v<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="关于string"><a class="markdownIt-Anchor" href="#关于string">#</a> 关于 string</h2><p>string 的结构本质上有两个字段，一个是指向底层字符数组的指针，一个是长度。我们可以将 string 认为是字符数组，可以使用切片的操作对 string 进行处理，在 strings 与 strconv 包中也有更方便的专门处理 string 的函数，详见字符串处理。<br>不过 go 中字符串是不可变的，如 <code>str[i] = 'D'</code>  是不允许的<br>必须先将字符串转换成字节数组，然后再通过修改数组中的元素值来达到修改字符串的目的，最后将字节数组转换回字符串格式。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">s <span class="token operator">:=</span> <span class="token string">"hello"</span>c <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>c<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'c'</span>s2 <span class="token operator">:=</span> <span class="token function">string</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token comment">// s2 == "cello"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>字符串处理</title>
      <link href="/2023/03/06/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%A4%84%E7%90%86/"/>
      <url>/2023/03/06/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%A4%84%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.cnblogs.com/xdyixia/p/11896134.html">https://www.cnblogs.com/xdyixia/p/11896134.html</a></p><h2 id="strings操作"><a class="markdownIt-Anchor" href="#strings操作">#</a> strings 操作</h2><h3 id="contains"><a class="markdownIt-Anchor" href="#contains">#</a> Contains</h3><ul><li>字符串是否包含子字符串</li></ul><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// s是否包含 substr 的字符串</span><span class="token keyword">func</span> strings<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>s <span class="token builtin">string</span><span class="token punctuation">,</span> substr <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">bool</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="join"><a class="markdownIt-Anchor" href="#join">#</a> Join</h3><ul><li>字符串切片的元素通过某个字符串连接</li></ul><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// 常用逗号、分号或空格连接</span><span class="token keyword">func</span> <span class="token function">Join</span><span class="token punctuation">(</span>a <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> sep <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="index"><a class="markdownIt-Anchor" href="#index">#</a> Index</h3><ul><li>查找字符串中子字符串的位置</li></ul><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// 找不到则返回 -1</span><span class="token keyword">func</span> <span class="token function">Index</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> sep <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">int</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="repeat"><a class="markdownIt-Anchor" href="#repeat">#</a> Repeat</h3><ul><li>复读某个字符串若干次</li></ul><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// count 为重复 s 字符串的次数</span><span class="token keyword">func</span> <span class="token function">Repeat</span><span class="token punctuation">(</span>s <span class="token builtin">string</span><span class="token punctuation">,</span> count <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">string</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="replace"><a class="markdownIt-Anchor" href="#replace">#</a> Replace</h3><ul><li>替换或删除字符串中某个子字符串</li></ul><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// s 为要操作的字符串，old为s中旧有的字符串，new为用来替换的新的字符串</span><span class="token comment">// n为替换次数，小于0则全部替换</span><span class="token comment">// 删除：用空字符串进行替换则可实现删除</span><span class="token keyword">func</span> <span class="token function">Replace</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> old<span class="token punctuation">,</span> <span class="token builtin">new</span> <span class="token builtin">string</span><span class="token punctuation">,</span> n <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">string</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="split"><a class="markdownIt-Anchor" href="#split">#</a> Split</h3><ul><li>分割字符串，返回字符串切片</li></ul><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// 常用逗号、分号或空格作为分隔符</span><span class="token keyword">func</span> <span class="token function">Split</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> sep <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="trim"><a class="markdownIt-Anchor" href="#trim">#</a> Trim</h3><ul><li>在字符串的头部和尾部去除指定的字符串</li></ul><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// 常用于去空格</span><span class="token comment">// 只去头去尾，中间的忽略</span><span class="token keyword">func</span> <span class="token function">Trim</span><span class="token punctuation">(</span>s <span class="token builtin">string</span><span class="token punctuation">,</span> cutset <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="fields"><a class="markdownIt-Anchor" href="#fields">#</a> Fields</h3><ul><li>去除 s 字符串的空格符，并且按照空格分割返回 slice</li></ul><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">Fields</span><span class="token punctuation">(</span>s <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="strconv-操作"><a class="markdownIt-Anchor" href="#strconv-操作">#</a> strconv 操作</h2><h3 id="append"><a class="markdownIt-Anchor" href="#append">#</a> Append</h3><ul><li>将其他类型数据转换为字符串后追加</li></ul><pre class="line-numbers language-go" data-language="go"><code class="language-go">str <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>str <span class="token operator">=</span> strconv<span class="token punctuation">.</span><span class="token function">AppendInt</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token number">4567</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment">//以10进制方式追加</span>str <span class="token operator">=</span> strconv<span class="token punctuation">.</span><span class="token function">AppendBool</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>str <span class="token operator">=</span> strconv<span class="token punctuation">.</span><span class="token function">AppendQuote</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token string">"abcdefg"</span><span class="token punctuation">)</span>str <span class="token operator">=</span> strconv<span class="token punctuation">.</span><span class="token function">AppendQuoteRune</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token char">'单'</span><span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//4567false"abcdefg"'单'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="format"><a class="markdownIt-Anchor" href="#format">#</a> Format</h3><ul><li>其他类型转换为字符串</li></ul><pre class="line-numbers language-go" data-language="go"><code class="language-go">a <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">FormatBool</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>b <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">FormatInt</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>c <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">FormatUint</span><span class="token punctuation">(</span><span class="token number">12345</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>d <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span><span class="token number">1023</span><span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">)</span> <span class="token comment">//false 1234 12345 1023</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="prase"><a class="markdownIt-Anchor" href="#prase">#</a> Prase</h3><ul><li>字符串转换为其他类型</li></ul><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">checkError</span><span class="token punctuation">(</span>e <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> e <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 字符串不一定都能转换成其他类型，所以会有 error</span>a<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">ParseBool</span><span class="token punctuation">(</span><span class="token string">"false"</span><span class="token punctuation">)</span><span class="token function">checkError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>b<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">ParseFloat</span><span class="token punctuation">(</span><span class="token string">"123.23"</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token function">checkError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>c<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">ParseInt</span><span class="token punctuation">(</span><span class="token string">"1234"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token function">checkError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>d<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">ParseUint</span><span class="token punctuation">(</span><span class="token string">"12345"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token function">checkError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>e<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span><span class="token string">"1023"</span><span class="token punctuation">)</span><span class="token function">checkError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token comment">//false 123.23 1234 12345 1023</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web框架-前缀路由树</title>
      <link href="/2023/03/01/web%E6%A1%86%E6%9E%B6-%E5%89%8D%E7%BC%80%E8%B7%AF%E7%94%B1%E6%A0%91/"/>
      <url>/2023/03/01/web%E6%A1%86%E6%9E%B6-%E5%89%8D%E7%BC%80%E8%B7%AF%E7%94%B1%E6%A0%91/</url>
      
        <content type="html"><![CDATA[<p>极客兔兔的 web 框架，该框架是参考 gin 的造轮子项目。前缀路由树这篇注释太少，不易于理解。个人写了写自己的理解，希望对来访的客人也有用</p><h2 id="树结构"><a class="markdownIt-Anchor" href="#树结构">#</a> 树结构</h2><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// 前缀路由树-树节点</span><span class="token keyword">type</span> node <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>pattern  <span class="token builtin">string</span>  <span class="token comment">// 待匹配路由 /p/:lang</span>part     <span class="token builtin">string</span>  <span class="token comment">// 路由的一部分 :lang，或者叫该节点存储的子路由好一点,在路由中是以 / 字符分隔的最小单位</span>children <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>node <span class="token comment">// 子节点</span>isWild   <span class="token builtin">bool</span>    <span class="token comment">//是否精确匹配，part 含有 : 或 * 时为true，否则为false</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="注册路由"><a class="markdownIt-Anchor" href="#注册路由">#</a> 注册路由</h2><p>匹配子节点的方法，你可以先看下面的 insert 方法再倒回来看</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// 匹配成功的节点，用于插入；插入时只会有一个节点的part匹配</span><span class="token keyword">func</span> <span class="token punctuation">(</span>n <span class="token operator">*</span>node<span class="token punctuation">)</span> <span class="token function">matchChild</span><span class="token punctuation">(</span>part <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">*</span>node <span class="token punctuation">&#123;</span><span class="token comment">// 遍历节点的子节点，子节点的part与要匹配的part相同</span><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> child <span class="token operator">:=</span> <span class="token keyword">range</span> n<span class="token punctuation">.</span>children <span class="token punctuation">&#123;</span><span class="token keyword">if</span> child<span class="token punctuation">.</span>part <span class="token operator">==</span> part <span class="token operator">||</span> child<span class="token punctuation">.</span>isWild <span class="token punctuation">&#123;</span><span class="token comment">//返回匹配的节点</span><span class="token keyword">return</span> child<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>插入节点的方法</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// 注册路由规则</span><span class="token comment">// 对pattern解析，以 / 为分隔符分解为 parts 数组，递归插入路由树，height为插入树的高度</span><span class="token comment">// 例: pattern-"/p/:lang/doc"</span><span class="token comment">//parts-[]string&#123;“p”,“lang”,“doc”&#125;</span><span class="token keyword">func</span> <span class="token punctuation">(</span>n <span class="token operator">*</span>node<span class="token punctuation">)</span> <span class="token function">insert</span><span class="token punctuation">(</span>pattern <span class="token builtin">string</span><span class="token punctuation">,</span> parts <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> height <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">// n节点所在树的高度与分解的part数是否相等，即判断 part 是否全部插入完毕</span><span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>parts<span class="token punctuation">)</span> <span class="token operator">==</span> height <span class="token punctuation">&#123;</span><span class="token comment">// 只有最后一个节点才会设置pattern，用于查询时匹配，这之前的节点该pattern字段均为空</span><span class="token comment">// 确保只有相同层级的相同part才能匹配</span>n<span class="token punctuation">.</span>pattern <span class="token operator">=</span> pattern<span class="token keyword">return</span><span class="token punctuation">&#125;</span>part <span class="token operator">:=</span> parts<span class="token punctuation">[</span>height<span class="token punctuation">]</span><span class="token comment">// 在子节点中查找匹配 part 的第一个节点，然后判断是否存在匹配 part的节点</span><span class="token comment">// 存在则将其作为子节点，继续下一步</span>child <span class="token operator">:=</span> n<span class="token punctuation">.</span><span class="token function">matchChild</span><span class="token punctuation">(</span>part<span class="token punctuation">)</span><span class="token keyword">if</span> child <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span><span class="token comment">// 不存在，则构建新节点，将part写入，根据该part第一个字符是否有:和*，设置isWild</span>child <span class="token operator">=</span> <span class="token operator">&amp;</span>node<span class="token punctuation">&#123;</span>part<span class="token punctuation">:</span> part<span class="token punctuation">,</span> isWild<span class="token punctuation">:</span> part<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">':'</span> <span class="token operator">||</span> part<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'*'</span><span class="token punctuation">&#125;</span><span class="token comment">// 将该节点作为n节点的子节点插入树中</span>n<span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>children<span class="token punctuation">,</span> child<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">// 继续查找child的子节点，插入下一个part，直到把parts数组的part全部插入为止</span>child<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> parts<span class="token punctuation">,</span> height<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="查询路由"><a class="markdownIt-Anchor" href="#查询路由">#</a> 查询路由</h2><p>同样，你可以先看下面的 search 方法再到回来看这个</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// 所有匹配成功的节点，用于查找；与插入时匹配不同的是，有可能存在多个part能匹配的节点,例如动态路由 /:xxx</span><span class="token keyword">func</span> <span class="token punctuation">(</span>n <span class="token operator">*</span>node<span class="token punctuation">)</span> <span class="token function">matchChildren</span><span class="token punctuation">(</span>part <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>node <span class="token punctuation">&#123;</span>nodes <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>node<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">// 遍历节点的子节点，子节点的part与要匹配的part相同</span><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> child <span class="token operator">:=</span> <span class="token keyword">range</span> n<span class="token punctuation">.</span>children <span class="token punctuation">&#123;</span><span class="token keyword">if</span> child<span class="token punctuation">.</span>part <span class="token operator">==</span> part <span class="token operator">||</span> child<span class="token punctuation">.</span>isWild <span class="token punctuation">&#123;</span>nodes <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>nodes<span class="token punctuation">,</span> child<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 返回所有匹配的节点</span><span class="token keyword">return</span> nodes<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>search 方法</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// 查询匹配路由</span><span class="token keyword">func</span> <span class="token punctuation">(</span>n <span class="token operator">*</span>node<span class="token punctuation">)</span> <span class="token function">search</span><span class="token punctuation">(</span>parts <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span>height <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token operator">*</span>node<span class="token punctuation">&#123;</span><span class="token comment">// n节点所在树的高度与分解的part数相等，或n节点的part字段以字符 * 开头，则匹配完毕</span><span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>parts<span class="token punctuation">)</span><span class="token operator">==</span>height<span class="token operator">||</span>strings<span class="token punctuation">.</span><span class="token function">HasPrefix</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>part<span class="token punctuation">,</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">// 注册路由插入该节点的最大高度并不是该层级，pattern字段为空，也无法匹配(详见insert方法的第一个if语句)</span><span class="token keyword">if</span> n<span class="token punctuation">.</span>pattern<span class="token operator">==</span><span class="token string">""</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">&#125;</span><span class="token comment">// 匹配到了，返回该节点</span><span class="token keyword">return</span> n<span class="token punctuation">&#125;</span>part<span class="token operator">:=</span>parts<span class="token punctuation">[</span>height<span class="token punctuation">]</span><span class="token comment">// 在n节点的子节点中查找所有与part匹配的节点</span>chirldren<span class="token operator">:=</span>n<span class="token punctuation">.</span><span class="token function">matchChildren</span><span class="token punctuation">(</span>part<span class="token punctuation">)</span><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span>child<span class="token operator">:=</span><span class="token keyword">range</span> chirldren<span class="token punctuation">&#123;</span><span class="token comment">// 继续递归查询子节点，匹配下一个part，直到parts数组的part完全匹配为止</span>result<span class="token operator">:=</span>child<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>parts<span class="token punctuation">,</span>height<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">if</span> result<span class="token operator">!=</span><span class="token boolean">nil</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> result<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>go的多线程-实时数据采集</title>
      <link href="/2023/02/27/go%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B-%E5%AE%9E%E6%97%B6%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86/"/>
      <url>/2023/02/27/go%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B-%E5%AE%9E%E6%97%B6%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86/</url>
      
        <content type="html"><![CDATA[<h1 id="简介"><a class="markdownIt-Anchor" href="#简介">#</a> 简介</h1><ol><li>与目标设备进行 tcp 连接，接受目标设备发送的数据并存储。</li><li>能随意建立复数连接并分别存储对应接收的数据数据。</li><li>发送命令可以取消指定的连接。</li></ol><h1 id="准备"><a class="markdownIt-Anchor" href="#准备">#</a> 准备</h1><h2 id="mongodb"><a class="markdownIt-Anchor" href="#mongodb">#</a> mongodb</h2><p>本人使用 docker 进行安装使用 mongodb，你也可以在<a href="https://www.mongodb.com/atlas/database"> mongodb 官网</a>下载安装。</p><hr><p>首先安装 docker，推荐可以使用 docker 管理工具 <a href="https://www.docker.com/products/docker-desktop/">Docker Desktop</a>，windows 下的安装可参考<a href="https://docker.easydoc.net/doc/81170005/cCewZWoN/lTKfePfP"> Docker 简介和安装</a>。<br>linux 下请选择对应发行版的方法，ArchLinux 的安装可以参考:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yay <span class="token parameter variable">-S</span> <span class="token function">docker</span><span class="token comment"># 可选：linux 下的 docker 管理工具</span>yay <span class="token parameter variable">-S</span> lazydocker<span class="token comment"># 启动 docker 服务</span><span class="token function">sudo</span> systemctl start <span class="token function">docker</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><p>安装完 docker 后，使用 docker 拉取 mongo 镜像并在名为 mongodb 的容器中运行，指定运行端口为 20717</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> pull mongo<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">20717</span>:20717 <span class="token parameter variable">--name</span> mongodb <span class="token parameter variable">-d</span> mongo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>访问 localhost:20717，出现以下信息则表明服务启动成功</p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">It looks like you are trying to access MongoDB over HTTP on the native driver port.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="gin"><a class="markdownIt-Anchor" href="#gin">#</a> Gin</h2><p><a href="https://gin-gonic.com/zh-cn/docs/quickstart/">https://gin-gonic.com/zh-cn/docs/quickstart/</a></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 安装 gin ，这是一个 web 框架</span>go get <span class="token parameter variable">-u</span> github.com/gin-gonic/gin<span class="token comment"># 安装跨域中间件 cors，如果有需要的话</span>go get github.com/gin-contrib/cors<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="mongo-driver"><a class="markdownIt-Anchor" href="#mongo-driver">#</a> mongo-driver</h2><p><a href="https://github.com/mongodb/mongo-go-driver">https://github.com/mongodb/mongo-go-driver</a></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 安装 mongo-driver，用于操作 mongodb</span>go get go.mongodb.org/mongo-driver/mongo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h1 id="路由设置"><a class="markdownIt-Anchor" href="#路由设置">#</a> 路由设置</h1><p>/router</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// 路由初始化</span><span class="token keyword">func</span> <span class="token function">InitRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 允许跨域</span>r<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span>cors<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// 路由</span>r<span class="token punctuation">.</span><span class="token function">POST</span><span class="token punctuation">(</span><span class="token string">"connect/:ip"</span><span class="token punctuation">,</span>api<span class="token punctuation">.</span>NewConnect<span class="token punctuation">)</span>r<span class="token punctuation">.</span><span class="token function">POST</span><span class="token punctuation">(</span><span class="token string">"disconnect/:ip"</span><span class="token punctuation">,</span>api<span class="token punctuation">.</span>Disconnect<span class="token punctuation">)</span><span class="token comment">//在本地 20000 端口运行</span>r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">":20000"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="数据模型"><a class="markdownIt-Anchor" href="#数据模型">#</a> 数据模型</h1><p>/model<br> 数据模型：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// 消息结构体</span><span class="token keyword">type</span> Msg <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span><span class="token comment">// 获取数据的时间，不是设备产生数据的时间</span>Time <span class="token builtin">string</span> <span class="token comment">// 连接的设备 ip</span>Ip   <span class="token builtin">string</span><span class="token comment">// 设备发送的数据，原始数据未解析</span>Data <span class="token builtin">string</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>获取数据库连接对象：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// 初始化数据库，返回 *mongo.Client 用于操作数据库</span><span class="token keyword">func</span> <span class="token function">InitDB</span><span class="token punctuation">(</span>ctx <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token operator">*</span>mongo<span class="token punctuation">.</span>Client<span class="token punctuation">&#123;</span>ip<span class="token operator">:=</span>ctx<span class="token punctuation">.</span><span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">"ip"</span><span class="token punctuation">)</span><span class="token comment">// 设置客户端连接配置</span>clientOption <span class="token operator">:=</span> options<span class="token punctuation">.</span><span class="token function">Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ApplyURI</span><span class="token punctuation">(</span><span class="token string">"mongodb://localhost:27017"</span><span class="token punctuation">)</span><span class="token comment">// 连接 mongodb，获取连接对象</span>client<span class="token punctuation">,</span> err <span class="token operator">:=</span> mongo<span class="token punctuation">.</span><span class="token function">Connect</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> clientOption<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>ip<span class="token punctuation">,</span><span class="token string">":连接mongo失败"</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span><span class="token punctuation">&#125;</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>ip<span class="token punctuation">,</span><span class="token string">":连接mongo成功"</span><span class="token punctuation">)</span><span class="token keyword">return</span> client<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="tcp连接"><a class="markdownIt-Anchor" href="#tcp连接">#</a> tcp 连接</h1><h2 id="思路"><a class="markdownIt-Anchor" href="#思路">#</a> 思路</h2><ol><li>用到可缓冲 channel 的阻塞机制，当 channel 为空时，读取 channel 会阻塞，当传入数据才能读取，解除阻塞。</li><li>还有 context 控制 goroutine ，不过感觉有些多余。</li><li>用全局 map 保存 tcp 的连接状态，ip 对应一个控制该 ip 连接的 channel 。创建 ip 连接时会创建一个对应的 k/v 对</li><li>当传入一个请求时，程序调用连接函数运行一个 goroutine，该 goroutine 会根据请求的 <code>ip</code>  参数创建一个 tcp 连接，读取数据并写入数据库。</li><li>如果继续向下执行就会取消 goroutine， 关闭连接，但我们使用读空 channel 的操作 <code>&lt;-channel</code>  来阻塞，直到执行取消函数时将向 channel 写入数据以解除阻塞，退出 goroutine</li><li>然后将该 ip/channel 对删除</li><li>能够准确控制 goroutine，也不会产生内存泄露，可喜可贺，可喜可贺</li></ol><h2 id="代码"><a class="markdownIt-Anchor" href="#代码">#</a> 代码</h2><p>定义一个连接状态 map</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// key为ip地址，value为控制该 ip 连接阻塞的 channel</span><span class="token keyword">var</span> MapIpChan<span class="token operator">=</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>连接并读取数据；可以考虑把这里面的 go 协程单独抽出来做一个函数。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">NewConnect</span><span class="token punctuation">(</span>ctx <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">// 根据请求的参数获取 ip</span>ip <span class="token operator">:=</span> ctx<span class="token punctuation">.</span><span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">"ip"</span><span class="token punctuation">)</span><span class="token comment">// 创建一个数据库连接对象</span>dbclient<span class="token operator">:=</span>model<span class="token punctuation">.</span><span class="token function">InitDB</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token comment">// 需要操作的数据库的集合对象</span>collection<span class="token operator">:=</span>dbclient<span class="token punctuation">.</span><span class="token function">Database</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Collection</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token comment">// 有缓冲的 channel，阻塞该ip的cancel()，当 disconnect执行时，取消阻塞，使cancel()执行</span>cancelChan <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>model<span class="token punctuation">.</span>MapIpChan<span class="token punctuation">[</span>ip<span class="token punctuation">]</span> <span class="token operator">=</span> cancelChan<span class="token comment">// 可取消的 context，使用cancel()取消，依赖于该context的 goroutine也会停止</span>ctxConn<span class="token punctuation">,</span> cancel <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">WithCancel</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token comment">// 启动一个goroutine，建立tcp连接，获取传来的数据</span><span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>ip <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"准备连接ip:"</span><span class="token punctuation">,</span>ip<span class="token punctuation">)</span><span class="token comment">// GetConnect(ip1)</span>conn<span class="token punctuation">,</span> err <span class="token operator">:=</span> net<span class="token punctuation">.</span><span class="token function">Dial</span><span class="token punctuation">(</span><span class="token string">"tcp"</span><span class="token punctuation">,</span> ip<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"连接失败:"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token comment">// 退出</span><span class="token keyword">return</span><span class="token punctuation">&#125;</span>buf <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token keyword">for</span> <span class="token punctuation">&#123;</span><span class="token keyword">select</span> <span class="token punctuation">&#123;</span><span class="token keyword">case</span> <span class="token operator">&lt;-</span>ctxConn<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">// cancel()执行时关闭设备连接，关闭数据库连接，退出该 goroutine</span>conn<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"-----关闭设备%v的tcp连接-----\n"</span><span class="token punctuation">,</span>ip<span class="token punctuation">)</span>dbclient<span class="token punctuation">.</span><span class="token function">Disconnect</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"+++++关闭操作数据库%v的连接+++++\n"</span><span class="token punctuation">,</span>ip<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"*****退出连接%v的协程*****\n"</span><span class="token punctuation">,</span>ip<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token keyword">default</span><span class="token punctuation">:</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"连接后准备读取数据"</span><span class="token punctuation">)</span>n<span class="token punctuation">,</span> err <span class="token operator">:=</span> conn<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"已连接，读取错误"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">// 编码转换,在utils包下创建转码函数，然后调用</span>data<span class="token operator">:=</span>utils<span class="token punctuation">.</span><span class="token function">Transcode</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token punctuation">:</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%s: %s\n"</span><span class="token punctuation">,</span> ip<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token comment">// 数据对象</span>msg<span class="token operator">:=</span>model<span class="token punctuation">.</span>Msg<span class="token punctuation">&#123;</span>Time<span class="token punctuation">:</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>Ip<span class="token punctuation">:</span> ip<span class="token punctuation">,</span>Data<span class="token punctuation">:</span> data<span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token comment">// 插入数据</span>insertResult<span class="token punctuation">,</span>err<span class="token operator">:=</span>collection<span class="token punctuation">.</span><span class="token function">InsertOne</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span>msg<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"插入数据失败"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>Data<span class="token punctuation">,</span><span class="token string">"插入数据成功:"</span><span class="token punctuation">,</span>insertResult<span class="token punctuation">.</span>InsertedID<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token comment">// 从该ip对应的 channel接收数据，由于初始为空则阻塞，</span><span class="token comment">// 当 disconnect函数执行时向 channel写入数据，解除阻塞，向下执行</span><span class="token operator">&lt;-</span>cancelChan<span class="token comment">// 删除该 ip/channel 对</span><span class="token function">delete</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>MapIpChan<span class="token punctuation">,</span> ip<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"准备取消任务:%v\n"</span><span class="token punctuation">,</span> ip<span class="token punctuation">)</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ctx<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">&#123;</span><span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"已关闭连接"</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>取消连接</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">Disconnect</span><span class="token punctuation">(</span>ctx <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">// 根据请求的参数获取 ip</span>ip <span class="token operator">:=</span> ctx<span class="token punctuation">.</span><span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">"ip"</span><span class="token punctuation">)</span><span class="token comment">// 在执行 NewConnect() 时会根据 ip 创建键值对，启动 goroutine 建立连接后，NewConnect()被阻塞</span><span class="token comment">// NewConnect() 等待 Disconnect() 取消阻塞后关闭其启动的 goroutine，退出</span><span class="token comment">// 判断 ip 是否在 map 中，即是否处于连接状态</span><span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> isOk <span class="token operator">:=</span> model<span class="token punctuation">.</span>MapIpChan<span class="token punctuation">[</span>ip<span class="token punctuation">]</span><span class="token punctuation">;</span> isOk <span class="token punctuation">&#123;</span><span class="token comment">// channel为空时接收会导致阻塞，向channel发送数据使其不为空则取消阻塞</span>model<span class="token punctuation">.</span>MapIpChan<span class="token punctuation">[</span>ip<span class="token punctuation">]</span> <span class="token operator">&lt;-</span> <span class="token number">1</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"ip未连接"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"解除阻塞"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这个 for-select 条件判断是关键，当 channel 为空时，无法读取，case 条件不满足，所以运行 default 的 functionB ();<br> 向 channel 发送数据后，channel 可以读取，case 条件满足，运行 functionA ()</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">for</span><span class="token punctuation">&#123;</span>    <span class="token keyword">select</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">case</span><span class="token punctuation">:</span><span class="token operator">&lt;-</span>channel            <span class="token function">functionA</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">default</span><span class="token punctuation">:</span>            <span class="token function">functionB</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>go的数据类型深入解析</title>
      <link href="/2023/02/18/go%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/"/>
      <url>/2023/02/18/go%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<p>int bool float string array slice map chan<br> 主要是 map 和 chan</p><h2 id="int"><a class="markdownIt-Anchor" href="#int">#</a> int</h2><p>int (有符号) 和 uint (无符号) 的大小与操作系统相关，在 32 位操作系统中大小为 32 位 (4 字节)，64 位操作系统中大小为 64 位 (8 字节)</p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">int      8 字节int8     1 字节int16    2 字节int32    4 字节int64    8 字节<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>它们是不同的类型 (type)</p><h2 id="float"><a class="markdownIt-Anchor" href="#float">#</a> float</h2><p>float32，即单精度，32 位 (4 字节)，其中 1 位用来符号，8 位用来指数，剩下的 23 位表示尾数，精确到小数点后 7 位<br> float64，即双精度，64 位 (8 字节)，其中 1 位用来符号，11 位用来指数，剩下的 52 位表示尾数，精确到小数点后 15 位</p><h2 id="bool"><a class="markdownIt-Anchor" href="#bool">#</a> bool</h2><p>只有 2 种：true 和 false<br>bool 值并不会隐式转换为数字值 0 或 1，反之亦然。必须使用一个显式的 if 语句辅助转换：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">i <span class="token operator">:=</span> <span class="token number">0</span><span class="token keyword">if</span> b <span class="token punctuation">&#123;</span>    i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="string"><a class="markdownIt-Anchor" href="#string">#</a> string</h2><p>字符串可以包含任意的数据，包括 byte 值 0，但是通常是用来包含人类可读的文本。文本字符串通常被解释为采用 UTF8 编码的 Unicode 码点（rune）序列。<br>一个字符串是一个不可改变的字节序列，实际上就是占用了一片连续的内存空间，所以能理解为一个字符数组<br>在 go 的源码中可以找到 string 的数据结构</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> stringStruct <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>array unsafe<span class="token punctuation">.</span>Pointer   <span class="token comment">// 指向一个 [length]byte 的数组</span>length <span class="token builtin">int</span>             <span class="token comment">// 长度</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>其成员有 2 个，一个指向数组的指针，一个是所指数组的长度<br>示例图：go 语言圣经 3.5.1</p><h2 id="array"><a class="markdownIt-Anchor" href="#array">#</a> array</h2><p>cmd/compile/internal/types2.Array<br>go 源码中数组的结构</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> Array <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span><span class="token builtin">len</span>  <span class="token builtin">int64</span> <span class="token comment">// 数组长度，即元素个数</span>elem Type  <span class="token comment">// 元素类型</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>数组占用一片连续的内存空间</p><h2 id="slice"><a class="markdownIt-Anchor" href="#slice">#</a> slice</h2><p>src/runtime/slice.go<br>go 源码中 slice 的结构</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> slice <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>array unsafe<span class="token punctuation">.</span>Pointer  <span class="token comment">// 指向数组的指针</span><span class="token builtin">len</span>   <span class="token builtin">int</span>             <span class="token comment">// 切片长度</span><span class="token builtin">cap</span>   <span class="token builtin">int</span>             <span class="token comment">// 切片容量</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其成员有 3 个，一个指向数组的指针，一个是切片的长度，还有一个是切片的容量</p><p>切片的长度就是切片所包含的元素个数。<br>切片的容量是从它的第一个元素开始数，到其 <code>底层数组</code> 元素末尾的个数。</p><h2 id="map"><a class="markdownIt-Anchor" href="#map">#</a> map</h2><p>go 源码中 map 的结构<br> src/runtime/map.go</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> hmap <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>count     <span class="token builtin">int</span> <span class="token comment">// map当前元素个数</span>flags     <span class="token builtin">uint8</span> <span class="token comment">// 读、写、扩容、迭代等标记，用于记录map当前状态</span>B         <span class="token builtin">uint8</span>  <span class="token comment">// 用于计算桶大小， bucketSize = 1 &lt;&lt; B ;log_2 of # of buckets (can hold up to loadFactor * 2^B items)</span>noverflow <span class="token builtin">uint16</span> <span class="token comment">// 溢出桶个数，当溢出桶个数过多时，这个值是一个近似值  approximate number of overflow buckets; see incrnoverflow for details</span>hash0     <span class="token builtin">uint32</span> <span class="token comment">// hash seed,计算key哈希值的随机值，保证一个key在不同map中存放的位置是随机的</span>buckets    unsafe<span class="token punctuation">.</span>Pointer <span class="token comment">// 当前哈希桶首地址   array of 2^B Buckets. may be nil if count==0.</span>oldbuckets unsafe<span class="token punctuation">.</span>Pointer <span class="token comment">// 旧哈希桶首地址  previous bucket array of half the size, non-nil only when growing</span>nevacuate  <span class="token builtin">uintptr</span>        <span class="token comment">// 已迁移哈希桶个数   progress counter for evacuation (buckets less than this have been evacuated)</span>extra <span class="token operator">*</span>mapextra <span class="token comment">// 扩展字段，不一定每个map都需要    optional fields</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>map 是使用 hash 表 (哈希表 / 散列表) 来实现的，一个 hash 表里可以有多个 hash 节点，也叫 bucket (桶 / 哈希桶), 而每个 bucket 就保存了 map 中的一个或一组键值对。<br><a href="https://blog.csdn.net/fengshenyun/article/details/100582679">https://blog.csdn.net/fengshenyun/article/details/100582679</a></p><p>bucket 的数据结构</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> bmap <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>    tophash <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token builtin">uint8</span> <span class="token comment">//存储哈希值的高8位,哈希值相同的键（准确的说是哈希值低位相同的键）存入当前bucket时会将哈希值的高位存储在该数组中，以方便后续匹配。</span>    data    <span class="token builtin">byte</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token comment">//key value数据:key/key/key/.../value/value/value...,如此存放是为了节省字节对齐带来的空间浪费</span>    overflow <span class="token operator">*</span>bmap   <span class="token comment">//溢出bucket的地址,指向的是下一个bucket，据此将所有冲突的键连接起来。</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://www.cnblogs.com/failymao/p/14902607.html">https://www.cnblogs.com/failymao/p/14902607.html</a><br><a href="https://www.cnblogs.com/dawnlight/p/15552513.html">https://www.cnblogs.com/dawnlight/p/15552513.html</a></p><h3 id="map数据结构最终梳理"><a class="markdownIt-Anchor" href="#map数据结构最终梳理">#</a> map 数据结构最终梳理</h3><ul><li>hmap 是数组 (切片)，组成元素是 bucket (bmap, 以便区分，这里后面都用 bucket 替代 bmap)；bucket 是链表，指针指向下一个扩充的 bucket。</li><li>map 存储的是 key/value 对 (k/v 对、键值对)</li><li>当 key 传进来时，会经过一个 hash 函数运算得到一个唯一的 hash 值，在 go 中会将这个 hash 值分为高位和低位</li><li>如 hash 值：1314131425002500，高 8 位为 13141314，低 8 位为 25002500</li><li>低位用于寻找 key 属于 hmap 的哪个 bucket，高位用于寻找 bucket 中的哪个 key</li><li>如果 key 计算出的 hash 值低位相同，那么这些 key 存入相同的 bucket 中，在 bucket 中会存储它们的高位，用于存入的 key 的快速预览</li><li>bucket 是以 key/key/key/…/value/value/value… 的方式存储 k/v 对的，这是为了节省字节对齐带来的空间浪费</li><li>每个 bucket 只能存储 8 个 k/v 对，超过 8 个则会扩充一个新的 bucket 存放溢出的 k/v 对，然后指针指向新的 bucket，以此类推，形成一个链表</li></ul><h3 id="负载因子与渐进式扩容"><a class="markdownIt-Anchor" href="#负载因子与渐进式扩容">#</a> 负载因子与渐进式扩容</h3><p>负载因子 = key 数量 /bucket 数量(len (map)/2^B)</p><ul><li>因子过小，说明空间利用率低:key 少 bucket 多，说明 map 的 bucket 数组个数多，一个 bucket 中存放的 key 少</li><li>因子过大，说明冲突严重，存取效率低:key 多 bucket 少，说明 map 的 bucket 数组个数少，一个 bucket 中存放的 key 多，溢出 bucket 严重</li></ul><p>每个哈希表的实现对负载因子容忍程度不同，go 的阈值为 6.5，即平均每个 bucket 存放 6.5 个 k/v 对；而 redis 的阈值为 1，因为 redis 里每个 bucket 只存放一个 k/v 对</p><p>扩容条件</p><ul><li>1. 负载因子 &gt; 6.5 时，也即平均每个 bucket 存储的键值对达到 6.5 个。</li><li>2.overflow (溢出 bucket) 数量 &gt; 2^15 时，也即 overflow 数量超过 32768 时。</li></ul><p>增量扩容<br>因子过大，则会新建一个 bucket 数组将 hmap, 大小为原有 bucket 数组的两倍，并将原有 bucket 数组的数据渐进式地迁移到新 bucket 数组，即每次访问 map 时都会触发一次搬迁，每次搬迁 2 个键值对。</p><p>hmap 的 <code>buckets</code>    <code>oldbuckets</code>   <code>nevacuate</code>  字段就是用来干这个的</p><p>等量扩容<br> buckets 数量不变，只是重新做一遍类似增量扩容的搬迁动作，把松散的键值对重新排列一次，以使 bucket 的使用率更高，进而保证更快的存取。例如过于频繁的对 k/v 进行增删操作，而这些 k/v 集中在某个 bucket 里，则会导致溢出 bucket 严重，影响存取效率</p><h3 id="插入与查找"><a class="markdownIt-Anchor" href="#插入与查找">#</a> 插入与查找</h3><p>插入</p><ul><li>根据 key 值算出哈希值</li><li>取哈希值低位与 hmap.B 取模确定 bucket 位置</li><li>查找该 key 是否已经存在，如果存在则直接更新值</li><li>如果没找到将 key，将 key 插入</li><li></li></ul><p>查找</p><ul><li>根据 key 值算出哈希值</li><li>取哈希值低位与 hmap.B 取模确定 bucket 位置</li><li>取哈希值高位在 tophash 数组中查询</li><li>如果 tophash [i] 中存储值也哈希值相等，则去找到该 bucket 中的 key 值进行比较</li><li>当前 bucket 没有找到，则继续从下个 overflow 的 bucket 中查找。</li><li>如果当前处于搬迁过程，则优先从 oldbuckets 查找<br>注：如果查找不到，也不会返回空值，而是返回相应类型的 0 值。</li></ul><h2 id="chan"><a class="markdownIt-Anchor" href="#chan">#</a> chan</h2><p>src/runtime/chan.go</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> hchan <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>qcount   <span class="token builtin">uint</span>           <span class="token comment">// 当前队列中剩余元素个数total data in the queue</span>dataqsiz <span class="token builtin">uint</span>           <span class="token comment">// 环形队列长度，即可以存放的元素个数  size of the circular queue</span>buf      unsafe<span class="token punctuation">.</span>Pointer <span class="token comment">// 环形队列指针     points to an array of dataqsiz elements</span>elemsize <span class="token builtin">uint16</span><span class="token comment">// 每个元素的大小</span>closed   <span class="token builtin">uint32</span><span class="token comment">// 标识关闭状态</span>elemtype <span class="token operator">*</span>_type <span class="token comment">// 元素类型       element type</span>sendx    <span class="token builtin">uint</span>   <span class="token comment">// 队列下标，指示元素写入时存放到队列中的位置       send index</span>recvx    <span class="token builtin">uint</span>   <span class="token comment">//队列下标，指示元素从队列的该位置读出  receive index</span>recvq    waitq  <span class="token comment">//等待读消息的goroutine队列    list of recv waiters</span>sendq    waitq  <span class="token comment">// 等待写消息的goroutine队列   list of send waiters</span>lock mutex<span class="token comment">//互斥锁，chan不允许并发读写</span><span class="token comment">// lock protects all fields in hchan, as well as several</span><span class="token comment">// fields in sudogs blocked on this channel.</span><span class="token comment">//</span><span class="token comment">// Do not change another G's status while holding this lock</span><span class="token comment">// (in particular, do not ready a G), as this can deadlock</span><span class="token comment">// with stack shrinking.</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>chan 最核心的部分由一个环形队列和 2 个 waitq 组成，环形队列用于存放数据（带缓冲的情况下），waitq 用于实现阻塞和恢复 goroutine。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> waitq <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>first <span class="token operator">*</span>sudoglast  <span class="token operator">*</span>sudog<span class="token punctuation">&#125;</span><span class="token keyword">type</span> sudog <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>    g <span class="token operator">*</span>g    next <span class="token operator">*</span>sudog    prev <span class="token operator">*</span>sudog    elem unsafe<span class="token punctuation">.</span>Pointer <span class="token comment">// data element (may point to stack)</span>    acquiretime <span class="token builtin">int64</span>    releasetime <span class="token builtin">int64</span>    ticket      <span class="token builtin">uint32</span>    <span class="token comment">// isSelect indicates g is participating in a select, so</span>    <span class="token comment">// g.selectDone must be CAS'd to win the wake-up race.</span>    isSelect <span class="token builtin">bool</span>    <span class="token comment">// success indicates whether communication over channel c</span>    <span class="token comment">// succeeded. It is true if the goroutine was awoken because a</span>    <span class="token comment">// value was delivered over channel c, and false if awoken</span>    <span class="token comment">// because c was closed.</span>    success <span class="token builtin">bool</span>    parent   <span class="token operator">*</span>sudog <span class="token comment">// semaRoot binary tree</span>    waitlink <span class="token operator">*</span>sudog <span class="token comment">// g.waiting list or semaRoot</span>    waittail <span class="token operator">*</span>sudog <span class="token comment">// semaRoot</span>    c        <span class="token operator">*</span>hchan <span class="token comment">// channel</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://www.cnblogs.com/failymao/p/14891813.html">https://www.cnblogs.com/failymao/p/14891813.html</a><br><a href="https://i6448038.github.io/2019/04/11/go-channel/">https://i6448038.github.io/2019/04/11/go-channel/</a><br><a href="https://cloud.tencent.com/developer/article/1750350">https://cloud.tencent.com/developer/article/1750350</a></p><h3 id="最终梳理"><a class="markdownIt-Anchor" href="#最终梳理">#</a> 最终梳理</h3><p>channel 在源码是 hchan 结构体，核心为 1 个循环队列、以及 2 个 分别等待读和写的 goroutine 等待队列 (双向链表)</p><h4 id="循环队列"><a class="markdownIt-Anchor" href="#循环队列">#</a> 循环队列</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go">qcount   <span class="token builtin">uint</span>             <span class="token comment">// 当前队列中剩余元素</span>dataqsiz <span class="token builtin">uint</span>             <span class="token comment">// 队列长度，即可以存放的元素个数</span>buf      unsafe<span class="token punctuation">.</span>Pointer   <span class="token comment">// 队列</span>sendx    <span class="token builtin">uint</span>     <span class="token comment">// 队列下标，指示元素写入时存放到队列中的位置 </span>recvx    <span class="token builtin">uint</span>     <span class="token comment">// 队列下标，指示元素从队列的该位置读出</span>lock mutex  <span class="token comment">// 互斥锁</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在创建 channel 时，在内存中实例化了一个 hchan 的结构体，并返回一个 ch 指针。channel 是一个指针。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在讨论之前先统一一下概念：<br>对于发送给 channel 的消息，channel 是接收者，对 channel 来说是写操作；对于 channel 发送出去的消息，channel 是发送者，对 channel 来说是读操作</p><p>sendx: 等待发送。需要发送给 channel 的元素的索引位置 (index)，即元素写入时存放到队列中的位置。</p><p>recvx: 等待接收。需要从 channel 接收的元素的索引位置 (index)，即从队列的该位置读出元素。</p><p>给 channel 发 (send) 数据  (ch&lt;-xx)</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// 1.创建一个channel</span><span class="token comment">// 在内存中实例化了一个hchan的结构体，并返回一个ch指针。</span><span class="token comment">// ch是指针，ch用使用队列 buf 来缓存数据</span><span class="token comment">// 队列长度为dataqsiz为3，当前元素 qcount 为 0</span><span class="token comment">// sendx和recvx均为 0</span>ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token comment">// 2.将 一个元素写入 buf，</span><span class="token comment">// 首先先加锁</span><span class="token comment">// 将元素拷贝，传递给channel</span><span class="token comment">// 索引 0 位置写入了新的元素，sendx变为1，即下一个元素需要写入索引1的位置；recvx不变，即下一个读操作从索引0的位置读取</span><span class="token comment">// 队列长度为dataqsiz为3，当前元素 qcount 为 1</span><span class="token comment">// 释放锁</span>ch<span class="token operator">&lt;-</span><span class="token number">1</span>ch<span class="token operator">&lt;-</span><span class="token number">1</span>ch<span class="token operator">&lt;-</span><span class="token number">1</span><span class="token comment">// 队列缓存已满，再次写入会发生堵塞，这点我们后面再讲</span><span class="token comment">// 每次写入sendx+1，写入了3个元素，因为是循环队列 sendx又变为0；因为没有读取，recvx一直不变还是0</span><span class="token comment">// 3.从buf读取一个元素,和写元素类似</span><span class="token comment">// 首先先加锁</span><span class="token comment">// channel将元素传递给接收者</span><span class="token comment">// 从索引 0 位置读出元素，recvx变为1，即需要读取的下一个元素位置为索引1；sendx为0，即下一个元素需要写入索引0的位置</span><span class="token comment">// 队列长度为dataqsiz为3，当前元素 qcount 为 2</span><span class="token comment">// 释放锁</span><span class="token operator">&lt;-</span>ch<span class="token operator">&lt;-</span>ch<span class="token operator">&lt;-</span>ch<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这个应该很有用，但太长了不想看<br><a href="https://blog.csdn.net/kesenzhang/article/details/104488727"> https://blog.csdn.net/kesenzhang/article/details/104488727</a></p><h3 id="双向链表"><a class="markdownIt-Anchor" href="#双向链表">#</a> 双向链表</h3><p>主要实现了堵塞</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">recvq    waitq  <span class="token comment">//等待读消息的goroutine队列</span>sendq    waitq  <span class="token comment">// 等待写消息的goroutine队列  </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>这部分与 GPM 调度有关，等我写好内存模型和调度后再继续写，to be continent …</p>]]></content>
      
      
      <categories>
          
          <category> golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2.数据库准备</title>
      <link href="/2023/02/13/gin-gorm2%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
      <url>/2023/02/13/gin-gorm2%E6%95%B0%E6%8D%AE%E5%BA%93/</url>
      
        <content type="html"><![CDATA[<hr><p>通过 <code>gin-gorm之项目学习</code> 部分的学习，可以对项目的架构有深入的了解 🤟</p><a href="/2023/02/13/gin-gorm1%E9%A1%B9%E7%9B%AE%E5%87%86%E5%A4%87%E5%88%9D%E5%A7%8B%E5%8C%96/" title="1.项目准备初始化">1.项目准备初始化</a><br/><a href="/2023/02/13/gin-gorm2%E6%95%B0%E6%8D%AE%E5%BA%93/" title="2.数据库准备">2.数据库准备</a><br/><a href="/2023/02/13/gin-gorm3%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E4%B8%8E%E8%B7%AF%E7%94%B1%E6%8E%A5%E5%8F%A3/" title="3.错误处理与路由接口">3.错误处理与路由接口</a><br/><a href="/2023/02/13/gin-gorm4%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9D%97%E6%8E%A5%E5%8F%A3%E7%BC%96%E5%86%99/" title="4.用户模块接口编写">4.用户模块接口编写</a><br/><a href="/2023/02/13/gin-gorm5%E5%AF%86%E7%A0%81%E5%8A%A0%E5%AF%86/" title="5.密码加密">5.密码加密</a><br/><a href="/2023/02/13/gin-gorm6%E7%BC%96%E8%BE%91%E3%80%81%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7/" title="6.编辑、删除用户">6.编辑、删除用户</a><br/><hr><h1 id="数据库"><a class="markdownIt-Anchor" href="#数据库">#</a> 数据库</h1><h2 id="安装gorm"><a class="markdownIt-Anchor" href="#安装gorm">#</a> 安装 Gorm</h2><p>安装 gorm  现在是 v2 版本</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">go get <span class="token parameter variable">-u</span> gorm.io/gorm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>注意除了 gorm 外还需要有数据库驱动，本人使用的是 postgresql，使用其他数据库的请参考官网</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">import</span> <span class="token string">"gorm.io/driver/postgres"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后根据提示导入，或者运行 go mod tidy，该命令能够导入所有依赖的库并删除多余的库</p><h2 id="数据模型"><a class="markdownIt-Anchor" href="#数据模型">#</a> 数据模型</h2><p>在 model 文件夹下建立数据库入口文件 db.go</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// 全局变量，db和error在其他文件里也需要使用</span><span class="token keyword">var</span> <span class="token punctuation">(</span>db  <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DBerr <span class="token builtin">error</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">InitDb</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//使用占位符，然后用setting.go里的配置参数来替代</span>dsn <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"host=%s user=%s password=%s dbname=%s port=%s sslmode=disable TimeZone=Asia/Shanghai"</span><span class="token punctuation">,</span>utils<span class="token punctuation">.</span>DbHost<span class="token punctuation">,</span>utils<span class="token punctuation">.</span>DbUser<span class="token punctuation">,</span>utils<span class="token punctuation">.</span>DbPassword<span class="token punctuation">,</span>utils<span class="token punctuation">.</span>DbName<span class="token punctuation">,</span>utils<span class="token punctuation">.</span>DbPort<span class="token punctuation">,</span><span class="token punctuation">)</span>db<span class="token punctuation">,</span> err <span class="token operator">=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>postgres<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>dsn<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gorm<span class="token punctuation">.</span>Config<span class="token punctuation">&#123;</span><span class="token comment">//禁用默认表名的复数形式</span>NamingStrategy<span class="token punctuation">:</span> schema<span class="token punctuation">.</span>NamingStrategy<span class="token punctuation">&#123;</span>SingularTable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"数据库连接失败，请检查连接参数"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">//</span><span class="token comment">//数据库自动迁移，括号内的参数为需要构建的数据模型结构体</span>db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>sqlDB<span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">DB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"数据库连接设置出错，请检查连接参数"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">// SetMaxIdleConns 设置空闲连接池中连接的最大数量</span>sqlDB<span class="token punctuation">.</span><span class="token function">SetMaxIdleConns</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token comment">// SetMaxOpenConns 设置打开数据库连接的最大数量。</span>sqlDB<span class="token punctuation">.</span><span class="token function">SetMaxOpenConns</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token comment">// SetConnMaxLifetime 设置了连接可复用的最大时间。</span><span class="token comment">//不能超过 gin 框架的连接超时时间</span>sqlDB<span class="token punctuation">.</span><span class="token function">SetConnMaxLifetime</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><span class="token comment">//sqlDB.Close()</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="数据模型-2"><a class="markdownIt-Anchor" href="#数据模型-2">#</a> 数据模型</h2><p>在 model 文件夹下建立数据模型文件 User.go 、Article.go 、Category.go<br> 创建结构体</p><pre class="line-numbers language-GO" data-language="GO"><code class="language-GO">type User struct &#123;gorm.ModelUsername string &#96;gorm:&quot;type:varchar(20);not null &quot; json:&quot;username&quot;&#96;Password string &#96;gorm:&quot;type:varchar(20);not null &quot; json:&quot;password&quot;&#96;Role     int    &#96;gorm:&quot;type:int; &quot; json:&quot;role&quot;&#96;&#125;type Category struct &#123;gorm.ModelName string &#96;gorm:&quot;type:varchar(20);not null &quot; json:&quot;name&quot;&#96;&#125;type Article struct &#123;gorm.ModelTitle       string   &#96;gorm:&quot;type:varchar(20);not null&quot; json:&quot;title&quot;&#96;Category    Category CategoryId  int      &#96;gorm:&quot;type:int;not null&quot; json:&quot;category_id&quot;&#96;Description string   &#96;gorm:&quot;type:varchar(200)&quot; json:&quot;description&quot;&#96;Content     string   &#96;gorm:&quot;type:text&quot; json:&quot;content&quot;&#96;Img         string   &#96;gorm:&quot;type:varchar(200)&quot; json:&quot;img&quot;&#96;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="用数据库迁移创建数据表"><a class="markdownIt-Anchor" href="#用数据库迁移创建数据表">#</a> 用数据库迁移创建数据表</h2><p>回到数据库入口文件 db.go，使用创建的结构体</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">//数据库自动迁移</span>db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>Category<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>Article<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>最后在 main.go 中使用数据库初始化函数 InitDb ()</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">model<span class="token punctuation">.</span><span class="token function">InitDb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>运行项目 main.go, 能够看到数据库根据 model 建立了数据表，数据库连接工具库本人使用的是 DBeaver</p>]]></content>
      
      
      <categories>
          
          <category> gin-gorm之项目学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>1.项目准备初始化</title>
      <link href="/2023/02/13/gin-gorm1%E9%A1%B9%E7%9B%AE%E5%87%86%E5%A4%87%E5%88%9D%E5%A7%8B%E5%8C%96/"/>
      <url>/2023/02/13/gin-gorm1%E9%A1%B9%E7%9B%AE%E5%87%86%E5%A4%87%E5%88%9D%E5%A7%8B%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<hr><p>通过 <code>gin-gorm之项目学习</code> 部分的学习，可以对项目的架构有深入的了解 🤟</p><a href="/2023/02/13/gin-gorm1%E9%A1%B9%E7%9B%AE%E5%87%86%E5%A4%87%E5%88%9D%E5%A7%8B%E5%8C%96/" title="1.项目准备初始化">1.项目准备初始化</a><br/><a href="/2023/02/13/gin-gorm2%E6%95%B0%E6%8D%AE%E5%BA%93/" title="2.数据库准备">2.数据库准备</a><br/><a href="/2023/02/13/gin-gorm3%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E4%B8%8E%E8%B7%AF%E7%94%B1%E6%8E%A5%E5%8F%A3/" title="3.错误处理与路由接口">3.错误处理与路由接口</a><br/><a href="/2023/02/13/gin-gorm4%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9D%97%E6%8E%A5%E5%8F%A3%E7%BC%96%E5%86%99/" title="4.用户模块接口编写">4.用户模块接口编写</a><br/><a href="/2023/02/13/gin-gorm5%E5%AF%86%E7%A0%81%E5%8A%A0%E5%AF%86/" title="5.密码加密">5.密码加密</a><br/><a href="/2023/02/13/gin-gorm6%E7%BC%96%E8%BE%91%E3%80%81%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7/" title="6.编辑、删除用户">6.编辑、删除用户</a><br/><hr><p>顺便说一下 hexo 中如何做文章跳转，例如上面的目录第一项在 md 中要这么写:<br> <code>&#123;% post_link "gin-gorm1项目准备初始化" %&#125;&lt;br/&gt;</code> <br>&quot;gin-gorm1 项目准备初始化&quot; 是 md 文件的名字，而不是 md 中 format 的 title 的名称，显示时会显示 title 的名称</p><h1 id="初始化"><a class="markdownIt-Anchor" href="#初始化">#</a> 初始化</h1><h2 id="一-创建仓库"><a class="markdownIt-Anchor" href="#一-创建仓库">#</a> 一、创建仓库</h2><p>GitHub 创建项目仓库，git clone 拉取项目</p><h2 id="二-初始化"><a class="markdownIt-Anchor" href="#二-初始化">#</a> 二、初始化</h2><p>创建 main.go 文件，在项目根目录下执行 go mod init &lt;项目名&gt; ，添加了 go.mod，完成初始化</p><h2 id="三-安装gin"><a class="markdownIt-Anchor" href="#三-安装gin">#</a> 三、安装 gin</h2><p>gin <a href="https://gin-gonic.com/zh-cn/docs/">官方文档</a><br>下载安装：在项目根目录下执行</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">go get <span class="token parameter variable">-u</span> github.com/gin-gonic/gin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="四-搭建项目结构"><a class="markdownIt-Anchor" href="#四-搭建项目结构">#</a> 四、搭建项目结构</h2><p>gin 是灵活的 web 框架，不会限制我们的项目结构，所以需要我们自己去建立</p><p>项目结构如下：</p><p>config 网站配置、参数等等<br> model 数据，读写<br> api (controller) 前后端接口<br> middleware 中间件，登录验证、跨域等等<br> routes 路由接口<br> utils 工具包，实现公用的功能<br> upload 上传下载，托管静态资源<br> web 前端页面托管</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="五-网站配置参数"><a class="markdownIt-Anchor" href="#五-网站配置参数">#</a> 五、网站配置参数</h2><p>可以在 config 文件夹下新建 config.go 文件，在其中写基本配置参数</p><p>不过此处使用<a href="https://ini.unknwon.io/"> go ini</a> 来进行配置<br>安装 go ini，在根目录下执行</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">go get gopkg.in/ini.v1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在 config 文件夹下新建 config.ini 文件，在其中写网站的基本配置参数<br> ini 写法：</p><pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token comment"># 注释</span><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">分区</span><span class="token punctuation">]</span></span><span class="token key attr-name">key</span><span class="token punctuation">=</span><span class="token value attr-value">value</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>配置如下</p><pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">server</span><span class="token punctuation">]</span></span><span class="token key attr-name">AppMode</span><span class="token punctuation">=</span><span class="token value attr-value">debug</span><span class="token key attr-name">HttpPort</span><span class="token punctuation">=</span><span class="token value attr-value">:3000</span><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">database</span><span class="token punctuation">]</span></span><span class="token key attr-name">Db</span><span class="token punctuation">=</span><span class="token value attr-value">postgresql</span><span class="token key attr-name">DbHost</span><span class="token punctuation">=</span><span class="token value attr-value">localhost</span><span class="token key attr-name">DbPort</span><span class="token punctuation">=</span><span class="token value attr-value">5432</span><span class="token key attr-name">DbUser</span><span class="token punctuation">=</span><span class="token value attr-value">postgres</span><span class="token key attr-name">DbPassword</span><span class="token punctuation">=</span><span class="token value attr-value">123456</span><span class="token key attr-name">DbName</span><span class="token punctuation">=</span><span class="token value attr-value">ginblog</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在 utils 下新建 setting.go，将 config.ini 的参数引入并作为全局变量</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">var</span> <span class="token punctuation">(</span>AppMode  <span class="token builtin">string</span>HttpPort <span class="token builtin">string</span>Db         <span class="token builtin">string</span>DbHost     <span class="token builtin">string</span>DbPort     <span class="token builtin">string</span>DbUser     <span class="token builtin">string</span>DbPassword <span class="token builtin">string</span>DbName     <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>file<span class="token punctuation">,</span> err <span class="token operator">:=</span> ini<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span><span class="token string">"../config/config.ini"</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"配置文件读取错误，请检查文件路径："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token function">loadServer</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token function">loadData</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">//加载server配置</span><span class="token keyword">func</span> <span class="token function">loadServer</span><span class="token punctuation">(</span>file <span class="token operator">*</span>ini<span class="token punctuation">.</span>File<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>AppMode <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">Section</span><span class="token punctuation">(</span><span class="token string">"server"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Key</span><span class="token punctuation">(</span><span class="token string">"AppMode"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">MustString</span><span class="token punctuation">(</span><span class="token string">"debug"</span><span class="token punctuation">)</span>HttpPort <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">Section</span><span class="token punctuation">(</span><span class="token string">"server"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Key</span><span class="token punctuation">(</span><span class="token string">"HttpPort"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">MustString</span><span class="token punctuation">(</span><span class="token string">":3000"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">//加载database配置</span><span class="token keyword">func</span> <span class="token function">loadData</span><span class="token punctuation">(</span>file <span class="token operator">*</span>ini<span class="token punctuation">.</span>File<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>Db <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">Section</span><span class="token punctuation">(</span><span class="token string">"database"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Key</span><span class="token punctuation">(</span><span class="token string">"Db"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">MustString</span><span class="token punctuation">(</span><span class="token string">"postgresql"</span><span class="token punctuation">)</span>DbHost <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">Section</span><span class="token punctuation">(</span><span class="token string">"database"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Key</span><span class="token punctuation">(</span><span class="token string">"DbHost"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">MustString</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">)</span>DbPort <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">Section</span><span class="token punctuation">(</span><span class="token string">"database"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Key</span><span class="token punctuation">(</span><span class="token string">"DbPort"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">MustString</span><span class="token punctuation">(</span><span class="token string">"5432"</span><span class="token punctuation">)</span>DbUser <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">Section</span><span class="token punctuation">(</span><span class="token string">"database"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Key</span><span class="token punctuation">(</span><span class="token string">"DbUser"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">MustString</span><span class="token punctuation">(</span><span class="token string">"postgres"</span><span class="token punctuation">)</span>DbPassword <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">Section</span><span class="token punctuation">(</span><span class="token string">"database"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Key</span><span class="token punctuation">(</span><span class="token string">"DbPassword"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">MustString</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span>DbName <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">Section</span><span class="token punctuation">(</span><span class="token string">"database"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Key</span><span class="token punctuation">(</span><span class="token string">"DbName"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">MustString</span><span class="token punctuation">(</span><span class="token string">"ginblog"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在使用配置参数时调用 setting.go，这样做是为了将配置参数抽离出来，当需要更改时只需要更改 ini 配置文件里面的配置</p><h2 id="六-路由"><a class="markdownIt-Anchor" href="#六-路由">#</a> 六、路由</h2><p>在 routes 文件夹下建立 router.go 文件，作为路由入口文件</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">InitRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>gin<span class="token punctuation">.</span><span class="token function">SetMode</span><span class="token punctuation">(</span>utils<span class="token punctuation">.</span>AppMode<span class="token punctuation">)</span>r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>router <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">Group</span><span class="token punctuation">(</span><span class="token string">"api/v1"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>router<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>ctx <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>ctx<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">&#123;</span><span class="token string">"msg"</span><span class="token punctuation">:</span> <span class="token string">"ok"</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>utils<span class="token punctuation">.</span>HttpPort<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在 main 中使用</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>routes<span class="token punctuation">.</span><span class="token function">InitRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="测试"><a class="markdownIt-Anchor" href="#测试">#</a> 测试</h2><p>运行 main.go<br> 控制台打印</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>GIN-debug<span class="token punctuation">]</span> <span class="token punctuation">[</span>WARNING<span class="token punctuation">]</span> Creating an Engine instance with the Logger and Recovery middleware already attached.<span class="token punctuation">[</span>GIN-debug<span class="token punctuation">]</span> <span class="token punctuation">[</span>WARNING<span class="token punctuation">]</span> Running <span class="token keyword">in</span> <span class="token string">"debug"</span> mode. Switch to <span class="token string">"release"</span> mode <span class="token keyword">in</span> production. - using env:<span class="token builtin class-name">export</span> <span class="token assign-left variable">GIN_MODE</span><span class="token operator">=</span>release - using code:gin.SetMode<span class="token punctuation">(</span>gin.ReleaseMode<span class="token punctuation">)</span><span class="token punctuation">[</span>GIN-debug<span class="token punctuation">]</span> GET    /api/v1/hello             --<span class="token operator">></span> gin-vue-blog/routes.InitRouter.func1 <span class="token punctuation">(</span><span class="token number">3</span> handlers<span class="token punctuation">)</span><span class="token punctuation">[</span>GIN-debug<span class="token punctuation">]</span> <span class="token punctuation">[</span>WARNING<span class="token punctuation">]</span> You trusted all proxies, this is NOT safe. We recommend you to <span class="token builtin class-name">set</span> a value.Please check https://pkg.go.dev/github.com/gin-gonic/gin<span class="token comment">#readme-don-t-trust-all-proxies for details.</span><span class="token punctuation">[</span>GIN-debug<span class="token punctuation">]</span> Listening and serving HTTP on :3000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>浏览器访问 localhost:3000/api/v1/hello<br> 页面显示</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">&#123;</span><span class="token string">"msg"</span><span class="token builtin class-name">:</span><span class="token string">"ok"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>OK, 一切正常</p>]]></content>
      
      
      <categories>
          
          <category> gin-gorm之项目学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>3.错误处理与路由接口</title>
      <link href="/2023/02/13/gin-gorm3%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E4%B8%8E%E8%B7%AF%E7%94%B1%E6%8E%A5%E5%8F%A3/"/>
      <url>/2023/02/13/gin-gorm3%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E4%B8%8E%E8%B7%AF%E7%94%B1%E6%8E%A5%E5%8F%A3/</url>
      
        <content type="html"><![CDATA[<hr><p>通过 <code>gin-gorm之项目学习</code> 部分的学习，可以对项目的架构有深入的了解 🤟</p><a href="/2023/02/13/gin-gorm1%E9%A1%B9%E7%9B%AE%E5%87%86%E5%A4%87%E5%88%9D%E5%A7%8B%E5%8C%96/" title="1.项目准备初始化">1.项目准备初始化</a><br/><a href="/2023/02/13/gin-gorm2%E6%95%B0%E6%8D%AE%E5%BA%93/" title="2.数据库准备">2.数据库准备</a><br/><a href="/2023/02/13/gin-gorm3%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E4%B8%8E%E8%B7%AF%E7%94%B1%E6%8E%A5%E5%8F%A3/" title="3.错误处理与路由接口">3.错误处理与路由接口</a><br/><a href="/2023/02/13/gin-gorm4%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9D%97%E6%8E%A5%E5%8F%A3%E7%BC%96%E5%86%99/" title="4.用户模块接口编写">4.用户模块接口编写</a><br/><a href="/2023/02/13/gin-gorm5%E5%AF%86%E7%A0%81%E5%8A%A0%E5%AF%86/" title="5.密码加密">5.密码加密</a><br/><a href="/2023/02/13/gin-gorm6%E7%BC%96%E8%BE%91%E3%80%81%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7/" title="6.编辑、删除用户">6.编辑、删除用户</a><br/><hr><h1 id="错误处理与路由接口"><a class="markdownIt-Anchor" href="#错误处理与路由接口">#</a> 错误处理与路由接口</h1><h2 id="错误处理"><a class="markdownIt-Anchor" href="#错误处理">#</a> 错误处理</h2><h3 id="错误处理工具"><a class="markdownIt-Anchor" href="#错误处理工具">#</a> 错误处理工具</h3><p>搭建错误处理工具，在 utils 下新建 errmsg 文件夹，在里面新建 errmsg.go</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">const</span> <span class="token punctuation">(</span>SUCCESS <span class="token operator">=</span> <span class="token number">200</span>ERROR   <span class="token operator">=</span> <span class="token number">500</span><span class="token comment">//约定状态码</span><span class="token comment">//code=1000...用户模块错误</span>ERROR_USERNAME_USED  <span class="token operator">=</span> <span class="token number">1001</span>ERROR_PASSWORD_WRONG <span class="token operator">=</span> <span class="token number">1002</span>ERROR_USER_NOT_EXIST <span class="token operator">=</span> <span class="token number">1003</span>ERROR_TOKEN_NOT_EXIST <span class="token operator">=</span> <span class="token number">1004</span>ERROR_TOKEN_OUT_TIME  <span class="token operator">=</span> <span class="token number">1005</span>ERROR_TOKEN_WRONG     <span class="token operator">=</span> <span class="token number">1006</span>ERROR_TYPE_WRONG      <span class="token operator">=</span> <span class="token number">1007</span><span class="token comment">//code=2000...文章模块错误</span><span class="token comment">//code=3000...分类模块错误</span><span class="token punctuation">)</span><span class="token keyword">var</span> codeMsg <span class="token operator">=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">&#123;</span>SUCCESS<span class="token punctuation">:</span>               <span class="token string">"OK"</span><span class="token punctuation">,</span>ERROR<span class="token punctuation">:</span>                 <span class="token string">"FAIL"</span><span class="token punctuation">,</span>ERROR_USERNAME_USED<span class="token punctuation">:</span>   <span class="token string">"该用户名已存在"</span><span class="token punctuation">,</span>ERROR_PASSWORD_WRONG<span class="token punctuation">:</span>  <span class="token string">"密码错误"</span><span class="token punctuation">,</span>ERROR_USER_NOT_EXIST<span class="token punctuation">:</span>  <span class="token string">"用户不存在"</span><span class="token punctuation">,</span>ERROR_TOKEN_NOT_EXIST<span class="token punctuation">:</span> <span class="token string">"token不存在"</span><span class="token punctuation">,</span>ERROR_TOKEN_OUT_TIME<span class="token punctuation">:</span>  <span class="token string">"token已过期"</span><span class="token punctuation">,</span>ERROR_TOKEN_WRONG<span class="token punctuation">:</span>     <span class="token string">"token错误"</span><span class="token punctuation">,</span>ERROR_TYPE_WRONG<span class="token punctuation">:</span>      <span class="token string">" token格式错误"</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">func</span> <span class="token function">GetErrMsg</span><span class="token punctuation">(</span>code <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> codeMsg<span class="token punctuation">[</span>code<span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="路由接口"><a class="markdownIt-Anchor" href="#路由接口">#</a> 路由接口</h2><p>在 api/v1 创建控制数据模型的接口 user.go、article.go、category.go，以及控制登录的接口 login.go<br> 以用户模块为例</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">//查询用户是否存在</span><span class="token keyword">func</span> <span class="token function">UserExist</span><span class="token punctuation">(</span>ctx <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">//查询用户</span><span class="token comment">//查询用户列表</span><span class="token keyword">func</span> <span class="token function">GetUsers</span><span class="token punctuation">(</span>ctx <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">//添加用户</span><span class="token keyword">func</span> <span class="token function">AddUser</span><span class="token punctuation">(</span>ctx <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">//编辑用户</span><span class="token keyword">func</span> <span class="token function">EditUser</span><span class="token punctuation">(</span>ctx <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">//删除用户</span><span class="token keyword">func</span> <span class="token function">DeleteUser</span><span class="token punctuation">(</span>ctx <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在 routes/router.go 的 v1 路由组中创建路由接口，这种 api 为 restful 风格</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">router <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">Group</span><span class="token punctuation">(</span><span class="token string">"api/v1"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//Use用户模块路由接口</span>router<span class="token punctuation">.</span><span class="token function">POST</span><span class="token punctuation">(</span><span class="token string">"user/add"</span><span class="token punctuation">,</span> v1<span class="token punctuation">.</span>AddUser<span class="token punctuation">)</span>router<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"users"</span><span class="token punctuation">,</span> v1<span class="token punctuation">.</span>GetUsers<span class="token punctuation">)</span>router<span class="token punctuation">.</span><span class="token function">PUT</span><span class="token punctuation">(</span><span class="token string">"user/:id"</span><span class="token punctuation">,</span> v1<span class="token punctuation">.</span>EditUser<span class="token punctuation">)</span>router<span class="token punctuation">.</span><span class="token function">DELETE</span><span class="token punctuation">(</span><span class="token string">"user/:id"</span><span class="token punctuation">,</span> v1<span class="token punctuation">.</span>DeleteUser<span class="token punctuation">)</span><span class="token comment">//Category分类模块路由接口</span><span class="token comment">//Article文章模块路由接口</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> gin-gorm之项目学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>5.密码加密</title>
      <link href="/2023/02/13/gin-gorm5%E5%AF%86%E7%A0%81%E5%8A%A0%E5%AF%86/"/>
      <url>/2023/02/13/gin-gorm5%E5%AF%86%E7%A0%81%E5%8A%A0%E5%AF%86/</url>
      
        <content type="html"><![CDATA[<hr><p>通过 <code>gin-gorm之项目学习</code> 部分的学习，可以对项目的架构有深入的了解 🤟</p><a href="/2023/02/13/gin-gorm1%E9%A1%B9%E7%9B%AE%E5%87%86%E5%A4%87%E5%88%9D%E5%A7%8B%E5%8C%96/" title="1.项目准备初始化">1.项目准备初始化</a><br/><a href="/2023/02/13/gin-gorm2%E6%95%B0%E6%8D%AE%E5%BA%93/" title="2.数据库准备">2.数据库准备</a><br/><a href="/2023/02/13/gin-gorm3%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E4%B8%8E%E8%B7%AF%E7%94%B1%E6%8E%A5%E5%8F%A3/" title="3.错误处理与路由接口">3.错误处理与路由接口</a><br/><a href="/2023/02/13/gin-gorm4%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9D%97%E6%8E%A5%E5%8F%A3%E7%BC%96%E5%86%99/" title="4.用户模块接口编写">4.用户模块接口编写</a><br/><a href="/2023/02/13/gin-gorm5%E5%AF%86%E7%A0%81%E5%8A%A0%E5%AF%86/" title="5.密码加密">5.密码加密</a><br/><a href="/2023/02/13/gin-gorm6%E7%BC%96%E8%BE%91%E3%80%81%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7/" title="6.编辑、删除用户">6.编辑、删除用户</a><br/><hr><h1 id="密码加密"><a class="markdownIt-Anchor" href="#密码加密">#</a> 密码加密</h1><p>普通级<br>单向哈希</p><p>进阶级<br> bcrypt - 加盐</p><p>专家级<br> scrypt - 某黑客写的，目前没有破解方法</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// 密码加密</span><span class="token keyword">func</span> <span class="token function">ScryptPassword</span><span class="token punctuation">(</span>password <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span><span class="token keyword">const</span> KeyLen <span class="token operator">=</span> <span class="token number">10</span> <span class="token comment">//长度</span>salt <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>salt <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">&#123;</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">&#125;</span>HashPw<span class="token punctuation">,</span> err <span class="token operator">:=</span> scrypt<span class="token punctuation">.</span><span class="token function">Key</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">,</span> salt<span class="token punctuation">,</span> <span class="token number">16384</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> KeyLen<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">&#125;</span>finalPw <span class="token operator">:=</span> base64<span class="token punctuation">.</span>StdEncoding<span class="token punctuation">.</span><span class="token function">EncodeToString</span><span class="token punctuation">(</span>HashPw<span class="token punctuation">)</span><span class="token keyword">return</span> finalPw<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在添加用户时，将用户的密码进行 scrypt 加密</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">data<span class="token punctuation">.</span>Password <span class="token operator">=</span> <span class="token function">ScryptPassword</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>Password<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> gin-gorm之项目学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>4.用户模块接口编写</title>
      <link href="/2023/02/13/gin-gorm4%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9D%97%E6%8E%A5%E5%8F%A3%E7%BC%96%E5%86%99/"/>
      <url>/2023/02/13/gin-gorm4%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9D%97%E6%8E%A5%E5%8F%A3%E7%BC%96%E5%86%99/</url>
      
        <content type="html"><![CDATA[<hr><p>通过 <code>gin-gorm之项目学习</code> 部分的学习，可以对项目的架构有深入的了解 🤟</p><a href="/2023/02/13/gin-gorm1%E9%A1%B9%E7%9B%AE%E5%87%86%E5%A4%87%E5%88%9D%E5%A7%8B%E5%8C%96/" title="1.项目准备初始化">1.项目准备初始化</a><br/><a href="/2023/02/13/gin-gorm2%E6%95%B0%E6%8D%AE%E5%BA%93/" title="2.数据库准备">2.数据库准备</a><br/><a href="/2023/02/13/gin-gorm3%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E4%B8%8E%E8%B7%AF%E7%94%B1%E6%8E%A5%E5%8F%A3/" title="3.错误处理与路由接口">3.错误处理与路由接口</a><br/><a href="/2023/02/13/gin-gorm4%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9D%97%E6%8E%A5%E5%8F%A3%E7%BC%96%E5%86%99/" title="4.用户模块接口编写">4.用户模块接口编写</a><br/><a href="/2023/02/13/gin-gorm5%E5%AF%86%E7%A0%81%E5%8A%A0%E5%AF%86/" title="5.密码加密">5.密码加密</a><br/><a href="/2023/02/13/gin-gorm6%E7%BC%96%E8%BE%91%E3%80%81%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7/" title="6.编辑、删除用户">6.编辑、删除用户</a><br/><hr><h1 id="用户模块-增-查"><a class="markdownIt-Anchor" href="#用户模块-增-查">#</a> 用户模块 - 增、查</h1><h2 id="添加用户"><a class="markdownIt-Anchor" href="#添加用户">#</a> 添加用户</h2><p>先判断用户是否存在再添加<br>在 model/User.go 中编写，或者新建 service 层文件也可以</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// 查询用户是否存在</span><span class="token keyword">func</span> <span class="token function">CheckUser</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>code <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">var</span> users User<span class="token comment">//查询使用该用户名的 id</span>db<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">"username =?"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span><span class="token comment">//存在使用该用户名的 id</span><span class="token keyword">if</span> users<span class="token punctuation">.</span>ID <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> errmsg<span class="token punctuation">.</span>ERROR_USERNAME_USED <span class="token comment">//1001</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> errmsg<span class="token punctuation">.</span>SUCCESS <span class="token comment">//200</span><span class="token punctuation">&#125;</span><span class="token comment">// 新增用户   返回状态码</span><span class="token keyword">func</span> <span class="token function">CreateUser</span><span class="token punctuation">(</span>data <span class="token operator">*</span>User<span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">&#123;</span>err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>Error<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> errmsg<span class="token punctuation">.</span>ERROR <span class="token comment">//500</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> errmsg<span class="token punctuation">.</span>SUCCESS <span class="token comment">//200</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在 api/v1/user.go 接口文件中补全添加用户 AddUser 的代码</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// 添加用户</span><span class="token keyword">func</span> <span class="token function">AddUser</span><span class="token punctuation">(</span>ctx <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">var</span> data model<span class="token punctuation">.</span>User<span class="token boolean">_</span> <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">ShouldBindJSON</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>data<span class="token punctuation">)</span>code <span class="token operator">=</span> model<span class="token punctuation">.</span><span class="token function">CheckUser</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>Username<span class="token punctuation">)</span><span class="token keyword">if</span> code <span class="token operator">==</span> errmsg<span class="token punctuation">.</span>SUCCESS <span class="token punctuation">&#123;</span>model<span class="token punctuation">.</span><span class="token function">CreateUser</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>data<span class="token punctuation">)</span><span class="token punctuation">&#125;</span>ctx<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">&#123;</span><span class="token string">"status"</span><span class="token punctuation">:</span>  code<span class="token punctuation">,</span><span class="token string">"data"</span><span class="token punctuation">:</span>    data<span class="token punctuation">,</span><span class="token string">"message"</span><span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在 model 中，我们写的是对数据库的操作以及操作的反馈<br>在 api 中，我们写的是执行操作的逻辑 (操作执行的条件、顺序) 以及返回给前端的信息</p><h2 id="查询用户"><a class="markdownIt-Anchor" href="#查询用户">#</a> 查询用户</h2><p>model/User.go</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// 查询用户列表 分页</span><span class="token keyword">func</span> <span class="token function">GetUsers</span><span class="token punctuation">(</span>pageSize <span class="token builtin">int</span><span class="token punctuation">,</span> pageNum <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>User <span class="token punctuation">&#123;</span><span class="token keyword">var</span> users <span class="token punctuation">[</span><span class="token punctuation">]</span>Usererr <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Limit</span><span class="token punctuation">(</span>pageSize<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Offset</span><span class="token punctuation">(</span><span class="token punctuation">(</span>pageNum <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span><span class="token punctuation">.</span>Error<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> users<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>api/v1/user.go</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// 查询用户列表 分页</span><span class="token comment">// 前端需要传递分页的设置信息给后端</span><span class="token keyword">func</span> <span class="token function">GetUsers</span><span class="token punctuation">(</span>ctx <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>pageSize<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token string">"pagesize"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>pageNum<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token string">"pagenum"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> pageSize <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">&#123;</span>pageSize <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> pageNum <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">&#123;</span>pageNum <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">&#125;</span>data <span class="token operator">:=</span> model<span class="token punctuation">.</span><span class="token function">GetUsers</span><span class="token punctuation">(</span>pageSize<span class="token punctuation">,</span> pageNum<span class="token punctuation">)</span>code <span class="token operator">=</span> errmsg<span class="token punctuation">.</span>SUCCESSctx<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">&#123;</span><span class="token string">"status"</span><span class="token punctuation">:</span>  code<span class="token punctuation">,</span><span class="token string">"data"</span><span class="token punctuation">:</span>    data<span class="token punctuation">,</span><span class="token string">"message"</span><span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="附加接口测试"><a class="markdownIt-Anchor" href="#附加接口测试">#</a> 附加：接口测试</h2><p>选择接口测试工具：postman、apipost 等等</p><p>在地址栏输入访问调用函数的路由地址<br> localhost:3000/api/v1/user/add<br>localhost:3000/api/v1/users<br> 这些已经在 router 中定义好，localhost:3000 是你定义的服务器地址端口，/api/v1 是你定义的路由组入口，后面的是调用函数的路由及参数</p><p>以上两个功能为例，使用 apipost：<br><strong>添加用户测试</strong>：<br>选择 POST 方式，地址栏输入 localhost:3000/api/v1/user/add选择 body-raw-json，输入 User 数据 (json 格式), 点击发送</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>    <span class="token property">"username"</span><span class="token operator">:</span> <span class="token string">"li8"</span><span class="token punctuation">,</span>    <span class="token property">"password"</span><span class="token operator">:</span> <span class="token string">"123456"</span><span class="token punctuation">,</span>    <span class="token property">"role"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以看到响应信息<br><strong>查询用户测试</strong>：<br>需要先添加多个用户<br>选择 GET 方式，地址栏输入 localhost:3000/api/v1/users选择 query，填写参数 pagesize、pagenum, 点击发送</p><p>可以看到响应信息</p>]]></content>
      
      
      <categories>
          
          <category> gin-gorm之项目学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>6.编辑、删除用户</title>
      <link href="/2023/02/13/gin-gorm6%E7%BC%96%E8%BE%91%E3%80%81%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7/"/>
      <url>/2023/02/13/gin-gorm6%E7%BC%96%E8%BE%91%E3%80%81%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7/</url>
      
        <content type="html"><![CDATA[<hr><p>通过 <code>gin-gorm之项目学习</code> 部分的学习，可以对项目的架构有深入的了解 🤟</p><a href="/2023/02/13/gin-gorm1%E9%A1%B9%E7%9B%AE%E5%87%86%E5%A4%87%E5%88%9D%E5%A7%8B%E5%8C%96/" title="1.项目准备初始化">1.项目准备初始化</a><br/><a href="/2023/02/13/gin-gorm2%E6%95%B0%E6%8D%AE%E5%BA%93/" title="2.数据库准备">2.数据库准备</a><br/><a href="/2023/02/13/gin-gorm3%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E4%B8%8E%E8%B7%AF%E7%94%B1%E6%8E%A5%E5%8F%A3/" title="3.错误处理与路由接口">3.错误处理与路由接口</a><br/><a href="/2023/02/13/gin-gorm4%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9D%97%E6%8E%A5%E5%8F%A3%E7%BC%96%E5%86%99/" title="4.用户模块接口编写">4.用户模块接口编写</a><br/><a href="/2023/02/13/gin-gorm5%E5%AF%86%E7%A0%81%E5%8A%A0%E5%AF%86/" title="5.密码加密">5.密码加密</a><br/><a href="/2023/02/13/gin-gorm6%E7%BC%96%E8%BE%91%E3%80%81%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7/" title="6.编辑、删除用户">6.编辑、删除用户</a><br/><hr><h1 id="删除用户"><a class="markdownIt-Anchor" href="#删除用户">#</a> 删除用户</h1><p>在 model 的 User 中写删除语句</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// 删除用户</span><span class="token keyword">func</span> <span class="token function">DeleteUser</span><span class="token punctuation">(</span>id <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">&#123;</span>err <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">"id=?"</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Error<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> errmsg<span class="token punctuation">.</span>ERROR<span class="token punctuation">&#125;</span><span class="token keyword">return</span> errmsg<span class="token punctuation">.</span>SUCCESS<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在 api 的 user.go 中调用，返回前端信息</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// 删除用户</span><span class="token keyword">func</span> <span class="token function">DeleteUser</span><span class="token punctuation">(</span>ctx <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>id<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>code <span class="token operator">=</span> model<span class="token punctuation">.</span><span class="token function">DeleteUser</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>ctx<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">&#123;</span><span class="token string">"status"</span><span class="token punctuation">:</span>  code<span class="token punctuation">,</span><span class="token string">"message"</span><span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>删除为软删除，即将数据标记为删除状态，数据仍保留在数据库中，以确保数据库的完整性和可恢复性</p><h2 id="编辑用户"><a class="markdownIt-Anchor" href="#编辑用户">#</a> 编辑用户</h2><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// 编辑用户(密码除外)</span><span class="token keyword">func</span> <span class="token function">EditUser</span><span class="token punctuation">(</span>id <span class="token builtin">int</span><span class="token punctuation">,</span> data <span class="token operator">*</span>User<span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">&#123;</span><span class="token keyword">var</span> maps <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>maps<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">.</span>Usernamemaps<span class="token punctuation">[</span><span class="token string">"role"</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">.</span>Roleerr <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">"id=?"</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Updates</span><span class="token punctuation">(</span>maps<span class="token punctuation">)</span><span class="token punctuation">.</span>Error<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> errmsg<span class="token punctuation">.</span>ERROR<span class="token punctuation">&#125;</span><span class="token keyword">return</span> errmsg<span class="token punctuation">.</span>SUCCESS<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// 编辑用户</span><span class="token keyword">func</span> <span class="token function">EditUser</span><span class="token punctuation">(</span>ctx <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">var</span> data model<span class="token punctuation">.</span>Userid<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>ctx<span class="token punctuation">.</span><span class="token function">ShouldBindJSON</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>code <span class="token operator">=</span> model<span class="token punctuation">.</span><span class="token function">CheckUser</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>Username<span class="token punctuation">)</span><span class="token keyword">if</span> code <span class="token operator">==</span> errmsg<span class="token punctuation">.</span>SUCCESS <span class="token punctuation">&#123;</span>model<span class="token punctuation">.</span><span class="token function">EditUser</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token operator">&amp;</span>data<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> code <span class="token operator">==</span> errmsg<span class="token punctuation">.</span>ERROR_USERNAME_USED <span class="token punctuation">&#123;</span>ctx<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>ctx<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">&#123;</span><span class="token string">"status"</span><span class="token punctuation">:</span>  code<span class="token punctuation">,</span><span class="token string">"message"</span><span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> gin-gorm之项目学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>樱花特效 sakura.js</title>
      <link href="/2023/02/05/%E6%A8%B1%E8%8A%B1%E7%89%B9%E6%95%88sakura-js/"/>
      <url>/2023/02/05/%E6%A8%B1%E8%8A%B1%E7%89%B9%E6%95%88sakura-js/</url>
      
        <content type="html"><![CDATA[<p>感谢<a href="https://www.lifeee.top/posts/64617.html">热夏 Lifeee 的博客 为博客添加樱花飘落的效果</a></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> stop<span class="token punctuation">,</span> staticx<span class="token punctuation">;</span><span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAUgAAAEwCAYAAADVZeifAAAACXBIWXMAAACYAAAAmAGiyIKYAAAHG2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXBSaWdodHM9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9yaWdodHMvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtcFJpZ2h0czpNYXJrZWQ9IkZhbHNlIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6NDFDMjQxQjYyNjIwNjgxMTgwODNEMjE2MDAzOTU1NDQiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDozNDVjOWViOC04NDc4LTFkNDctOGRjMi0yZDkyOGNhYTYxZWQiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6YjAzN2ZiMGItNTU5Mi0xYjRkLWJjZGQtOWU4NGExMDJiMGM2IiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDE4LTA1LTA5VDE0OjQ5OjM3KzA4OjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxOC0wNS0wOVQxNDo1MToyNSswODowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAxOC0wNS0wOVQxNDo1MToyNSswODowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjEyMjVlZWE3LTEyY2QtMTY0NC04ZDAzLWFjOTE2ZTAxZDQ1YyIgc3RSZWY6ZG9jdW1lbnRJRD0idXVpZDoxRDIwNUFGNjZCRDlFNTExOUM5REMwMzg2RjlEQjFGNyIvPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDphYmMzNjIzMy1hOWNkLWNiNDQtODViYi0zZTgyMjEwYmIxMjYiIHN0RXZ0OndoZW49IjIwMTgtMDUtMDlUMTQ6NTE6MjUrMDg6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE4IChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6YjAzN2ZiMGItNTU5Mi0xYjRkLWJjZGQtOWU4NGExMDJiMGM2IiBzdEV2dDp3aGVuPSIyMDE4LTA1LTA5VDE0OjUxOjI1KzA4OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2Vx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"</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">Sakura</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> s<span class="token punctuation">,</span> r<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> x<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> y<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>s <span class="token operator">=</span> s<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>r <span class="token operator">=</span> r<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>fn <span class="token operator">=</span> fn<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token class-name">Sakura</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">draw</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">cxt</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    cxt<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> xc <span class="token operator">=</span> <span class="token number">40</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>s <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">;</span>    cxt<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>    cxt<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>    cxt<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">40</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>s<span class="token punctuation">,</span> <span class="token number">40</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>s<span class="token punctuation">)</span>    cxt<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token class-name">Sakura</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">update</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fn<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fn<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>r <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fn<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">></span> window<span class="token punctuation">.</span>innerWidth <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">></span> window<span class="token punctuation">.</span>innerHeight <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>r <span class="token operator">=</span> <span class="token function">getRandom</span><span class="token punctuation">(</span><span class="token string">'fnr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0.4</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token function">getRandom</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>s <span class="token operator">=</span> <span class="token function">getRandom</span><span class="token punctuation">(</span><span class="token string">'s'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>r <span class="token operator">=</span> <span class="token function">getRandom</span><span class="token punctuation">(</span><span class="token string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token function">getRandom</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>s <span class="token operator">=</span> <span class="token function">getRandom</span><span class="token punctuation">(</span><span class="token string">'s'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>r <span class="token operator">=</span> <span class="token function">getRandom</span><span class="token punctuation">(</span><span class="token string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function-variable function">SakuraList</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token class-name">SakuraList</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">push</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">sakura</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sakura<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token class-name">SakuraList</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">update</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token class-name">SakuraList</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">draw</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">cxt</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>cxt<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token class-name">SakuraList</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token class-name">SakuraList</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">size</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span>length<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">getRandom</span><span class="token punctuation">(</span><span class="token parameter">option</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> ret<span class="token punctuation">,</span> random<span class="token punctuation">;</span>    <span class="token keyword">switch</span> <span class="token punctuation">(</span>option<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">case</span> <span class="token string">'x'</span><span class="token operator">:</span>            ret <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string">'y'</span><span class="token operator">:</span>            ret <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string">'s'</span><span class="token operator">:</span>            ret <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string">'r'</span><span class="token operator">:</span>            ret <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">6</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string">'fnx'</span><span class="token operator">:</span>            random <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">0.5</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">;</span>            <span class="token function-variable function">ret</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> x <span class="token operator">+</span> <span class="token number">0.5</span> <span class="token operator">*</span> random <span class="token operator">-</span> <span class="token number">1.7</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string">'fny'</span><span class="token operator">:</span>            random <span class="token operator">=</span> <span class="token number">1.5</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.7</span>            <span class="token function-variable function">ret</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> y <span class="token operator">+</span> random<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string">'fnr'</span><span class="token operator">:</span>            random <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.03</span><span class="token punctuation">;</span>            <span class="token function-variable function">ret</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> r <span class="token operator">+</span> random<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> ret<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">startSakura</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    requestAnimationFrame <span class="token operator">=</span> window<span class="token punctuation">.</span>requestAnimationFrame <span class="token operator">||</span> window<span class="token punctuation">.</span>mozRequestAnimationFrame <span class="token operator">||</span> window<span class="token punctuation">.</span>webkitRequestAnimationFrame <span class="token operator">||</span> window<span class="token punctuation">.</span>msRequestAnimationFrame <span class="token operator">||</span> window<span class="token punctuation">.</span>oRequestAnimationFrame<span class="token punctuation">;</span>    <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        cxt<span class="token punctuation">;</span>    staticx <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>    canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>    canvas<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">,</span> <span class="token string">'position: fixed;left: 0;top: 0;pointer-events: none;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    canvas<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'canvas_sakura'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>    cxt <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> sakuraList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SakuraList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">var</span> sakura<span class="token punctuation">,</span> randomX<span class="token punctuation">,</span> randomY<span class="token punctuation">,</span> randomS<span class="token punctuation">,</span> randomR<span class="token punctuation">,</span> randomFnx<span class="token punctuation">,</span> randomFny<span class="token punctuation">;</span>        randomX <span class="token operator">=</span> <span class="token function">getRandom</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        randomY <span class="token operator">=</span> <span class="token function">getRandom</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        randomR <span class="token operator">=</span> <span class="token function">getRandom</span><span class="token punctuation">(</span><span class="token string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        randomS <span class="token operator">=</span> <span class="token function">getRandom</span><span class="token punctuation">(</span><span class="token string">'s'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        randomFnx <span class="token operator">=</span> <span class="token function">getRandom</span><span class="token punctuation">(</span><span class="token string">'fnx'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        randomFny <span class="token operator">=</span> <span class="token function">getRandom</span><span class="token punctuation">(</span><span class="token string">'fny'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        randomFnR <span class="token operator">=</span> <span class="token function">getRandom</span><span class="token punctuation">(</span><span class="token string">'fnr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        sakura <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sakura</span><span class="token punctuation">(</span>randomX<span class="token punctuation">,</span> randomY<span class="token punctuation">,</span> randomS<span class="token punctuation">,</span> randomR<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>            <span class="token literal-property property">x</span><span class="token operator">:</span> randomFnx<span class="token punctuation">,</span>            <span class="token literal-property property">y</span><span class="token operator">:</span> randomFny<span class="token punctuation">,</span>            <span class="token literal-property property">r</span><span class="token operator">:</span> randomFnR        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        sakura<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>cxt<span class="token punctuation">)</span><span class="token punctuation">;</span>        sakuraList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sakura<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    stop <span class="token operator">=</span> <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        cxt<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>        sakuraList<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        sakuraList<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>cxt<span class="token punctuation">)</span><span class="token punctuation">;</span>        stop <span class="token operator">=</span> <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>callee<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>window<span class="token punctuation">.</span><span class="token function-variable function">onresize</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> canvasSnow <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'canvas_snow'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">startSakura</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">stopp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>staticx<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">var</span> child <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"canvas_sakura"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        child<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>        window<span class="token punctuation">.</span><span class="token function">cancelAnimationFrame</span><span class="token punctuation">(</span>stop<span class="token punctuation">)</span><span class="token punctuation">;</span>        staticx <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token function">startSakura</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在 themes\butterfly\source\js\ 目录下面新建 sakura.js，粘贴以上代码<br>在_config.butterfly.yml 中引入即可</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">inject</span><span class="token punctuation">:</span>  <span class="token key atrule">head</span><span class="token punctuation">:</span>    <span class="token comment"># - &lt;link rel="stylesheet" href="/xxx.css"></span>  <span class="token key atrule">bottom</span><span class="token punctuation">:</span>    <span class="token comment"># - &lt;script src="xxxx">&lt;/script></span>    <span class="token punctuation">-</span> &lt;script src="/js/sakura.js"<span class="token punctuation">></span>&lt;/script<span class="token punctuation">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这个以后有空再看看 https://github.com/jhammann/sakura</p>]]></content>
      
      
      <categories>
          
          <category> js </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ArchLinux重开备忘录</title>
      <link href="/2023/02/05/ArchLinux%E9%87%8D%E5%BC%80%E5%A4%87%E5%BF%98%E5%BD%95/"/>
      <url>/2023/02/05/ArchLinux%E9%87%8D%E5%BC%80%E5%A4%87%E5%BF%98%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<p>原来 16G 太小了，重新分配 40G 再装了一遍，第三次安装成功<br>第二台电脑也成功装上了，nice<br> 万一哪天挂了或用新电脑时，方便自己快速重开<br>时常记得： <code>sudo pacman -Syu</code></p><h2 id="可能用到的链接"><a class="markdownIt-Anchor" href="#可能用到的链接">#</a> 可能用到的链接</h2><p>Arch wiki<br><a href="https://wiki.archlinux.org/">https://wiki.archlinux.org/</a></p><p>vmware 虚拟机安装 archlinux<br><a href="https://blog.csdn.net/takashi77/article/details/118927109">https://blog.csdn.net/takashi77/article/details/118927109</a></p><p>重启后网络 ping 不通<br>网络问题解决方案<br><a href="https://blog.csdn.net/kaluosifa/article/details/105303484"> https://blog.csdn.net/kaluosifa/article/details/105303484</a></p><p>安装 plasma 桌面环境 虚拟机安装不需要配置显卡驱动，其实这个应该是最全最好用的，不过我是装好了 Arch 后要装 kde 出错后才找到这个不错的完全体教程<br><a href="https://arch.icekylin.online/rookie/desktop-env-and-app.html#_4-%E5%AE%89%E8%A3%85-kde-plasma-%E6%A1%8C%E9%9D%A2%E7%8E%AF%E5%A2%83"> https://arch.icekylin.online/rookie/desktop-env-and-app.html#_4 - 安装 - kde-plasma - 桌面环境</a><br>安装可能用到的命令</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ping</span> arch.icekylin.onlinetimedatectl set-ntp <span class="token boolean">true</span>timedatectl status<span class="token function">vim</span> /etc/pacman.d/mirrorlist<span class="token comment"># 分区和挂载系列命令</span>pacstrap /mnt base base-devel linux linux-firmwarepacstrap /mnt dhcpcd iwd <span class="token function">vim</span> <span class="token function">sudo</span> bash-completiongenfstab <span class="token parameter variable">-U</span> /mnt <span class="token operator">></span> /mnt/etc/fstab<span class="token function">cat</span> /mnt/etc/fstabarch-chroot /mnt<span class="token function">vim</span> /etc/hostname<span class="token function">vim</span> /etc/hosts<span class="token function">ln</span> <span class="token parameter variable">-sf</span> /usr/share/zoneinfo/Asia/Shanghai /etc/localtimehwclock <span class="token parameter variable">--systohc</span>locale-gen<span class="token builtin class-name">echo</span> <span class="token string">'LANG=en_US.UTF-8'</span>  <span class="token operator">></span> /etc/locale.conf<span class="token function">passwd</span> rootpacman <span class="token parameter variable">-S</span> intel-ucodepacman <span class="token parameter variable">-S</span> grub efibootmgrgrub-install <span class="token parameter variable">--target</span><span class="token operator">=</span>x86_64-efi --efi-directory<span class="token operator">=</span>/efi --bootloader-id<span class="token operator">=</span>ARCH<span class="token function">vim</span> /etc/default/grub<span class="token function">grub-mkconfig</span> <span class="token parameter variable">-o</span> /boot/grub/grub.cfg<span class="token builtin class-name">exit</span><span class="token function">umount</span> <span class="token parameter variable">-R</span> /mnt<span class="token function">reboot</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="安装准备"><a class="markdownIt-Anchor" href="#安装准备">#</a> 安装准备</h2><h3 id="下载软件"><a class="markdownIt-Anchor" href="#下载软件">#</a> 下载软件</h3><p>前往官网 https://archlinux.org/download/ 下载 Arch 镜像，往下划选择一个国内的镜像源，我使用的是 aliyun，选择 iso 映像文件下载</p><p>下载虚拟机 VMware 或 visual box 都可以，我用的是 VMware</p><h3 id="创建虚拟机"><a class="markdownIt-Anchor" href="#创建虚拟机">#</a> 创建虚拟机</h3><p>创建虚拟机：</p><ul><li>典型配置</li><li>安装程序光盘映像文件 - 选择刚刚下载好的 iso 映像文件</li><li>操作系统选择 Linux - 版本选择其他 Linux 内核 64 位</li><li>设置虚拟机名称和位置</li><li>分配内存 我是 16g 硬盘 2g 内存 后面装 kde 后感觉有点小了？</li><li>其他默认，之后可以在虚拟机 - 设置里更改</li></ul><p>创建完成后请勿直接开启虚拟机，因为会默认使用 bios 方式启动，我们这里要改用 efi 方式启动</p><h2 id="开始安装"><a class="markdownIt-Anchor" href="#开始安装">#</a> 开始安装</h2><h3 id="开启虚拟机"><a class="markdownIt-Anchor" href="#开启虚拟机">#</a> 开启虚拟机</h3><p>更改为 UEFI 引导：虚拟机 - 设置 - 选项 - 高级 - 固件类型，将 BIOS 选项改为 UEFI，确定。因为我们之后的分区类型和引导程序都是用 EFI 的<br>开启虚拟机，第一个选项 enter<br> 测试网络，开通则有数据显示，安装镜像时应该已经预配置了网络</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ping</span> www.bilibili.com<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="时间"><a class="markdownIt-Anchor" href="#时间">#</a> 时间</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 通过 npt 校准时间</span>timedatectl set-ntp <span class="token boolean">true</span><span class="token comment"># 查看时间</span>timedatectl status<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>如果与实际时间相差 8 小时，那是因为我们用的东八区时间与 UTC 标准时间相差 8 小时：<br>设置时区为上海，我是安装完后才设置的</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ln</span> <span class="token parameter variable">-sf</span> /usr/share/zoneinfo/Asia/Shanghai /etc/localtime<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="磁盘分区"><a class="markdownIt-Anchor" href="#磁盘分区">#</a> 磁盘分区</h3><p>lsblk 查看磁盘分区情况，未分区时磁盘 sda 16G</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 进入磁盘分区系统</span><span class="token function">cfdisk</span> /dev/sda<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>然后选择 gpt 方式进入分区，上下键选择分区、左右键选择下方的操作命令，回车执行操作</p><ul><li>new 新建分区然后输入分区大小，即可将当前磁盘划分出一块分区</li><li>type 分区类型</li><li>write 写入磁盘，如果没有 write 直接 quit 则分区操作不会生效</li><li>delete 删除分区</li><li>quit 退出分区操作</li></ul><p>分区 sd1：new - 输入大小（参考：512M）- type - EFI System<br> 分区 sd2：new - 输入大小（参考：12G）- type - Linux root (x86-64)<br> 分区 sd3：输入大小（参考：剩下的 3.5G）- type - Linux swap</p><p>确定完成分区后 write - 最后 quit<br> 使用 lsblk 查看分区后的磁盘</p><h3 id="初始化分区"><a class="markdownIt-Anchor" href="#初始化分区">#</a> 初始化分区</h3><p>格式化分区</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mkfs.fat <span class="token parameter variable">-F32</span> /dev/sda1mkfs.ext4 /dev/sda2<span class="token function">mkswap</span> /dev/sda3 <span class="token parameter variable">-L</span> Swap<span class="token function">swapon</span> /dev/sda3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>挂载分区</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mount</span> /dev/sda2 /mnt<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /mnt/boot/EFI<span class="token function">mount</span> /dev/sda1 /mnt/boot/EFI<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>使用 vim 打开下载镜像列表</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> /etc/pacman.d/mirrorlist<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在里面列表第一行添加中国境内的源，这里使用 aliyun</p><pre class="line-numbers language-vim" data-language="vim"><code class="language-vim">Server <span class="token operator">=</span> http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>mirrors<span class="token operator">.</span>aliyun<span class="token operator">.</span><span class="token builtin">com</span><span class="token operator">/</span>archlinux<span class="token operator">/</span>$repo<span class="token operator">/</span>os<span class="token operator">/</span>$arch<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><p>假如你不会 vim，你只需要了解在本文中你会用到的 vim 操作：</p><ul><li>按  <code>i</code>  进入插入模式，在插入模式下才可以对文件进行修改</li><li>按  <code>esc</code>  进入命令模式，可以多按几次  <code>esc</code>  以确保你处于命令模式，在命令模式下不能对文件进行修改</li><li>在命令模式下，可以输入一些命令，在本文中你会用到的命令如下<ul><li><code>:/</code>  为查找命令，后面家上你要查找的文本，vim 会跳转到匹配的那一行，按  <code>N</code>  查找下一个</li><li><code>:w</code>  保存修改</li><li><code>:wq</code>  保存修改并退出 vim</li><li><code>:q!</code>  强制退出</li></ul></li></ul><hr><h3 id="系统安装"><a class="markdownIt-Anchor" href="#系统安装">#</a> 系统安装</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 这是为/mnt下安装一些环境用于待会创建用户所使用的，包括一些基本环境以及网络相关的dhcpcd和net-tools</span>pacstrap <span class="token parameter variable">-i</span> /mnt base base-devel linux <span class="token function">vim</span> dhcpcd net-tools<span class="token comment"># 生成 fstab 文件 (用 -U 或 -L 选项设置UUID 或卷标)：</span>genfstab <span class="token parameter variable">-U</span> /mnt <span class="token operator">>></span> /mnt/etc/fstab<span class="token comment"># 查看是否生成了磁盘分区</span><span class="token function">cat</span> /mnt/etc/fstab<span class="token comment"># 切换用户,原来 root是红色，切换成功后变为灰色</span>arch-chroot /mnt<span class="token comment"># 创建初始的ramdisk环境</span>mkinitcpio <span class="token parameter variable">-p</span> linux<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="locale地区和语言配置"><a class="markdownIt-Anchor" href="#locale地区和语言配置">#</a> locale 地区和语言配置</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 用 vim 打开locale配置文件</span><span class="token function">vim</span> /etc/locale.gen<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>查找以下 3 项，去掉前面的 # 号<br> vim 命令模式输入  <code>:/en_US.UTF-8 UTF-8</code>   查找</p><pre class="line-numbers language-vim" data-language="vim"><code class="language-vim">en_US<span class="token operator">.</span>UTF<span class="token operator">-</span><span class="token number">8</span> UTF<span class="token operator">-</span><span class="token number">8</span>zh_CN<span class="token operator">.</span>UTF<span class="token operator">-</span><span class="token number">8</span> UTF<span class="token operator">-</span><span class="token number">8</span>zh_TW<span class="token operator">.</span>UTF<span class="token operator">-</span><span class="token number">8</span> UTF<span class="token operator">-</span><span class="token number">8</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 生成Locale信息</span>locale-gen<span class="token comment"># 列出所有启用的Locale</span>locale <span class="token parameter variable">-a</span><span class="token comment"># 创建locale.conf文件，并提交所要使用的本地化选项</span><span class="token comment"># 不推荐此时设置任何中文locale，这样做可能会导致tty显示乱码</span><span class="token builtin class-name">echo</span> <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>en_US.UTF-8 <span class="token operator">></span> /etc/locale.conf<span class="token comment"># 显示当前正在使用的Locale和相关的环境变量</span>locale<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="设置主机名"><a class="markdownIt-Anchor" href="#设置主机名">#</a> 设置主机名</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 创建 /etc/hostname 文件并将主机名写入文件,比如主机名为 arch</span><span class="token builtin class-name">echo</span> arch <span class="token operator">></span> /etc/hostname<span class="token comment"># 然后用 vim打开 /etc/hosts 配置</span><span class="token function">vim</span> /etc/hosts<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>写入以下内容，保存并退出</p><pre class="line-numbers language-vim" data-language="vim"><code class="language-vim"><span class="token number">127.0</span><span class="token operator">.</span><span class="token number">0.1</span>    localhost<span class="token operator">.</span>localdomain    localhost<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">1</span>          localhost<span class="token operator">.</span>localdomain    localhost<span class="token number">127.0</span><span class="token operator">.</span><span class="token number">1.1</span>    arch<span class="token operator">.</span>localdomain    arch <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="网络配置"><a class="markdownIt-Anchor" href="#网络配置">#</a> 网络配置</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pacman <span class="token parameter variable">-S</span> dhcpcdsystemctl <span class="token builtin class-name">enable</span> dhcpcd.service使用无线网络的话，则需安装以下几个软件包（未验证）pacman <span class="token parameter variable">-S</span> iw wpa_supplicant dialog（有线网络忽略这行）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>另一个教程里无线网络的配置<br><a href="https://arch.icekylin.online/rookie/basic-install.html#%E8%8B%A5%E4%BD%BF%E7%94%A8%E6%97%A0%E7%BA%BF%E8%BF%9E%E6%8E%A5"> https://arch.icekylin.online/rookie/basic-install.html# 若使用无线连接</a></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">iwctl <span class="token comment"># 进入交互式命令行</span>device list <span class="token comment"># 列出无线网卡设备名，比如无线网卡看到叫 wlan0</span>station wlan0 scan <span class="token comment"># 扫描网络</span>station wlan0 get-networks <span class="token comment"># 列出所有 wifi 网络</span>station wlan0 connect wifi-name <span class="token comment"># 进行连接，注意这里无法输入中文。回车后输入密码即可</span><span class="token builtin class-name">exit</span> <span class="token comment"># 连接成功后退出</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="root用户密码及创建新用户"><a class="markdownIt-Anchor" href="#root用户密码及创建新用户">#</a> root 用户密码及创建新用户</h3><p>设置 root 密码</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 输入时密码会隐藏，你不会看到你输入的任何东西，这是正常的。确定密码输入完后回车</span><span class="token function">passwd</span><span class="token comment"># 二次确认密码，密码同样会隐藏</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>root 用户拥有系统的所有操作权限，这样对系统的操作非常不安全，所以需要新建一个普通用户，让其对系统的操作受到一定限制，后面要用的 kde 也只能由非 root 用户使用</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 创建新用户，比如用户名为free</span><span class="token function">useradd</span> <span class="token parameter variable">-m</span> <span class="token parameter variable">-G</span> wheel <span class="token parameter variable">-s</span> /bin/bash <span class="token function">free</span><span class="token comment"># 设置用户密码</span><span class="token function">passwd</span> <span class="token function">free</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>-m：创建用户主目录（/home/[用户名]）<br>-G：用户要加入的附加组列表；此处将用户加到 wheel 组中，之后可以给这个组执行 sudo 命令的权限<br> - s：指定了用户默认登录 shell 的路径，此处设置为 bash 的路径</p></blockquote><p>给予普通用户使用 root 的权限</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 打开sudoers文件后</span>visudo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>删除 wheel 组前面的注释（#）即可：<br>之后普通用户在命令之前加上 sudo 就能以 root 权限执行命令</p><h3 id="安装引导程序-grub"><a class="markdownIt-Anchor" href="#安装引导程序-grub">#</a> 安装引导程序 grub</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># arch下载软件命令：pacman -S &lt;软件名></span><span class="token comment"># 因为我们使用的是虚拟机和UEFI引导方式，因此只需要安装grub和efibootmgr：</span>pacman <span class="token parameter variable">-S</span> grub efibootmgr<span class="token comment"># 将其安装到EFI分区当中</span>grub-install <span class="token parameter variable">--recheck</span> /dev/sda<span class="token comment"># 生成 grub 的配置文件：</span><span class="token function">grub-mkconfig</span> <span class="token parameter variable">-o</span> /boot/grub/grub.cfg<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>安装完毕</p><h3 id="退出重启安装完成"><a class="markdownIt-Anchor" href="#退出重启安装完成">#</a> 退出重启，安装完成</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 退回安装环境</span><span class="token builtin class-name">exit</span><span class="token comment"># 卸载新分区</span><span class="token function">umount</span> <span class="token parameter variable">-R</span> /mnt<span class="token comment"># 重启</span><span class="token function">reboot</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="开启网络"><a class="markdownIt-Anchor" href="#开启网络">#</a> 开启网络</h3><p>重启后使用登录，若使用普通用户登录则有些命令之前需要加 sudo 以获得 root 权限</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 设置开机自启并立即启动 dhcp 服务</span>systemctl <span class="token builtin class-name">enable</span> <span class="token parameter variable">--now</span> dhcpcd <span class="token comment"># 测试网络连接</span><span class="token function">ping</span> www.bilibili.com <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>若为无线连接，还需要</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl start iwd <span class="token comment"># 立即启动 iwd</span>iwctl <span class="token comment"># 和之前的方式一样，连接无线网络</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>而本人之前遇到网络问题的解决方式，亲测可用</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 检查网络接口</span><span class="token function">ip</span> <span class="token function">link</span><span class="token comment"># 开启第二个接口</span><span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> dev ens33 up<span class="token comment"># 使用 dhcpcd 分配网络地址</span>dhcpcd<span class="token comment"># 将 dhcpcd 设置为自启</span>systemctl <span class="token builtin class-name">enable</span> dhcpcdsystemctl disable dhcpcd// 取消自启<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>到此 ArchLinux 已经安装完成啦，撒花❀，但是此时只有命令行的界面，稍后我们将安装图形化界面</p><h2 id="图形化桌面-kdeplasma"><a class="markdownIt-Anchor" href="#图形化桌面-kdeplasma">#</a> 图形化桌面 - KDE (plasma)</h2><p>Linux 的图形化桌面有 KDE、GONE、xfce 等等，这里使用 KDE</p><h3 id="安装-kde-plasma桌面环境"><a class="markdownIt-Anchor" href="#安装-kde-plasma桌面环境">#</a> 安装 KDE plasma 桌面环境</h3><p>安装最小相关软件包</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># plasma-meta 元软件包、konsole 终端模拟器和 dolphin 文件管理器</span><span class="token function">sudo</span> pacman <span class="token parameter variable">-S</span> plasma-meta konsole dolphin <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>kde-applications 则是 kde 全家桶<br> <code>sudo pacman -S plasma kde-applications</code> <br> 其中很多都没必要，而且我第一次装完后登录只显示黑屏与鼠标，不知道是部件有问题还是磁盘空间太小（应该是后者？使用最小包安装成功后我 sda2 12g 的存储空间只剩 5g 了）<br>假如你不慎安装了 kde 全家桶，想要卸载，可以使用以下命令卸载</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> pacman <span class="token parameter variable">-Rsc</span> plasma<span class="token function">sudo</span> pacman <span class="token parameter variable">-Rsc</span> kde-applications<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>kde 默认安装的是 xorg，如果想使用 wayland 的话安装以下包：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pacman <span class="token parameter variable">-S</span>  plasma-wayland-session xdg-desktop-portal<span class="token comment"># N卡用户需要额外安装egl-wayland,xdg-desktop-portal包是为了如obs此类工具录制屏幕使用</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>安装完成后，可以在登录时选择使用 xorg 还是 wayland<br> 另外，虚拟机环境下不需要显卡驱动</p><h3 id="配置-sddm"><a class="markdownIt-Anchor" href="#配置-sddm">#</a> 配置 sddm</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl <span class="token builtin class-name">enable</span> sddmsystemctl start sddm  <span class="token comment"># 直接启动显示管理器，与以下reboot命令二选一即可</span><span class="token function">reboot</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>基本的 kde 就安装完成了，之后更改需要的配置，挑选喜欢的主题，查找美化的教程，安装需要的软件，时常记得  <code>sudo pacman -Syu</code>  滚动更新防止滚挂</p><p>完结撒花，可以愉快地玩耍啦 ❀</p><h2 id="软件源配置"><a class="markdownIt-Anchor" href="#软件源配置">#</a> 软件源配置</h2><p>执行安装 archlinuxcn 源所需的相关步骤：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> pacman <span class="token parameter variable">-S</span> archlinuxcn-keyring <span class="token comment"># cn 源中的签名（archlinuxcn-keyring 在 archlinuxcn）</span><span class="token function">sudo</span> pacman <span class="token parameter variable">-S</span> yay <span class="token comment"># yay 命令可以让用户安装 AUR 中的软件（yay 在 archlinuxcn）</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>若安装 archlinuxcn-keyring 时报错，是由于密钥环的问题。<br>以 root 权限运行</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pacman <span class="token parameter variable">-Syu</span> havegedsystemctl start havegedsystemctl <span class="token builtin class-name">enable</span> haveged<span class="token function">rm</span> <span class="token parameter variable">-fr</span> /etc/pacman.d/gnupgpacman-key <span class="token parameter variable">--init</span>pacman-key <span class="token parameter variable">--populate</span> archlinuxpacman-key <span class="token parameter variable">--populate</span> archlinuxcn<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><p>出现这个问题：==&gt; 错误： 密钥环文件 /usr/share/pacman/keyrings/archlinuxcn.gpg 不存在。<br>解决方法是通过 git 方式安装 yay，再通过 yay 安装 archlinuxcn</p><p>git 安装 yay</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 安装 git</span><span class="token function">sudo</span> pacman <span class="token parameter variable">-S</span> base-devel <span class="token function">sudo</span> pacman <span class="token parameter variable">-S</span> <span class="token function">git</span><span class="token comment"># 进入 /opt 目录并克隆 yay 稳定版的 git 仓库。</span><span class="token builtin class-name">cd</span> /opt<span class="token function">sudo</span> <span class="token function">git</span> clone https://aur.archlinux.org/yay.git<span class="token comment"># 更改源目录的所有者。将 debugpoint 替换为你的用户名。</span><span class="token function">sudo</span> <span class="token function">chown</span> <span class="token parameter variable">-R</span> free:users ./yay<span class="token comment"># 进入目录进行编译</span><span class="token builtin class-name">cd</span> yaymakepkg <span class="token parameter variable">-si</span><span class="token comment"># 安装中出现 build 错误，卡在下载一个 go 的依赖包</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在 makepkg 过程中会因为 go 依赖的问题卡住，换源后再 makepkg<br> 不过 go 的代理推荐改用 https://proxy.golang.com.cn, 感觉其他代理有时不太行，因为在安装 vscode 的 go 工具时下载有时会失败<br><a href="https://zhuanlan.zhihu.com/p/439805266"> https://zhuanlan.zhihu.com/p/439805266</a></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /opt<span class="token builtin class-name">cd</span> yaymakepkg <span class="token parameter variable">-si</span> <span class="token comment"># yay 安装 archlinuxcn-keyring</span>yay <span class="token parameter variable">-S</span> archlinuxcn-keyring<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><p>问题已解决，推荐用上面的方法，下面安装 keyring 后，安装一些软件如 v2ray 时还是有密钥问题，上面的方法已经完全解决问题了，不过换源还是可以换一下的</p><hr><p>使用<a href="http://mirrors.ustc.edu.cn/help/archlinuxcn.html">中科大镜像源</a>，用清华源失败了，还是中科大的靠谱</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/pacman.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在末尾添加</p><pre class="line-numbers language-vim" data-language="vim"><code class="language-vim"><span class="token punctuation">[</span>archlinuxcn<span class="token punctuation">]</span>Server <span class="token operator">=</span> https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>mirrors<span class="token operator">.</span>ustc<span class="token operator">.</span>edu<span class="token operator">.</span><span class="token keyword">cn</span><span class="token operator">/</span>archlinuxcn<span class="token operator">/</span>$arch<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>安装 archlinuxcn-keyring</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> pacman <span class="token parameter variable">-S</span> archlinuxcn-keyring <span class="token comment"># 如出现错误让你使用 -Sy 安装</span><span class="token function">sudo</span> pacman <span class="token parameter variable">-Sy</span> archlinuxcn-keyring <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><hr><h2 id="软件安装"><a class="markdownIt-Anchor" href="#软件安装">#</a> 软件安装</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> pacman <span class="token parameter variable">-S</span> firefox chromium <span class="token comment"># 安装常用的火狐、chromium 浏览器</span><span class="token function">sudo</span> pacman <span class="token parameter variable">-S</span> ark <span class="token comment"># 压缩软件。在 dolphin 中可用右键解压压缩包</span><span class="token function">sudo</span> pacman <span class="token parameter variable">-S</span> gwenview <span class="token comment"># 图片查看器</span><span class="token function">sudo</span> pacman <span class="token parameter variable">-S</span> code <span class="token comment"># all in vscode，yyds</span><span class="token function">sudo</span> pacman <span class="token parameter variable">-S</span> go <span class="token comment"># golang</span><span class="token function">sudo</span> pacman <span class="token parameter variable">-S</span> <span class="token function">java</span> <span class="token comment"># java 其他编程语言应该都类似安装</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="进一步美化桌面"><a class="markdownIt-Anchor" href="#进一步美化桌面">#</a> 进一步美化桌面</h2><p><a href="https://zhuanlan.zhihu.com/p/558354279">https://zhuanlan.zhihu.com/p/558354279</a></p><h2 id="透明代理"><a class="markdownIt-Anchor" href="#透明代理">#</a> 透明代理</h2><p>sudo pacman -S v2ray v2raya</p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gin框架使用</title>
      <link href="/2023/01/30/gin%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8/"/>
      <url>/2023/01/30/gin%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="gin-简单使用"><a class="markdownIt-Anchor" href="#gin-简单使用">#</a> Gin 简单使用</h1><p>在这之前我们需要初始化项目</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">go mod init ginstudy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如果使用 goland 应该在项目创建时就会初始化并创建 go.mod 文件，我使用的 vs code 需要自己初始化项目</p><p>下载与安装 gin 框架<br><a href="https://gin-gonic.com/zh-cn/docs/">请查阅官方文档</a><br>下载并安装 gin：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">go get <span class="token parameter variable">-u</span> github.com/gin-gonic/gin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>虽然用了代理但有时候下载依赖还是很慢，不知道为什么，多试几次</p><p>项目引入 gin</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">import</span> <span class="token string">"github.com/gin-gonic/gin"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>代码 + 极其详细的注释就是最好的学习文档</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token punctuation">(</span><span class="token string">"github.com/gin-gonic/gin"</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">sayHello</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//返回和json格式的数据，状态码为200</span><span class="token comment">/* gin.H//H is a shortcut for map[string]interface&#123;&#125;   key为string类型，value为任意类型type H map[string]any*/</span>c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">&#123;</span><span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"hello golang"</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//创建一个默认的路由引擎 *gin.Engine</span>r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// GET：GET请求方式；  /hello：请求的路径</span><span class="token comment">// 当客户端以GET方式请求/hello路径时，会执行后面的函数sayHello</span>r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/hello"</span><span class="token punctuation">,</span> sayHello<span class="token punctuation">)</span><span class="token comment">//启动服务,在指定端口监听</span>r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">":9090"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">//运行</span><span class="token comment">//访问localhost:9090/hello，显示&#123;"message":"hello golang"&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>RESTfulAPI<br> 在 main () 中加入以下请求方法</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">   r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/book"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">&#123;</span><span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"GET"</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>r<span class="token punctuation">.</span><span class="token function">POST</span><span class="token punctuation">(</span><span class="token string">"/book"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">&#123;</span><span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>r<span class="token punctuation">.</span><span class="token function">PUT</span><span class="token punctuation">(</span><span class="token string">"/book"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">&#123;</span><span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"PUT"</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>r<span class="token punctuation">.</span><span class="token function">DELETE</span><span class="token punctuation">(</span><span class="token string">"/book"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">&#123;</span><span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"DELETE"</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过浏览器访问只能使用 GET 和 POST 请求，我们使用 api 测试工具进行测试<br> api 工具有 postman、apipost、apifox 等，我这里使用 apipost 测试</p>]]></content>
      
      
      <categories>
          
          <category> golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>go与前端的json数据交互笔记</title>
      <link href="/2023/01/30/go%E4%B8%8E%E5%89%8D%E7%AB%AF%E7%9A%84json%E6%95%B0%E6%8D%AE%E4%BA%A4%E4%BA%92/"/>
      <url>/2023/01/30/go%E4%B8%8E%E5%89%8D%E7%AB%AF%E7%9A%84json%E6%95%B0%E6%8D%AE%E4%BA%A4%E4%BA%92/</url>
      
        <content type="html"><![CDATA[<h1 id="go-与前端的-json-数据交互"><a class="markdownIt-Anchor" href="#go-与前端的-json-数据交互">#</a> Go 与前端的 JSON 数据交互</h1><p>golang 处理 json 数据<br> <code>encoding/json</code>  包中的 <code>json.Unmarshal</code>  与 <code>json.Marshal</code> <br> <code>json.Unmarshal</code> : 解析 json 的 byte 类型数据，转换成结构体对象<br> <code>json.Marshal</code> : 将结构体对象转换成 json 的 byte 类型数据</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> Message <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span><span class="token comment">//后面的json字段与需要对应的json格式的字段一致,不一致则json与结构体对象无法互相转换</span><span class="token comment">//例：&#123;"address":"127.0.0.1:40000"，"body":"1234"&#125;</span>Address <span class="token builtin">string</span> <span class="token string">`json:"address"`</span>Body    <span class="token builtin">string</span> <span class="token string">`json:"body"`</span><span class="token punctuation">&#125;</span><span class="token comment">//（a *App）是使用wails的要求，可以无视</span><span class="token keyword">func</span> <span class="token punctuation">(</span>a <span class="token operator">*</span>App<span class="token punctuation">)</span> <span class="token function">NewConnection</span><span class="token punctuation">(</span>Msg <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span><span class="token comment">//接收前端json字符串Msg</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"字符串"</span><span class="token punctuation">,</span> Msg<span class="token punctuation">)</span><span class="token comment">//结构体对象 mes</span><span class="token keyword">var</span> mes Message<span class="token comment">//将json字符串解析，Unmarshal解析需要先将json数据转为[]byte类型，返回值是错误类型</span><span class="token comment">//解析后转换成结构体对象mes</span>err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>Msg<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>mes<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ERROR:"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">&#125;</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"ERROR"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"接收json"</span><span class="token punctuation">,</span> mes<span class="token punctuation">.</span>Address<span class="token punctuation">)</span>mes<span class="token punctuation">.</span>Address <span class="token operator">=</span> <span class="token string">"111"</span>mes<span class="token punctuation">.</span>Body <span class="token operator">=</span> <span class="token string">"222"</span>    <span class="token comment">//Marshal将对象转换成json，返回[]byte和error</span>mesJson<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Marshal</span><span class="token punctuation">(</span>mes<span class="token punctuation">)</span> fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"转换json"</span><span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>mesJson<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">//返回json字符串</span><span class="token keyword">return</span> <span class="token function">string</span><span class="token punctuation">(</span>mesJson<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>前端处理 json 数据<br> <code>JSON.stringify</code> : 将 json 对象转换成 json 字符串<br> <code>JSON.parse</code> : 将 json 字符串转换成 json 对象</p><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;script setup&gt;import &#123; reactive &#125; from &#39;vue&#39;&#x2F;&#x2F;使用wails的要求，就是直接引用go的NewConnection函数import &#123; NewConnection &#125; from &#39;..&#x2F;..&#x2F;wailsjs&#x2F;go&#x2F;main&#x2F;App&#39;&#x2F;&#x2F;消息json对象const msg &#x3D; reactive(&#123;    address: &quot;&quot;,    body: &quot;&quot;&#125;)&#x2F;&#x2F;使用const后不能改变对象，但可以改变对象的属性&#x2F;&#x2F;例msg&#x3D;JSON.parse(result),msg不会发生变化，但可以使其属性发生变化 msg.body&#x3D;222&#x2F;&#x2F;如要使对象能够改变，请使用let定义对象let reply&#x3D;reactive(&#123;    address:&quot;1&quot;,    body:&quot;1&quot;&#125;)function newConnection() &#123;    &#x2F;&#x2F;后端不能识别json对象，使用JSON.stringify将json对象转换成json字符串    NewConnection(JSON.stringify(msg)).then(result &#x3D;&gt; &#123;        msg.body&#x3D;result        &#x2F;&#x2F;使用JSON.parse将json字符串转换成json对象        reply&#x3D;JSON.parse(result)        alert(JSON.stringify(reply))            &#125;)&#125;&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;template&gt;    &lt;div id&#x3D;&quot;input&quot; class&#x3D;&quot;input-box&quot;&gt;        &lt;input id&#x3D;&quot;address&quot; v-model&#x3D;&quot;msg.address&quot; autocomplete&#x3D;&quot;off&quot; class&#x3D;&quot;input&quot; type&#x3D;&quot;text&quot; &#x2F;&gt;        &lt;button class&#x3D;&quot;btn&quot; @click&#x3D;&quot;newConnection&quot;&gt;连接&lt;&#x2F;button&gt;    &lt;&#x2F;div&gt;    &lt;textarea id&#x3D;&quot;text&quot; v-model&#x3D;&quot;msg.body&quot; class&#x3D;&quot;text&quot;&gt;&lt;&#x2F;textarea&gt;    &lt;textarea id&#x3D;&quot;text&quot; v-model&#x3D;&quot;reply.body&quot; class&#x3D;&quot;text&quot;&gt;&lt;&#x2F;textarea&gt;&lt;&#x2F;template&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;style scoped&gt;.result &#123;    height: 20px;    line-height: 20px;    margin: 1.5rem auto;&#125;.input-box .btn &#123;    width: 60px;    height: 30px;    line-height: 30px;    border-radius: 3px;    border: none;    margin: 0 0 0 20px;    padding: 0 8px;    cursor: pointer;&#125;.text &#123;    width: 200px;    height: 200px;    line-height: 30px;&#125;&lt;&#x2F;style&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>输入 127.0.0.6666，点击连接按钮，运行结果：<br>前端显示</p>]]></content>
      
      
      <categories>
          
          <category> golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue3 速成指南</title>
      <link href="/2023/01/30/vue3%20%E9%80%9F%E6%88%90%E6%8C%87%E5%8D%97/"/>
      <url>/2023/01/30/vue3%20%E9%80%9F%E6%88%90%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<h1 id="vue3-组合式-api"><a class="markdownIt-Anchor" href="#vue3-组合式-api">#</a> Vue3 组合式 API</h1><p>创建 vue 应用</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">初始化vue项目   <span class="token function">npm</span> init vue@latest进入项目文件夹  <span class="token builtin class-name">cd</span> 项目安装依赖        <span class="token function">npm</span> install<span class="token punctuation">(</span>简写：npm i<span class="token punctuation">)</span>运行项目        <span class="token function">npm</span> dev<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>一、基础文件<br><strong> App.vue</strong><br> 创建组件 App<br><strong>main.js</strong><br>import 引入组件 App，将 App 挂载到 <code>#app</code> <br><strong>index.html</strong><br> <code>#app</code>  即为此处的 <code>&lt;div id=&quot;app&quot;&gt;&lt;/div&gt;</code></p><p>通过 main.js 将 vue 代码转换为 html 代码<br>二、基础语法<br> vue3 与 vue2 的区别在于 script 模块，抛弃难看的 vue2 选项式，使用 <code>setup</code> ，拥抱最新最潮的组合式 api 吧</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script<span class="token operator">></span>    <span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">&#123;</span>        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span><span class="token punctuation">&#123;</span>            <span class="token comment">//return上面setup()中的变量、方法等</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>再进一步改用最新最潮的 setup 语法糖吧，使用后会自动 return</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script setup<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="1定义对象与变量响应式"><a class="markdownIt-Anchor" href="#1定义对象与变量响应式">#</a> 1. 定义对象与变量（响应式）</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span>reactive<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token keyword">const</span> person <span class="token operator">=</span><span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">"小明"</span>    <span class="token literal-property property">age</span><span class="token operator">:</span><span class="token string">"18"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>reactive 绑定一个 person 对象。对于只学过后端的同学需要注意 js 中的对象与后端语言的对象有一定的不同，js 是没有后端类的概念的，由于对象并不和类关联， 于是可以随意地给这个对象增加属性<br><a href="https://blog.csdn.net/fhjdzkp/article/details/79707749">关于 js 对象，有、东西的解释</a></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span>ref<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token keyword">const</span> person<span class="token operator">=</span><span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">"小明"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ref 底层的本质其实还是 reactive，系统会自动根据我们给 ref 传入的值将它转换成</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">ref</span><span class="token punctuation">(</span>xx<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">value</span><span class="token operator">:</span>xx<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>所以上面的</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> person<span class="token operator">=</span><span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">"小明"</span><span class="token punctuation">)</span><span class="token comment">//等价于</span><span class="token keyword">const</span> person<span class="token operator">=</span><span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token literal-property property">value</span><span class="token operator">:</span><span class="token string">"小明"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>一般使用 ref 定义基础数据类型的值，用 reactive 定义对象或数组</p><h2 id="2定义方法"><a class="markdownIt-Anchor" href="#2定义方法">#</a> 2. 定义方法</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> money<span class="token operator">=</span><span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">//写法1</span><span class="token keyword">function</span> <span class="token function">moneyUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    money<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">&#125;</span><span class="token comment">//写法2</span><span class="token keyword">let</span> <span class="token function-variable function">moneyUp</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    money<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">&#125;</span><span class="token comment">//写法3,箭头函数</span><span class="token keyword">let</span> <span class="token function-variable function">moneyUp</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span>    money<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>箭头函数写法似乎在某些情况下不推荐使用，那么就干脆以前两种为准</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script setup<span class="token operator">></span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span>ref<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token keyword">let</span> money<span class="token operator">=</span><span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">moneyUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    money<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span class="token operator">&lt;</span>template<span class="token operator">></span>    <span class="token operator">&lt;</span>p<span class="token operator">></span>现在有<span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>money<span class="token punctuation">.</span>value<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>元<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"moneyUp"</span><span class="token operator">></span>加钱<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://cloud.tencent.com/developer/article/1495550">JS 箭头函数之：为何用？怎么用？何时用？</a></p><h2 id="3计算属性computed"><a class="markdownIt-Anchor" href="#3计算属性computed">#</a> 3. 计算属性 computed</h2><p>“若我们将同样的函数定义为一个方法而不是计算属性，两种方式在结果上确实是完全相同的，然而，不同之处在于计算属性值会基于其响应式依赖被缓存。一个计算属性仅会在其响应式依赖更新时才重新计算。”（也就是计算属性依赖的数据改变缓存才会改变，而方法没有，需要缓存的话就用计算属性）<br><a href="https://www.cnblogs.com/Renyi-Fan/p/12735661.html">VUE 疑难问题 —2、方法和计算属性的区别</a></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span>ref<span class="token punctuation">,</span>computed<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token keyword">const</span> money<span class="token operator">=</span><span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">const</span> moneyUp <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> money<span class="token punctuation">.</span>value<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://cn.vuejs.org/guide/essentials/computed.html">看官网吧</a><br>计算属性默认是只读的。当你尝试修改一个计算属性时，你会收到一个运行时警告。只在某些特殊场景中你可能才需要用到 “可写” 的属性，你可以通过同时提供 getter 和 setter 来创建：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> fullName <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  <span class="token comment">// getter</span>  <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> firstName<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> lastName<span class="token punctuation">.</span>value  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token comment">// setter</span>  <span class="token function">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 注意：我们这里使用的是解构赋值语法</span>    <span class="token punctuation">[</span>firstName<span class="token punctuation">.</span>value<span class="token punctuation">,</span> lastName<span class="token punctuation">.</span>value<span class="token punctuation">]</span> <span class="token operator">=</span> newValue<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4监听watch"><a class="markdownIt-Anchor" href="#4监听watch">#</a> 4. 监听 watch</h2><p><a href="https://blog.csdn.net/qq_36995521/article/details/122576076">https://blog.csdn.net/qq_36995521/article/details/122576076</a><br> 这个可以，简洁明了👍<br><a href="https://www.yisu.com/zixun/614924.html">https://www.yisu.com/zixun/614924.html</a></p><p>5. 路由<br>这个不戳👍<br><a href="https://kalacloud.com/blog/vue-router-tutorial-for-vue-3/">https://kalacloud.com/blog/vue-router-tutorial-for-vue-3/</a></p><p>1) 在 views 文件夹下创建不同的页面组件<br>组件的名称需使用驼峰命名。且如果只有一个单词时会报错，</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Component name  should always be multi-word <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这是正常的，你问我怎么办？虽然也可以关掉 eslint 语法检查，但还是改名字吧😅</p><p>2) 在路由 js 文件下引入页面组件，定义这些组件的名称 name 与路径 path<br>3) 路由 js 文件引入创建路由的方法，根据这些页面组件创建路由<br> 4) App.vue 使用路由 js 的路径 path 引入页面组件，关于使用的标签 <code>router-link</code> 、 <code>&lt;router-view/&gt;</code></p><blockquote><p>通过 <code>router-link</code>  可以使 <code>&lt;router-view/&gt;</code>  中的显示内容路由（跳转）到 src/router/index.js 文件中配置的组件中去</p></blockquote><p>5) main.js 使用 router</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'./router'</span><span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>6) 路由进阶 - 导航栏<br><a href="https://www.jianshu.com/p/c964a988b143"> https://www.jianshu.com/p/c964a988b143</a><br> 看了好多都是用框架，不利于理解<br>这个简单易懂👇👍<br><a href="https://blog.csdn.net/weixin_40400161/article/details/96711757">https://blog.csdn.net/weixin_40400161/article/details/96711757</a><br>1 - 创建需要跳转的页面组件<br> 2 - 配置路由跳转 js 文件<br> 3 - 创建导航栏组件，设定样式， <code>router-link</code>  写在这里<br> 4 - 在 App.vue 中使用，可以自定义显示布局</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>导航栏组件<span class="token operator">/</span><span class="token operator">></span><span class="token operator">&lt;</span>router<span class="token operator">-</span>view<span class="token operator">/</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>5. 自定义布局<br><a href="https://www.cnblogs.com/zouzou-busy/p/13080665.html"> https://www.cnblogs.com/zouzou-busy/p/13080665.html</a></p><p>插播一条<br><a href="https://www.cnblogs.com/Renyi-Fan/p/12319825.html">单双引号的使用似乎并不严格区分 - 某博客</a><br><a href="https://www.zhihu.com/question/21168673">单双引号的使用似乎并不严格区 - 知乎</a><br>总结:<br>1. 使用单引号，每次能少按 shift 键，每天要用 100 个引号那么一年就能少按 3 万 6 个键<br> 2. 与</p>]]></content>
      
      
      <categories>
          
          <category> vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>前后端交互</title>
      <link href="/2023/01/30/%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BA%A4%E4%BA%92/"/>
      <url>/2023/01/30/%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BA%A4%E4%BA%92/</url>
      
        <content type="html"><![CDATA[<h1 id="前后端交互"><a class="markdownIt-Anchor" href="#前后端交互">#</a> 前后端交互</h1><h2 id="一-后端写好需要调用的函数"><a class="markdownIt-Anchor" href="#一-后端写好需要调用的函数">#</a> 一、后端写好需要调用的函数</h2><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token punctuation">(</span><span class="token string">"fmt"</span><span class="token string">"net/http"</span><span class="token punctuation">)</span><span class="token comment">//定义函数NewConnection</span><span class="token comment">//http.Response：后端返回给前端的响应</span><span class="token comment">// *http.Request：前端传给后端的请求</span><span class="token keyword">func</span> <span class="token function">NewConnection</span><span class="token punctuation">(</span>response http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span>request <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>str<span class="token operator">:=</span><span class="token string">"asdfghjkl"</span><span class="token comment">//写入需要返回响应的内容，[]byte类型</span>response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//注册路由，即定义访问的路径及其调用的函数</span>http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/connect"</span><span class="token punctuation">,</span>NewConnection<span class="token punctuation">)</span>    <span class="token comment">//启动服务并指定监听端口</span>err<span class="token operator">:=</span>http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">":9090"</span><span class="token punctuation">,</span><span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token keyword">if</span> err<span class="token operator">!=</span><span class="token boolean">nil</span><span class="token punctuation">&#123;</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"启动服务失败:"</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">//执行 go run main.go 启动服务</span><span class="token comment">//在浏览器访问localhost:9090/connect</span><span class="token comment">//可以看到 asdfghjkl字符串</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="二-前端使用axios进行调用"><a class="markdownIt-Anchor" href="#二-前端使用axios进行调用">#</a> 二、前端使用 axios 进行调用</h2><p>下载 axios</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> i axios<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>import 导入</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>使用 axios</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    msg<span class="token punctuation">.</span>body<span class="token operator">=</span><span class="token string">"2"</span><span class="token punctuation">,</span>    reply<span class="token punctuation">.</span>body<span class="token operator">=</span><span class="token string">"2"</span>    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"1111111"</span><span class="token punctuation">)</span>    axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"http://127.0.0.1:9090/connect"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=></span><span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"222222"</span><span class="token punctuation">)</span>        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"000000"</span><span class="token punctuation">)</span>        reply<span class="token punctuation">.</span>body<span class="token operator">=</span><span class="token function">string</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>点击连接按钮，newConnection 没有弹窗，F12 查看控制台发现报错</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">GET http://127.0.0.1:9090/connect net::ERR_FAILED <span class="token number">200</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>但是后端控制台成功打印</p><pre class="line-numbers language-none"><code class="language-none">请求：&amp;&#123;GET &#x2F;connect HTTP&#x2F;1.1 1 1 map[Accept:[application&#x2F;json, text&#x2F;plain, *&#x2F;*] Accept-Encoding:[gzip, deflate, br] Accept-Language:[zh-CN,zh;q&#x3D;0.9,en;q&#x3D;0.8,en-GB;q&#x3D;0.7,en-US;q&#x3D;0.6] Cache-Control:[no-cache] Connection:[keep-alive] Origin:[http:&#x2F;&#x2F;127.0.0.1:5173] Pragma:[no-cache] Referer:[http:&#x2F;&#x2F;127.0.0.1:5173&#x2F;] Sec-Ch-Ua:[&quot;Not?A_Brand&quot;;v&#x3D;&quot;8&quot;, &quot;Chromium&quot;;v&#x3D;&quot;108&quot;, &quot;Microsoft Edge&quot;;v&#x3D;&quot;108&quot;] Sec-Ch-Ua-Mobile:[?0] Sec-Ch-Ua-Platform:[&quot;Windows&quot;] Sec-Fetch-Dest:[empty] Sec-Fetch-Mode:[cors] Sec-Fetch-Site:[same-site] User-Agent:[Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;108.0.0.0 Safari&#x2F;537.36 Edg&#x2F;108.0.1462.76]] &#123;&#125; &lt;nil&gt; 0 [] false 127.0.0.1:9090 map[] map[] &lt;nil&gt; map[] 127.0.0.1:52006 &#x2F;connect &lt;nil&gt; &lt;nil&gt; &lt;nil&gt; 0xc0001042c0&#125;     <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>通过对代码以及报错信息分析，问题出现在跨域请求上，<br>（跨域请求：跨域是指浏览器不允许当前所在的源请求去访问另一个不一样的源请求，源是指请求协议、域名、端口号，这三个如果有一个不一致就是跨域请求）请自行了解，关键词：跨域请求，同源策略</p><p>使用 spring boot 的时候应该是加注解后自动处理了，但无法知晓原理，不过现在遇到这个问题可以深入了解一下</p><p>首先将发送请求的前端作为客户端，接收请求的作为服务端，<br>而从我们上面的测试已经可以看出，跨域是客户端单方面拒绝响应，服务端是接收请求并处理了的。</p><p>spring boot 后端处理：<br>在 每个 Controller 类上加入 @CrossOrigin 注解<br>或者在 Controller 的基类中加上 @CrossOrigin 注解然后其他 Controller 类就有了这个 @Controller<br> 此时跨域访问就不会报错了。</p><h2 id="三-跨域问题与同源策略"><a class="markdownIt-Anchor" href="#三-跨域问题与同源策略">#</a> 三、跨域问题与同源策略</h2><p>三种方法：JSONP、cors、代理，本文使用代理方法解决</p><h3 id="1jsonp"><a class="markdownIt-Anchor" href="#1jsonp">#</a> 1.JSONP</h3><p>JSONP 是一种非官方的跨域数据交互协议<br>原理：利用 <code>&lt;script&gt;</code>   <code>&lt;img&gt;</code>   <code>&lt;iframe&gt; </code> 等标签可以引入不同域资源的特性，将需要发送的请求的路径作为 src 参数，告知服务端回调函数的函数名<br>例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"http://example.com/data.php?callback=dosomething"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>只支持 GET 请求，而不支持 POST 请求等其他类型的 HTTP 请求，现在一般不用，不需要浪费时间去学</p><h3 id="2cors"><a class="markdownIt-Anchor" href="#2cors">#</a> 2.cors</h3><p>Cross-origin resource sharing 跨域资源共享。<br>它是一个新的 W3C 标准，它新增的一组 HTTP 首部字段，允许服务端其声明哪些源站有权限访问哪些资源</p><p>后端允许跨域：<br>配合例子说明：<br><a href="https://blog.csdn.net/guoer9973/article/details/54341637">https://blog.csdn.net/guoer9973/article/details/54341637</a></p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">LDNS</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> req <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> origin <span class="token operator">:=</span> req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"Origin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> origin <span class="token operator">!=</span> <span class="token string">""</span> <span class="token punctuation">&#123;</span>        w<span class="token punctuation">.</span><span class="token function">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Origin"</span><span class="token punctuation">,</span> origin<span class="token punctuation">)</span>        w<span class="token punctuation">.</span><span class="token function">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Methods"</span><span class="token punctuation">,</span> <span class="token string">"POST, GET, OPTIONS, PUT, DELETE"</span><span class="token punctuation">)</span>        w<span class="token punctuation">.</span><span class="token function">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Headers"</span><span class="token punctuation">,</span>            <span class="token string">"Accept, Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, Authorization"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> req<span class="token punctuation">.</span>Method <span class="token operator">==</span> <span class="token string">"OPTIONS"</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// 响应http code</span>    w<span class="token punctuation">.</span><span class="token function">WriteHeader</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>    query <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>Host<span class="token punctuation">,</span> <span class="token string">"."</span><span class="token punctuation">)</span>    value<span class="token punctuation">,</span> err <span class="token operator">:=</span> ldns<span class="token punctuation">.</span>RAMDBMgr<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>query<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Origin"</span><span class="token punctuation">,</span> <span class="token string">"*"</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>        io<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">`&#123;"message": ""&#125;`</span><span class="token punctuation">)</span>        <span class="token keyword">return</span>    <span class="token punctuation">&#125;</span>    io<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">//本人没测试过，只是拿来了解原理用的</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>go 的跨域有现成的库可以使用</p><pre class="line-numbers language-none"><code class="language-none">go get github.com&#x2F;gin-contrib&#x2F;cors<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>我在<a href="/2023/02/27/go%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B-%E5%AE%9E%E6%97%B6%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86/" title="go的多线程-实时数据采集">go的多线程-实时数据采集</a>的 <code>路由设置</code> 里有使用</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> res<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>        req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"org.apache.catalina.ASYNC_SUPPORTED"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">HttpServletResponse</span> response <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">)</span> res<span class="token punctuation">;</span>        response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Origin"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span> req<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">"Origin"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Methods"</span><span class="token punctuation">,</span> <span class="token string">"POST, GET, OPTIONS, DELETE,PUT"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Max-Age"</span><span class="token punctuation">,</span> <span class="token string">"3600"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Headers"</span><span class="token punctuation">,</span> <span class="token string">"Content-Disposition,Origin, X-Requested-With, Content-Type, Accept,Authorization,id_token"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Credentials"</span><span class="token punctuation">,</span><span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Security-Policy"</span><span class="token punctuation">,</span> <span class="token string">"default-src 'self' 'unsafe-inline'; script-src 'self'; frame-ancestors 'self'; object-src 'none'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"X-Content-Type-Options"</span><span class="token punctuation">,</span> <span class="token string">"nosniff"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"X-XSS-Protection"</span><span class="token punctuation">,</span> <span class="token string">"1; mode=block"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//本人没测试过，只是拿来了解原理用的</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>请参考<a href="https://www.jianshu.com/p/26d88431dc1b">这篇文章</a></p><p>需要设置请求返回的响应头 Header,<br> 详细设置内容讲解可以见<a href="https://www.jianshu.com/p/f880878c1398">这篇文章</a></p><p>前端设置跨域并允许携带 cookie：<br>前端请求库一般有两种：流行框架下 react 或者 vue 使用 axios、fetch 这两者都可以，设置允许跨域的方式有点不一样。<br>原生 fetch</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'localhost:3000'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span>      <span class="token comment">/*允许携带cookies，默认情况没写这个是不会携带的*/</span>      <span class="token literal-property property">credentials</span><span class="token operator">:</span> <span class="token string">'include'</span><span class="token punctuation">,</span>      <span class="token comment">/*允许跨域**/</span>      <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'cors'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>axios</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span><span class="token comment">// 对所有 axios 请求允许携带cookie</span>axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>withCredentials <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">// 对单独的 axios 请求允许携带cookie</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'localhost:3000'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">withCredentials</span><span class="token operator">:</span> <span class="token boolean">true</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3使用代理本文使用的方法"><a class="markdownIt-Anchor" href="#3使用代理本文使用的方法">#</a> 3. 使用代理 (本文使用的方法)</h3><p><a href="https://juejin.cn/post/7112373669594136612">https://juejin.cn/post/7112373669594136612</a><br> 已知：</p><blockquote><ol><li>同源策略</li><li>跨域是请求方单方面拒绝响应，接收方是接收请求并处理了。</li><li>代理服务器不是浏览器，它没有同源策略的限制</li></ol></blockquote><p>所以使用代理的解决方法是：<br>1）请求方发送请求给代理服务器，代理成功接收请求<br> 2）代理将请求做了一点修改，把请求方的域名换装成与接收方同源的域名，然后再发送请求给接收方<br> 3）接收方成功接收并处理数据，返回响应给代理，代理成功接收响应<br> 4）代理将响应做了一点修改，把接收方的域名换装成与请求方同源的域名，然后再发送给请求方<br> 5）请求方成功接收响应</p><p>vue 配置代理的方法：<br><a href="https://blog.csdn.net/qq_45787691/article/details/128074655">https://blog.csdn.net/qq_45787691/article/details/128074655</a></p><p>这里我使用 vite 构建的项目，故使用 vite 配置代理</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> defineConfig <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vite'</span><span class="token keyword">import</span> vue <span class="token keyword">from</span> <span class="token string">'@vitejs/plugin-vue'</span><span class="token comment">// https://vitejs.dev/config/</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment">//以上为其他配置</span>  <span class="token comment">//代理配置</span>  <span class="token literal-property property">server</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>    <span class="token literal-property property">proxy</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>        <span class="token string-property property">'/api'</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>            <span class="token comment">//https: true, // 默认是false, 默认就是http协议，true将http协议转换为https协议</span>            <span class="token comment">// 配置需要代理的路径 --> 这里的意思是代理 http://localhost:默认端口/api/后的所有路由</span>            <span class="token literal-property property">target</span><span class="token operator">:</span><span class="token string">'http://127.0.0.1:9090'</span><span class="token punctuation">,</span><span class="token comment">//目标服务器地址</span>            <span class="token literal-property property">changeOrigin</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//允许跨域</span>            <span class="token literal-property property">ws</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//允许websocket跨域</span>            <span class="token comment">// 把路径中的 /api都替换为空的字符串</span>            <span class="token comment">// 因为服务端地址里面是没有api字段的，api只是为了区别需要代理的路径，如果服务端有api字段则不需要替换</span>            <span class="token function-variable function">rewrite</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span><span class="token operator">=></span>path<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\/api</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用代理与 axios</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    msg<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">"2"</span><span class="token punctuation">,</span>        reply<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">"2"</span>    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"1111111"</span><span class="token punctuation">)</span>    axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/api/connect"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token comment">//console.log("222222")</span>        <span class="token comment">//alert("000000")</span>        reply<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>终于成功了，注意 res 是一个对象，我们将它转换为字符串</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"data"</span><span class="token operator">:</span><span class="token string">"asdfghjkl"</span><span class="token punctuation">,</span><span class="token property">"status"</span><span class="token operator">:</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token property">"statusText"</span><span class="token operator">:</span><span class="token string">"OK"</span><span class="token punctuation">,</span><span class="token property">"headers"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"access-control-allow-origin"</span><span class="token operator">:</span><span class="token string">"*"</span><span class="token punctuation">,</span><span class="token property">"connection"</span><span class="token operator">:</span><span class="token string">"close"</span><span class="token punctuation">,</span><span class="token property">"content-length"</span><span class="token operator">:</span><span class="token string">"9"</span><span class="token punctuation">,</span><span class="token property">"content-type"</span><span class="token operator">:</span><span class="token string">"text/plain; charset=utf-8"</span><span class="token punctuation">,</span><span class="token property">"date"</span><span class="token operator">:</span><span class="token string">"Mon, 09 Jan 2023 08:41:30 GMT"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token property">"config"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"transitional"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"silentJSONParsing"</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">"forcedJSONParsing"</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">"clarifyTimeoutError"</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token property">"adapter"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"xhr"</span><span class="token punctuation">,</span><span class="token string">"http"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">"transformRequest"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token null keyword">null</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">"transformResponse"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token null keyword">null</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">"timeout"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">"xsrfCookieName"</span><span class="token operator">:</span><span class="token string">"XSRF-TOKEN"</span><span class="token punctuation">,</span><span class="token property">"xsrfHeaderName"</span><span class="token operator">:</span><span class="token string">"X-XSRF-TOKEN"</span><span class="token punctuation">,</span><span class="token property">"maxContentLength"</span><span class="token operator">:</span><span class="token number">-1</span><span class="token punctuation">,</span><span class="token property">"maxBodyLength"</span><span class="token operator">:</span><span class="token number">-1</span><span class="token punctuation">,</span><span class="token property">"env"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token property">"headers"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"Accept"</span><span class="token operator">:</span><span class="token string">"application/json, text/plain, */*"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token property">"method"</span><span class="token operator">:</span><span class="token string">"get"</span><span class="token punctuation">,</span><span class="token property">"url"</span><span class="token operator">:</span><span class="token string">"/api/connect"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token property">"request"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这个返回是完整的 http 响应，我们只需要响应的数据 data 即可</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">reply<span class="token punctuation">.</span>body <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>同样后端只需要请求的内容</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"请求：%v"</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>Body<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>当然我们只是调用了方法，请求内容为空，控制台打印</p><pre class="line-numbers language-none"><code class="language-none">&#123;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
            <tag> vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue初学笔记-单文件组件</title>
      <link href="/2022/12/19/vue%E5%88%9D%E5%AD%A6%E7%AC%94%E8%AE%B0-%E5%8D%95%E6%96%87%E4%BB%B6%E7%BB%84%E4%BB%B6/"/>
      <url>/2022/12/19/vue%E5%88%9D%E5%AD%A6%E7%AC%94%E8%AE%B0-%E5%8D%95%E6%96%87%E4%BB%B6%E7%BB%84%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="参考项目结构"><a class="markdownIt-Anchor" href="#参考项目结构">#</a> 参考项目结构</h1><p><a href="http://doc.ruoyi.vip/ruoyi-vue/">royi 前后端分离的 vue 项目</a><br>在 vue 项目的 src 文件夹下</p><pre class="line-numbers language-none"><code class="language-none">|_src    |_api    |_assets    |_components    |_directive    |_icons    |_layout    |_plugins    |_router    |_store    |_styles    |_utils    |_views        app.vue    main.js    permission.js    setting.js<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><p><strong>api</strong>：接口文件夹，存放对数据接口封装的方法（前后端交互的接口，此处需要声明前端需要使用的方法，该方法在后端的 URL 路径，请求方式（get、post 等），参数）。前端在处理业务需要调用后端方法时，import 此处 api 文件夹里相应 js 文件里的方法，这个方法通过 url，请求方式与参数与后端建立映射。<br><strong>assets</strong>：静态资源文件夹，存放图片，css 样式等资源<br><strong> components</strong>：组件库文件夹，存放组件（一些可复用，非独立的页面），也可以创建完整页面，但一般完整页面会在 views 文件夹编写<br><strong> directive</strong>：指令文件夹，可以在这里自定义像 v-for、v-if 之类的指令以供使用<br><a href="https://blog.csdn.net/wuj1935/article/details/120705144"> https://blog.csdn.net/wuj1935/article/details/120705144</a></p><p><strong>icons</strong>：图标文件夹<br><strong> layout</strong>：公共布局组件文件，如项目页面顶部栏区域、侧边导航栏 (大部分页面公共的布局)<br><strong>plugins</strong>: 插件文件夹，自定义插件<br><strong> router</strong>: 路由配置文件，存放路由跳转的配置信息，路由用于设定访问路径，并将路径和组件映射起来，访问对应的路径就会跳转到相应的页面（组件）<br><a href="https://blog.csdn.net/wulala_hei/article/details/80488727">vue 路由</a><br><strong> store</strong>：存放 vuex 为 vue 专门开发的状态管理器<br><strong> styles</strong>：全局样式文件<br><strong> utils</strong>: 工具包文件夹，存放工具函数<br><strong> views</strong>：视图文件夹，存放各个页面的 vue 文件<br><strong> app.vue</strong>：项目的主组件，页面入口文件 ，所有页面都在 app.vue 下进行切换，app.vue 负责构建定义及页面组件归集<br><strong> main.js</strong>: 实例化 Vue、放置项目中经常会用到的插件和 CSS 样式、存储全局变量<br><strong> permission.js</strong>: 权限管理<br><strong> setting.js</strong>: 配置<br><a href="https://juejin.cn/post/7041506596597432334">配置篇 (settings.js)</a></p><hr><p>一般来说，我们只需要了解 api、router、views 文件夹、app.vue、main.js 的内容</p><h2 id="xxxvue文件单文件组件sfc"><a class="markdownIt-Anchor" href="#xxxvue文件单文件组件sfc">#</a> xxx.vue 文件（单文件组件 / SFC）</h2><p><a href="https://cn.vuejs.org/api/sfc-spec.html">vue 官方文档 - 单文件组件语法定义</a><br><a href="https://cn.vuejs.org/guide/scaling-up/sfc.html"> vue 官方文档 - 应用规模化 - 单文件组件</a><br><a href="https://blog.csdn.net/XOIIUUZZ/article/details/103095298"> https://blog.csdn.net/XOIIUUZZ/article/details/103095298</a><br> 首先我们需要了解一下一个 vue 文件一般由哪些部分组成<br>单个 vue 文件被称为单文件组件（Single-File Component，缩写为 SFC），其内容为 html、css、js 的延伸<br> Vue SFC 是一个框架指定的文件格式，因此必须交由 @vue/compiler-sfc 编译为标准的 JavaScript 和 CSS，一个编译后的 SFC 是一个标准的  <code>JavaScript(ES) 模块</code></p><p>一个.vue 文件主要有 3 个部分<br> <code>&lt;template&gt;</code>  显示的内容 <code>&lt;/template&gt;</code> —— 模板（或称为视图）<br> <code>&lt;script&gt;</code>  执行的功能（业务逻辑） <code>&lt;/script&gt;</code> —— 逻辑<br> <code>&lt;style&gt;</code>  显示的样式 <code>&lt;/style&gt;</code> —— 样式<br><strong>官网示例</strong>：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>template<span class="token operator">></span>  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"example"</span><span class="token operator">></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> msg <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span><span class="token operator">&lt;</span>script<span class="token operator">></span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'Hello world!'</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span class="token operator">&lt;</span>style<span class="token operator">></span><span class="token punctuation">.</span>example <span class="token punctuation">&#123;</span>  <span class="token literal-property property">color</span><span class="token operator">:</span> red<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">></span><span class="token operator">&lt;</span>custom1<span class="token operator">></span>  This could be e<span class="token punctuation">.</span>g<span class="token punctuation">.</span> documentation <span class="token keyword">for</span> the component<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>custom1<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="template"><a class="markdownIt-Anchor" href="#template">#</a> template</h3><p><code>&lt;template&gt;&lt;/template&gt;</code>  语块包裹的内容将会被提取、传递给 @vue/compiler-dom，预编译为 JavaScript 渲染函数，并附在导出的组件上作为其 render 选项（vue 渲染页面的一种方式）。<br>我们来看一下示例中的简单的 template 视图层</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>example<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>&#123;&#123; msg &#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>首先是一组 <code>&lt;div&gt;</code>  标签，表示包含的内容是一个独立的部分，标签里的内容作为一个整体，有福同享，有难同当。</p><p><code>class</code>  是表示样式的类型，其在 <code>&lt;div&gt;</code>  的尖括号表明 <code>&lt;div&gt;</code>  里包含的内容都会应用到该样式，那么它所说的样式类型是 &quot;example&quot;, 这个样式来源里我们在 <code>&lt;style&gt;&lt;/style&gt;</code>  所定义的样式</p><p>最后让我们看看这个独立部分里面的内容 <code>&#123;&#123; msg &#125;&#125;</code> ，这里的 <code>&#123;&#123;&#125;&#125;</code>  叫做文本插值，使用 &quot;Mustache&quot; 语法，它与 <code>script</code>  标签里定义的 msg 的数据绑定， <code>&#123;&#123;msg&#125;&#125;</code>  会被替代为 msg 的值’Hello world!’，并且保持同步更新</p><p>在这基础之上，我们还可以给这个 <code>&lt;div&gt;</code>  块加上一个身份标识 id</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>example<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>&#123;&#123; msg &#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>当需要用到该部分的内容时，即可通过 &quot;app&quot; 这个 id 来引用</p><h3 id="script"><a class="markdownIt-Anchor" href="#script">#</a> script</h3><p><code>&lt;script&gt;&lt;/script&gt;</code>  包裹的是脚本代码，会作为 es 模块执行，进行业务逻辑的处理</p><blockquote><p>ECMAScript 模块（简称 ES 模块）是 2015 年推出的 JavaScript 中代码重用的机制</p></blockquote><p>我们来看一下示例中的简单的 script 逻辑层</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'Hello world!'</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>export 主要用于对外输出本模块变量的接口，一个文件就可以被理解为一个模块，首先是定义数据对象，使用对象来存放数据。js 中 {} 里的内容表示一个对象，在这里有两种写法，一种是直接定义一个对象，一种是通过一个函数返回一个 data 对象，基本都用后者，原因参考如下<br><a href="https://juejin.cn/post/7002584686232862734"> Vue 中的 data 是什么</a></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//直接定义</span><span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">//函数返回值</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>除 data 之外，script 层里还可以写其他内容<br><a href="https://juejin.cn/post/6844903796481458183">参考:vue script 结构</a></p>  <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">  <span class="token operator">&lt;</span>script<span class="token operator">></span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"Home"</span><span class="token punctuation">,</span>  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 组件的方法</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// watch擅长处理的场景：一个数据影响多个数据</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// computed擅长处理的场景：一个数据受多个数据影响</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function-variable function">beforeCreate</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 在实例初始化之后，数据观测(data observer) 和 event/watcher 事件配置之前被调用。</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function-variable function">created</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 实例已经创建完成之后被调用。在这一步，实例已完成以下的配置：数据观测(data observer)，属性和方法的运算， watch/event 事件回调。然而，挂载阶段还没开始，$el 属性目前不可见。</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function-variable function">beforeMount</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 在挂载开始之前被调用：相关的 render 函数首次被调用。</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function-variable function">mounted</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 编译好的HTML挂载到页面完成后执行的事件钩子</span>    <span class="token comment">// el 被新创建的 vm.$el 替换，并挂载到实例上去之后调用该钩子。</span>    <span class="token comment">// 此钩子函数中一般会做一些ajax请求获取数据进行数据初始化</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Home done"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function-variable function">beforeUpdate</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 数据更新时调用，发生在虚拟 DOM 重新渲染和打补丁之前。 你可以在这个钩子中进一步地更改状态，这不会触发附加的重渲染过程。</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function-variable function">updated</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 由于数据更改导致的虚拟 DOM 重新渲染和打补丁，在这之后会调用该钩子。</span>    <span class="token comment">// 当这个钩子被调用时，组件 DOM 已经更新，所以你现在可以执行依赖于 DOM 的操作。然而在大多数情况下，你应该避免在此期间更改状态，因为这可能会导致更新无限循环。</span>    <span class="token comment">// 该钩子在服务器端渲染期间不被调用。</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function-variable function">beforeDestroy</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 实例销毁之前调用。在这一步，实例仍然完全可用。</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function-variable function">destroyed</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// Vue 实例销毁后调用。调用后，Vue 实例指示的所有东西都会解绑定，所有的事件监听器会被移除，所有的子实例也会被销毁。 该钩子在服务器端渲染期间不被调用。</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在 script 中除了 export（导出）外，还有 import（导入），举个例子</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//从某路径下的show.vue文件导入showMsg()方法,该方法会显示括号里参数的内容</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> showMsg <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"@/api/show"</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'Hello world!'</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>    <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//实例已经创建完成之后被调用,即当你打开这个页面时就会使用</span>    <span class="token comment">//this.showHello()表示该组件方法method里的里的showHello()</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">showHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token literal-property property">method</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>    <span class="token function">showHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">//调用import进来showMsg,参数this.Msg为该组件数据data里的Msg</span>      <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当打开一个页面时会创建一个 vue 实例，调用 created (), 里面又调用了 method 里的 showMsg 方法，里面又调用了导入进来的 showMsg 方法，其参数来源于 data 里的 Msg，而 Msg 又会与 template 里的内容绑定</p><p>除了导入方法，还可以导入组件，官网原话</p><blockquote><p>Vue SFC 是一个框架指定的文件格式，因此必须交由 @vue/compiler-sfc 编译为标准的 JavaScript 和 CSS，一个编译后的 SFC 是一个标准的 JavaScript (ES) 模块，这也意味着在构建配置正确的前提下，你可以像导入其他 ES 模块一样导入 SFC：</p></blockquote><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> MyComponent <span class="token keyword">from</span> <span class="token string">'./MyComponent.vue'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    MyComponent  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>假如说我们已经写好了一个 MyComponent.vue 文件（单文件组件），并且在其他 vue 文件中想要复用这个组件，import 后在 template 层使用 <code>&lt;MyComponent&gt;&lt;/MyComponent&gt;</code>  即可</p><h3 id="style"><a class="markdownIt-Anchor" href="#style">#</a> style</h3><p><code>&lt;style&gt;&lt;/style&gt;</code>  包裹的是样式，可以使用 scoped 或 module attribute 来帮助封装当前组件的样式，在 template 层使用时 class=&quot;&quot; 即可使用样式<br>同样看官网示例中 <code>&lt;style&gt;</code>  标签里的内容</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.example</span> <span class="token punctuation">&#123;</span>  <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>样式名为 example，在 template 中使用该样式时加上 class=&quot;example&quot; 即可<br>此外在标签中可以使用 scoped 等帮助封装当前组件的样式<br>例如 <code>&lt;style scoped&gt;&lt;/style&gt;</code>  表明该 CSS 样式只能作用于当前的组件<br><a href="https://cn.vuejs.org/api/sfc-css-features.html">单文件组件 CSS 功能</a></p><h2 id="小结"><a class="markdownIt-Anchor" href="#小结">#</a> 小结</h2><p>一个 vue 文件基本上就由模板、逻辑与样式三部分组成，模板定义了一个个独立的模块与内容，样式决定了这些模块的外观，逻辑描述模板里的内容如何呈现。<br>至此单个 vue 文件的逻辑基本已理清， 但要写好一个界面，一个好看的界面还有很多细节需要慢慢地去熟悉，对于 vue 还要搞清 router 路由，各个页面之间的逻辑关系，且听下回分解</p>]]></content>
      
      
      <categories>
          
          <category> vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>spring boot-mybatis开发速成指南</title>
      <link href="/2022/12/01/spring%20boot-mybatis%E5%BC%80%E5%8F%91%E9%80%9F%E6%88%90%E6%8C%87%E5%8D%97/"/>
      <url>/2022/12/01/spring%20boot-mybatis%E5%BC%80%E5%8F%91%E9%80%9F%E6%88%90%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a class="markdownIt-Anchor" href="#前言">#</a> 前言</h1><p><strong>本文的目的</strong>：了解一个 spring boot 项目结构的关系，知道我们应该在哪个部分做什么事</p><h2 id="参考项目结构"><a class="markdownIt-Anchor" href="#参考项目结构">#</a> 参考项目结构</h2><pre class="line-numbers language-none"><code class="language-none">|_java.com.cy.store    |_aop    |_config    |_controller    |_entity    |_interceptor    |_mapper    |_service        |_ex        |_impl    |_util    |_vo    XXXApplication|_resource    |_mapper    |_static    |_templates    application.yml&#x2F;application.properties<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>不同项目项目结构不一样，但一般来讲，理清 controller 控制层、service 业务逻辑层、mapper（dao）数据访问层三层关系即可<br><a href="https://www.bilibili.com/video/BV1bf4y1V7Bx/?spm_id_from=333.1007.top_right_bar_window_custom_collection.content.click&amp;vd_source=195ead58c7d9bcfe9285069f7b6015eb">推荐项目学习</a>该视频下方有热心小伙伴的文档笔记整理<br>个人认为只看一个功能即可，其他大同小异，我只了解完用户注册剩下的大概看看就行了，主要是了解一个 spring boot 项目的整体思路</p><h2 id="三层关系"><a class="markdownIt-Anchor" href="#三层关系">#</a> 三层关系</h2><p><a href="https://blog.csdn.net/Mcdull__/article/details/117450764">controller、service、mapper 三层关系梳理 1</a><br><a href="https://blog.csdn.net/qq_41026669/article/details/107479927">controller、service、mapper 三层关系梳理 2</a><br><a href="https://blog.csdn.net/LL142857/article/details/89242816"> 适合理解的比喻</a></p><h1 id="数据库表设计"><a class="markdownIt-Anchor" href="#数据库表设计">#</a> 数据库（表）设计</h1><p><a href="https://www.bilibili.com/video/BV1w44y1576p/?spm_id_from=333.337.search-card.all.click&amp;vd_source=195ead58c7d9bcfe9285069f7b6015eb">快速学习数据库设计步骤</a></p><h1 id="实体层编写实体类"><a class="markdownIt-Anchor" href="#实体层编写实体类">#</a> 实体层（编写实体类）</h1><p>entity（或叫 model）实体，该层存放实体类，属性值与数据库中的属性值保持一致，实现 set 和 get 方法，可使用 @Data 注解自动生成</p><p>多个类拥有同一些属性，可以把这些属性抽取成一个公共基类这样方便我们管理。例如数据库许多实体类都需要有日志相关的四个属性：创建者和时间以及修改者和时间，则可先创建包含这些属性的基类，然后其他实体类再继承这个基类</p><h1 id="持久层-java对象与sql映射mapper接口与xml映射文件绑定"><a class="markdownIt-Anchor" href="#持久层-java对象与sql映射mapper接口与xml映射文件绑定">#</a> 持久层 （java 对象与 sql 映射）(Mapper 接口与 xml 映射文件绑定)</h1><p><a href="https://blog.csdn.net/meism5/article/details/108970550">sql 与 xml 绑定</a><br> mapper（或叫 dao），为 <code>映射</code> 的意思；dao（data access object），数据访问对象</p><hr><p><code>持久层</code> 的意思是使数据可以永久保持地存储，可以直接理解为对数据库的 CRUD 等操作<br>持久层就是把持久的动作封装成一个独立的层，这是为了降低功能代码之间的关联。创建一个更清晰的抽象，提高代码的内聚力，降低代码的耦合度，提高可维护性和复用性.</p><hr><p><code>Mybatis</code>  对 jdbc 的操作数据库的过程进行封装，通过 xml 或注解的方式将要执行的各种 statement（statement、preparedStatemnt）配置起来，并通过 java 对象和 statement 中的 sql 进行映射生成最终执行的 sql 语句，最后由 mybatis 框架执行 sql 并将结果映射成 java 对象并返回。</p><hr><p>总之：</p><blockquote><ol><li>确定好需要写的 sql;</li><li>在 java 文件夹下的 mapper 包编写持久层接口（Mapper 接口）： <code>XxxxMapper</code> , 在接口中定义需要实现的抽象方法；</li><li>在 resource 文件夹下的 mapper 包编写 xml 映射文件： <code>XxxxMapper.xml</code> ，编写对应 Mapper 接口的方法的 sql（抽象方法的映射配置），接口与 xml 文件绑定</li></ol></blockquote><p>1）Mapper 接口与 XML 文件的绑定是通过 XML 里 mapper 标签的 namespace 值与 Mapper 接口的 包路径。接口名 进行绑定<br> 2） Mapper 接口的方法名与 XML 文件中的 sql、select、insert、update、delete 标签的 id 参数值进行绑定</p><p>在配置文件中说明 xml 配置：mybatis.mapper-locations=classpath:mapper/*.xml</p><hr><h1 id="业务逻辑层"><a class="markdownIt-Anchor" href="#业务逻辑层">#</a> 业务逻辑层</h1><p><a href="https://blog.csdn.net/bookssea/article/details/107488749">DAO 层和 Service 层的理解</a></p><p>service 服务，此处翻译为业务比较合适，service 层处理业务逻辑<br> mapper 层是对数据库的操作，不涉及业务逻辑，具体是对某张表的增删查改</p><p>service 是业务逻辑，一个业务（功能）对应多项操作，需要有数据的处理流程和逻辑</p><pre><code>流程：先做什么，再做什么逻辑：能做什么，不能做什么</code></pre><hr><p><strong>例：用户注册</strong><br> mapper 层： <code>UserMapper</code>  中定义 <code>insert()</code>  方法（插入用户数据）、 <code>findByUsername()</code>  方法（根据用户名查询数据）<br>service 层： <code>UserService</code>  中定义的一个业务逻辑（功能）为 <code>reg()</code> （用户注册）， <code>reg()</code>  在数据库层面的理解其实就是 <code>insert()</code> ，但是 <code>insert（）</code> 不涉及数据处理流程和逻辑</p><p>reg () 的业务逻辑：先根据输入的用户名查询是否已存在用户数据（调用 <code>UserMapper</code>  的 <code>findByUsername()</code> ），如果不存在则插入用户数据（调用用 <code>UserMapper</code>  的 <code>insert()</code> ）, 如果存在则抛出用户已存在的异常。</p><p>在 service 包中，先在 <code>IUserService接口</code> 中定义 <code>reg()</code>  的抽象方法，然后在 <code>service.impl</code> （implement：实现）包中的 <code>UserServiceImpl</code>  实现类中实现 <code>reg()</code>  方法</p><hr><p>总之：</p><blockquote><ol><li>规划可能出现的异常，如用户名重复等，写在 Service.ex 包下</li><li>直接在在 Service 包下编写业务层接口（service 接口）： <code>IXxxxService</code> ，该命名方式开头的 I 表示接口，接口中定义要实现的抽象方法 —— 业务逻辑（功能）</li><li>在 service.impl 包下编写 service 接口的实现类： <code>XxxxServiceImpl</code> ，实现相应 service 接口中的抽象方法</li></ol></blockquote><p><a href="%E5%BD%93%E5%AE%9E%E7%8E%B0%E7%9A%84%E6%8E%A5%E5%8F%A3%E6%B6%89%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%BA%93%E6%95%B0%E6%8D%AE%E7%9A%84%E5%88%A0%E9%99%A4%E6%88%96%E4%BF%AE%E6%94%B9%E6%97%B6%EF%BC%8C%E6%96%B9%E6%B3%95%E4%B8%8A%E4%B8%80%E5%AE%9A%E8%A6%81%E6%B7%BB%E5%8A%A0%E6%B3%A8%E8%A7%A3@Transactional%EF%BC%8C%E5%90%A6%E5%88%99%E4%BC%9A%E6%89%A7%E8%A1%8C%E4%B8%8D%E6%88%90%E5%8A%9F%E3%80%82"></a></p><h1 id="控制层"><a class="markdownIt-Anchor" href="#控制层">#</a> 控制层</h1><p><a href="https://blog.csdn.net/kicinio/article/details/110806977">controller 的注解 1</a><br><a href="https://blog.csdn.net/jiahao1186/article/details/90634764">controller 的注解 2</a><br><a href="https://www.zhihu.com/question/434640634">controller 请求与响应</a><br><a href="https://blog.csdn.net/qq_43291207/article/details/110789568"> controller 请求与响应生动讲解</a><br><a href="https://blog.csdn.net/qq_43291207/article/details/110790415?spm=1001.2014.3001.5502"> controller 请求与响应生动讲解（续）</a></p><p>Controller , 控制器，与  <code>前端和service层</code>  交互，<br>把用户提交来的请求通过对 URL 的匹配，分配不同的接收器，再进行处理，然后向用户返回结果。</p><p>从 HTTP 请求中获取信息，提取参数，并将其分发给不同的处理服务（service 层），根据实际需求调用不同的 service 定义的方法来处理不同业务，并向前端返回 service 层处理后的数据，他的重点就在于如何从 HTTP 请求中获得信息，提取参数，并分发给不同的处理服务。接收和响应请求，校验数据</p><p>controller 负责管理 service，service 负责实施</p><hr><p><strong>例：用户注册</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"users"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token keyword">extends</span> <span class="token class-name">BaseController</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> <span class="token class-name">IUserService</span> userService<span class="token punctuation">;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"reg"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">JsonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">></span></span> <span class="token function">reg</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 调用业务对象执行注册</span>        userService<span class="token punctuation">.</span><span class="token function">reg</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 返回</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JsonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token comment">//省略其他代码</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在 UserController 中实例化 <code>IUserService</code>  对象 <code>userService</code></p><p><code>@RequestMapping(&quot;users&quot;)</code> 、 <code>@RequestMapping(&quot;reg&quot;)</code>  请求映射，将 http 请求路径映射到 Controller 方法上</p><p>当用户在前端点击注册后，前端请求通过…/users/reg 的路径发送给后端的 UserController，执行 <code>@RequestMapping(&quot;reg&quot;)</code>  下的 <code>reg()</code>  方法，注意这里的 reg () 是 Controller 层的，不负责 “用户注册” 这个业务的实现，它会调用 Service 层真正实现 “用户注册” 业务逻辑的 <code>userService.reg()</code> ;<br> 然后 <code>userService.reg()</code>  调用 mapper 层的数据库操作方法 <code>findByUsername()</code>  和 <code>insert()</code> ，根据映射的 xml 文件通过 Mybatis 执行 sql 连接操作数据库，把数据写入数据库，完成该业务逻辑，但还需要返回响应结果</p><blockquote><p><code>.../users</code>  请求路径是映射到 <code>@RequestMapping(&quot;users&quot;)</code>  下面的 UserController 类；<br> <code>.../users/reg</code>  请求路径映射到 <code>@RequestMapping(&quot;users&quot;)</code>  之下的 <code>@RequestMapping(&quot;reg&quot;)</code>  下面的 reg 方法</p></blockquote><hr><pre class="line-numbers language-java" data-language="java"><code class="language-java">再看一下上面的<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JsonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><code>JsonResult</code>  是自定义的响应结果类，统一返回结果<br>上面的 <code>200</code>  表示正常，即注册成功，如果成功执行了 reg 方法，则会创建一个 JsonResult 类的对象，其中 state（状态码）属性值设置为 200</p><p>自定义的 JsonResult 类包含属性 state（状态码）、message（状态描述信息）、data（数据），这里注册只需要知道是否操作成功就只返回状态码，如查询等业务则会还需要返回数据等</p><p>下面看一下前端代码，这个例子的前端用的是 Thymeleaf 模板引擎</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#btn-reg"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"/users/reg"</span><span class="token punctuation">,</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span><span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#form-reg"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token literal-property property">dataType</span><span class="token operator">:</span> <span class="token string">"json"</span><span class="token punctuation">,</span><span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">json</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"注册成功！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// location.href = "login.html";</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"注册失败！"</span> <span class="token operator">+</span> json<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>第四行的 url 即为上面提到前端的请求路径，该请求为 post 请求、提交数据，数据来源于 id 等于第六行 <code>&quot;#form-reg&quot;</code>  的表单（form），内容为用户注册所需要的信息，与 User 类属性一致，然后转化为 json 对象传给 Controller, 该对象（实参）在 Controller 中为 User 类的对象 user（形参）</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">JsonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">></span></span> <span class="token function">reg</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>后端的 Controller 接收该请求，当处理完请求后返回结果给前端<br>如上 <code>success: function(json)</code>  表示请求成功并返回信息（响应请求），这里括号里的 <code>json</code>  就是后端 Controller 返回的结果，即一个 JsonResult 类的对象（实参），其 state 属性值为 200，在前端中这个对象被命名为 json（形参），那么 Controller 返回结果成功则 json.state==200.</p><p>以上即为前后端交互的流程，Controller 负责接收请求和响应请求，调用 Service 处理业务，但自身不涉及业务逻辑</p><p>总之：</p><blockquote><ol><li>考虑要实现一个业务逻辑，用户在前端界面操作，该操作会从前端向后端传递什么，后端处理完该业务逻辑需要返回给前端什么</li><li>设计请求与响应，例：<br>请求路径：/users/reg<br> 请求参数：User user<br> 请求类型：POST<br> 响应结果：JsonResult<Void></li><li>在 Controller 包下编写控制器类： <code>XxxxController</code> ，在类中实例化需要调用的 service 对象：xxxxService</li><li><code>XxxxController</code>  中编写要实现业务的控制方法，包括请求参数与响应结果（返回值），调用 xxxxService 对象的 xxx () 方法</li><li>使用 <code>@RequestMapping</code>  等注解映射控制方法的请求路径，实现前后端的交互</li></ol></blockquote><h1 id="总结"><a class="markdownIt-Anchor" href="#总结">#</a> 总结</h1><p>用户操作前端界面，需要实现某种业务–前端发送请求给后端 controller–controller 接收请求，调用 service 处理该业务 --service 处理业务调用 mapper 的数据库操作方法 --mapper 方法与 mapper.xml 存在映射关系；–Mybatis 执行 sql–service 处理业完毕–controller 返回响应结果–前端返回反馈给用户</p><pre class="line-numbers language-none"><code class="language-none">用户操作前端界面，需要实现某种业务（&lt;?&gt; 操作内容）&#123;    &#x2F;&#x2F;前端api接口    &lt;操作反馈&gt; 前端发送请求给后端controller ()&#123;        &lt;?&gt; 请求路径        &lt;?&gt; 请求参数        &lt;?&gt; 请求类型        &lt;?&gt; 响应结果        &#x2F;&#x2F;controller层        &lt;响应结果&gt; controller接收请求，调用service处理该业务 (&lt;?&gt; 请求参数)&#123;            &#x2F;&#x2F;service层            service处理业务时，调用mapper的数据库操作方法 (&lt;?&gt; 请求参数)&#123;                &#x2F;&#x2F;mapper层                mapper方法与mapper.xml存在映射关系；                &#x2F;&#x2F;resource文件夹下的mapper的xml文件                执行sql；            &#125;        &#125;    &#125; &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>考虑的时候可以是前端 —controller—service—dao—database ；<br>写代码的时候则 database—dao—service—controller— 前端</p><p><strong>总而言之，言而总之</strong><br>在 mapper 层</p><blockquote><ol><li>确定好需要写的 sql;</li><li>在 java 文件夹下的 mapper 包编写持久层接口（Mapper 接口）： <code>XxxxMapper</code> , 在接口中定义需要实现的抽象方法；</li><li>在 resource 文件夹下的 mapper 包编写 xml 映射文件： <code>XxxxMapper.xml</code> ，编写对应 Mapper 接口的方法的 sql（抽象方法的映射配置），接口与 xml 文件绑定</li></ol></blockquote><p>在 service 层</p><blockquote><ol><li>规划可能出现的异常，如用户名重复等，写在 Service.ex 包下</li><li>直接在在 Service 包下编写业务层接口（service 接口）： <code>IXxxxService</code> ，该命名方式开头的 I 表示接口，接口中定义要实现的抽象方法 —— 业务逻辑（功能）</li><li>在 service.impl 包下编写 service 接口的实现类： <code>XxxxServiceImpl</code> ，实现相应 service 接口中的抽象方法</li></ol></blockquote><p>在 controller 层</p><blockquote><ol><li>考虑要实现一个业务逻辑，用户在前端界面操作，该操作会从前端向后端传递什么，后端处理完该业务逻辑需要返回给前端什么</li><li>设计请求与响应，例：<br>请求路径：/users/reg<br> 请求参数：User user<br> 请求类型：POST<br> 响应结果：JsonResult<Void></li><li>在 Controller 包下编写控制器类： <code>XxxxController</code> ，在类中实例化需要调用的 service 对象：xxxxService</li><li><code>XxxxController</code>  中编写要实现业务的控制方法，包括请求参数与响应结果（返回值），调用 xxxxService 对象的 xxx () 方法</li><li>使用 <code>@RequestMapping</code>  等注解映射控制方法的请求路径，实现前后端的交互</li></ol></blockquote>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2022/11/28/hello-world/"/>
      <url>/2022/11/28/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="quick-start"><a class="markdownIt-Anchor" href="#quick-start">#</a> Quick Start</h2><h3 id="create-a-new-post"><a class="markdownIt-Anchor" href="#create-a-new-post">#</a> Create a new post</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="run-server"><a class="markdownIt-Anchor" href="#run-server">#</a> Run server</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="generate-static-files"><a class="markdownIt-Anchor" href="#generate-static-files">#</a> Generate static files</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo generate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="deploy-to-remote-sites"><a class="markdownIt-Anchor" href="#deploy-to-remote-sites">#</a> Deploy to remote sites</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo deploy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
