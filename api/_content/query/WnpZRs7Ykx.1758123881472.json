{"_path":"/essay/23.gorm数据库操作","_dir":"essay","_draft":false,"_partial":false,"_locale":"","title":"gorm 数据库操作","description":"","subtitle":"Gorm database operations","index":23,"date":"2023-03-20","lunar_date":"二月廿九","year":"2023","month":"03","month_en":"Mar","day":"20","tag":"技术","tag_en":"TECH","cover":"/img/rabbit/023.jpg","categories":"golang","body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"数据库连接"},"children":[{"type":"text","value":"数据库连接"}]},{"type":"element","tag":"pre","props":{"className":["language-go"],"code":"dsn:=\"host=localhost user=postgres password=123456 dbname=iot-platform port=5432 sslmode=disable TimeZone=Asia/Shanghai\"\ndb, err := gorm.Open(postgres.Open(dsn))\n","language":"go","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"dsn:=\"host=localhost user=postgres password=123456 dbname=iot-platform port=5432 sslmode=disable TimeZone=Asia/Shanghai\"\ndb, err := gorm.Open(postgres.Open(dsn))\n"}]}]},{"type":"element","tag":"h1","props":{"id":"数据模型定义"},"children":[{"type":"text","value":"数据模型定义"}]},{"type":"element","tag":"pre","props":{"className":["language-go"],"code":"type UserBasic struct {\n    gorm.Model\n\n    Name string\n    Age int\n}\n\nfunc (table UserBasic)TableName() string {\n    return \"user_basic\"\n}\n","language":"go","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"type UserBasic struct {\n    gorm.Model\n\n    Name string\n    Age int\n}\n\nfunc (table UserBasic)TableName() string {\n    return \"user_basic\"\n}\n"}]}]},{"type":"element","tag":"h1","props":{"id":"数据模型-数据表映射"},"children":[{"type":"text","value":"数据模型-数据表映射"}]},{"type":"element","tag":"pre","props":{"className":["language-go"],"code":"db.AutoMigrate(&UserBasic,...)\n","language":"go","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"db.AutoMigrate(&UserBasic,...)\n"}]}]},{"type":"element","tag":"h1","props":{"id":"crud"},"children":[{"type":"text","value":"CRUD"}]},{"type":"element","tag":"pre","props":{"className":["language-go"],"code":"// 创建记录\nuser := User{Name: \"John\", Age: 30}\ndb.Create(&user)\n\n// 查询记录\nvar users []User\ndb.Find(&users)\ndb.First(&user, 1)\n\n// 更新记录\nuser.Name = \"Tom\"\ndb.Save(&user)\n\n// 删除记录\ndb.Delete(&user)\n","language":"go","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// 创建记录\nuser := User{Name: \"John\", Age: 30}\ndb.Create(&user)\n\n// 查询记录\nvar users []User\ndb.Find(&users)\ndb.First(&user, 1)\n\n// 更新记录\nuser.Name = \"Tom\"\ndb.Save(&user)\n\n// 删除记录\ndb.Delete(&user)\n"}]}]},{"type":"element","tag":"h1","props":{"id":"原生sql"},"children":[{"type":"text","value":"原生SQL"}]},{"type":"element","tag":"pre","props":{"className":["language-go"],"code":"rows, err := db.Raw(\"SELECT name, age FROM users WHERE age > ?\", 18).Rows()\ndefer rows.Close()\n\nfor rows.Next() {\n    var name string\n    var age int\n\n    rows.Scan(&name, &age)\n\n    fmt.Println(name, age)\n}\n","language":"go","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"rows, err := db.Raw(\"SELECT name, age FROM users WHERE age > ?\", 18).Rows()\ndefer rows.Close()\n\nfor rows.Next() {\n    var name string\n    var age int\n\n    rows.Scan(&name, &age)\n\n    fmt.Println(name, age)\n}\n"}]}]},{"type":"element","tag":"h1","props":{"id":"事务"},"children":[{"type":"text","value":"事务"}]},{"type":"element","tag":"pre","props":{"className":["language-go"],"code":"tx := db.Begin()\n\n// 在事务中执行操作\nif err := tx.Create(&User{Name: \"John\", Age: 30}).Error; err != nil {\n    // 发生错误时回滚事务\n    tx.Rollback()\n}\n\n// 成功时提交事务\ntx.Commit()\n","language":"go","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"tx := db.Begin()\n\n// 在事务中执行操作\nif err := tx.Create(&User{Name: \"John\", Age: 30}).Error; err != nil {\n    // 发生错误时回滚事务\n    tx.Rollback()\n}\n\n// 成功时提交事务\ntx.Commit()\n"}]}]},{"type":"element","tag":"h1","props":{"id":"联合查询"},"children":[{"type":"text","value":"联合查询"}]},{"type":"element","tag":"pre","props":{"className":["language-go"],"code":"var user User\nvar email Email\n\ndb.Joins(\"JOIN emails ON users.id = emails.user_id\").Where(\"users.name = ?\", \"John\").Find(&user, &email)\n","language":"go","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"var user User\nvar email Email\n\ndb.Joins(\"JOIN emails ON users.id = emails.user_id\").Where(\"users.name = ?\", \"John\").Find(&user, &email)\n"}]}]}],"toc":{"title":"","searchDepth":2,"depth":3,"links":[]}},"_type":"markdown","_id":"content:essay:23.gorm数据库操作.md","_source":"content","_file":"essay/23.gorm数据库操作.md","_stem":"essay/23.gorm数据库操作","_extension":"md"}