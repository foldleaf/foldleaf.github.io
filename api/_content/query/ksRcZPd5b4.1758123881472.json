{"_path":"/essay/31.rust模块系统","_dir":"essay","_draft":false,"_partial":false,"_locale":"","title":"rust模块系统","description":"参考文章:\nhttps://www.sheshbabu.com/posts/rust-module-system/","subtitle":"Clear explanation of Rust’s module system","index":31,"date":"2023-04-09","lunar_date":"闰二十九","year":"2023","month":"04","month_en":"Apr","day":"09","tag":"技术","tag_en":"TECH","cover":"/img/rabbit/031.jpg","categories":"rust","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"参考文章:\n"},{"type":"element","tag":"a","props":{"href":"https://www.sheshbabu.com/posts/rust-module-system/","rel":["nofollow"]},"children":[{"type":"text","value":"https://www.sheshbabu.com/posts/rust-module-system/"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"另外，rust虽然可能不错，但rust的基金会经常会搞出一些骚操作，让我犹豫要不要继续学"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.zhihu.com/question/594913275","rel":["nofollow"]},"children":[{"type":"text","value":"https://www.zhihu.com/question/594913275"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://rustcc.cn/article?id=37017d56-bf8d-4395-9359-3f996a81f7f7","rel":["nofollow"]},"children":[{"type":"text","value":"https://rustcc.cn/article?id=37017d56-bf8d-4395-9359-3f996a81f7f7"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://rustcc.cn/article?id=2db1b8b9-fe59-4069-97bd-0c4343860ffc","rel":["nofollow"]},"children":[{"type":"text","value":"https://rustcc.cn/article?id=2db1b8b9-fe59-4069-97bd-0c4343860ffc"}]}]},{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"使用cargo创建新项目rust_demo,在rust_demo/src下建立如下项目结构"}]},{"type":"element","tag":"pre","props":{"className":["language-bash"],"code":"│  config.rs\n│  main.rs\n│\n├─models\n│       mod.rs\n│       user_model.rs\n│      \n└─routes\n        mod.rs\n        health_route.rs\n        user_route.rs\n","language":"bash","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"│  config.rs\n│  main.rs\n│\n├─models\n│       mod.rs\n│       user_model.rs\n│      \n└─routes\n        mod.rs\n        health_route.rs\n        user_route.rs\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"对于该项目结构，模块系统如下"}]},{"type":"element","tag":"pre","props":{"className":["language-bash"],"code":"crate\n│  \n├─config\n│\n├─models  \n│   │\n│   └─ user_model\n│\n└─routes\n    │\n    ├─ health_route\n    │\n    └─ user_route\n","language":"bash","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"crate\n│  \n├─config\n│\n├─models  \n│   │\n│   └─ user_model\n│\n└─routes\n    │\n    ├─ health_route\n    │\n    └─ user_route\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"接下来会循序渐进地讲解"}]},{"type":"element","tag":"h1","props":{"id":"mainrs调用同层级"},"children":[{"type":"text","value":"main.rs调用同层级"}]},{"type":"element","tag":"pre","props":{"className":["language-rust"],"code":"│  config.rs\n│  main.rs\n","language":"rust","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"│  config.rs\n│  main.rs\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在config.rs中定义了"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"print_config()"}]},{"type":"text","value":"函数·"}]},{"type":"element","tag":"pre","props":{"className":["language-rust"],"code":"pub fn print_config(){\n    println!(\"我是config\")\n}\n","language":"rust","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"pub fn print_config(){\n    println!(\"我是config\")\n}\n"}]}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"函数默认为私有，使用pub关键字声明为共有，才能在外部使用"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在main.rs使用"}]},{"type":"element","tag":"pre","props":{"className":["language-rust"],"code":"// mod 关键字声明为一个模块\n// cargo new创建的项目，以 src 为默认的根模块，名称为 crate\n\nmod  config;    // 与要引用的 config.rs 文件名同名\n\nfn main() {\n    // 完整路径为:  crate::config::print_config();\n    // 因为 main.rs 与 config.rs 所处为根模块 crate，所以 crate 可省略\n    config::print_config();\n}\n","language":"rust","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// mod 关键字声明为一个模块\n// cargo new创建的项目，以 src 为默认的根模块，名称为 crate\n\nmod  config;    // 与要引用的 config.rs 文件名同名\n\nfn main() {\n    // 完整路径为:  crate::config::print_config();\n    // 因为 main.rs 与 config.rs 所处为根模块 crate，所以 crate 可省略\n    config::print_config();\n}\n"}]}]},{"type":"element","tag":"h1","props":{"id":"mainrs调用不同层级"},"children":[{"type":"text","value":"main.rs调用不同层级"}]},{"type":"element","tag":"pre","props":{"className":["language-bash"],"code":"│  config.rs\n│  main.rs\n│\n└─models\n        mod.rs\n        user_model.rs\n","language":"bash","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"│  config.rs\n│  main.rs\n│\n└─models\n        mod.rs\n        user_model.rs\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"models/user_model.rs"}]},{"type":"element","tag":"pre","props":{"className":["language-rust"],"code":"pub fn print_user_model() {\n    println!(\"我是user_model\");\n}\n","language":"rust","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"pub fn print_user_model() {\n    println!(\"我是user_model\");\n}\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"新建models/mod.rs,在mod.rs中声明模块 mod"}]},{"type":"element","tag":"pre","props":{"className":["language-rust"],"code":"// 文件 mod.rs 表明所处的目录 models 为一个 mod\npub mod user_model;// 子 mod 名称与其文件名相同\n","language":"rust","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// 文件 mod.rs 表明所处的目录 models 为一个 mod\npub mod user_model;// 子 mod 名称与其文件名相同\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在main.rs中调用"}]},{"type":"element","tag":"pre","props":{"className":["language-rust"],"code":"mod  config;\nmod  models;\n\nfn main() {\n    config::print_config();\n    models::user_model::print_user_model();\n    // `一级mod` :: `二级mod` :: ... :: `函数`\n}\n","language":"rust","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"mod  config;\nmod  models;\n\nfn main() {\n    config::print_config();\n    models::user_model::print_user_model();\n    // `一级mod` :: `二级mod` :: ... :: `函数`\n}\n"}]}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"mod.rs表明了该文件所处的目录"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"models"}]},{"type":"text","value":"为一个mod"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"在mod.rs中声明公有的子mod:"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"user_model"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"在main.rs中使用"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"models/user_model.rs"}]},{"type":"text","value":"中的函数"}]}]}]},{"type":"element","tag":"h1","props":{"id":"不同层级的rs文件调用"},"children":[{"type":"text","value":"不同层级的rs文件调用"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"最后的文件层级如下："}]},{"type":"element","tag":"pre","props":{"className":["language-bash"],"code":"│  config.rs\n│  main.rs\n│\n├─models\n│      mod.rs\n│      user_model.rs\n│      \n└─routes\n        mod.rs\n        user_route.rs\n","language":"bash","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"│  config.rs\n│  main.rs\n│\n├─models\n│      mod.rs\n│      user_model.rs\n│      \n└─routes\n        mod.rs\n        user_route.rs\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"routes/mod.rs"}]},{"type":"element","tag":"pre","props":{"className":["language-rust"],"code":"pub mod user_models\n","language":"rust","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"pub mod user_models\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在routes/user_routes.rs中调用models/user_model的函数"}]},{"type":"element","tag":"pre","props":{"className":["language-rust"],"code":"pub fn print_user_route() {\n    println!(\"print_user_model被调用了！\");\n    crate::models::user_model::print_user_model();\n}\n","language":"rust","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"pub fn print_user_route() {\n    println!(\"print_user_model被调用了！\");\n    crate::models::user_model::print_user_model();\n}\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"main.rs中使用"}]},{"type":"element","tag":"pre","props":{"className":["language-rust"],"code":"mod  config;\nmod  routes;\nmod  models;\n\nfn main() {\n    println!(\"我是main\");\n    config::print_config();\n    models::user_model::print_user_model();\n    routes::user_route::print_user_route();\n}\n","language":"rust","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"mod  config;\nmod  routes;\nmod  models;\n\nfn main() {\n    println!(\"我是main\");\n    config::print_config();\n    models::user_model::print_user_model();\n    routes::user_route::print_user_route();\n}\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"对于该文件层级定义的各个mod模块，其模块系统如下"}]},{"type":"element","tag":"pre","props":{"className":["language-bash"],"code":"crate\n│  \n├─config\n│\n├─models  \n│   │\n│   └─ user_model\n│\n└─routes\n    │\n    └─ user_route\n","language":"bash","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"crate\n│  \n├─config\n│\n├─models  \n│   │\n│   └─ user_model\n│\n└─routes\n    │\n    └─ user_route\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"crate为根模块，在上述routes/user_routes.rs中使用crate的绝对路径调用:"}]},{"type":"element","tag":"pre","props":{"className":["language-rust"],"code":"crate::models::user_model::print_user_model();\n","language":"rust","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"crate::models::user_model::print_user_model();\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"路径太长在编写代码时不易阅读，使用use关键字\n修改routes/user_routes.rs"}]},{"type":"element","tag":"pre","props":{"className":["language-rust"],"code":"// 使用 use 引入模块的函数，后续只需要写函数名即可\nuse crate::models::user_model::print_user_model;\npub fn print_user_route() {\n    println!(\"print_user_model被调用了！\");\n    print_user_model();\n}\n","language":"rust","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// 使用 use 引入模块的函数，后续只需要写函数名即可\nuse crate::models::user_model::print_user_model;\npub fn print_user_route() {\n    println!(\"print_user_model被调用了！\");\n    print_user_model();\n}\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"使用 as 关键字重新自定义调用的函数名并使用，可解决名称冲突的问题"}]},{"type":"element","tag":"pre","props":{"className":["language-rust"],"code":"use crate::models::user_model::print_user_model as aa;\npub fn print_user_route() {\n    println!(\"print_user_model被调用了！\");\n    aa();\n}\n","language":"rust","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"use crate::models::user_model::print_user_model as aa;\npub fn print_user_route() {\n    println!(\"print_user_model被调用了！\");\n    aa();\n}\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"上面的crate为绝对路径调用，下面使用supper进行相对路径调用:\n在routes中再新建一个health_route.rs"}]},{"type":"element","tag":"pre","props":{"className":["language-bash"],"code":"│  config.rs\n│  main.rs\n│\n├─models\n│      mod.rs\n│      user_model.rs\n│      \n└─routes\n        mod.rs\n        user_route.rs\n        health_route.rs\n","language":"bash","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"│  config.rs\n│  main.rs\n│\n├─models\n│      mod.rs\n│      user_model.rs\n│      \n└─routes\n        mod.rs\n        user_route.rs\n        health_route.rs\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"routes/health_route.rs"}]},{"type":"element","tag":"pre","props":{"className":["language-rust"],"code":"pub fn print_health_route() {\n  println!(\"我是health_route\");\n}\n","language":"rust","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"pub fn print_health_route() {\n  println!(\"我是health_route\");\n}\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"要想在外部调用，不要忘记先在routes/mod.rs中声明"}]},{"type":"element","tag":"pre","props":{"className":["language-rust"],"code":"pub mod health_route;\npub mod user_route;\n","language":"rust","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"pub mod health_route;\npub mod user_route;\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"routes/user_route.rs"}]},{"type":"element","tag":"pre","props":{"className":["language-rust"],"code":"use crate::models::user_model::print_user_model as aa;\npub fn print_user_route() {\n    println!(\"print_user_model被调用了！\");\n    aa();\n\n    println!(\"print_health_route被调用了！\");\n    super::health_route::print_health_route();\n}\n","language":"rust","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"use crate::models::user_model::print_user_model as aa;\npub fn print_user_route() {\n    println!(\"print_user_model被调用了！\");\n    aa();\n\n    println!(\"print_health_route被调用了！\");\n    super::health_route::print_health_route();\n}\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"super是上一层级的mod，对于user_routes来说上一级为:"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"crate::models"}]}]}],"toc":{"title":"","searchDepth":2,"depth":3,"links":[]}},"_type":"markdown","_id":"content:essay:31.rust模块系统.md","_source":"content","_file":"essay/31.rust模块系统.md","_stem":"essay/31.rust模块系统","_extension":"md"}