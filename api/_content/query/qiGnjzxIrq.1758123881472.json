{"_path":"/essay/12.gin-gorm4ç”¨æˆ·æ¨¡å—æ¥å£","_dir":"essay","_draft":false,"_partial":false,"_locale":"","title":"4.gin-gormç”¨æˆ·æ¨¡å—æ¥å£","description":"é€šè¿‡gin-gormä¹‹é¡¹ç›®å­¦ä¹ éƒ¨åˆ†çš„å­¦ä¹ ï¼Œå¯ä»¥å¯¹é¡¹ç›®çš„æ¶æ„æœ‰æ·±å…¥çš„äº†è§£ ğŸ¤Ÿ\n{% post_link \"gin-gorm1é¡¹ç›®å‡†å¤‡åˆå§‹åŒ–\" %}\n{% post_link \"gin-gorm2æ•°æ®åº“\" %}\n{% post_link \"gin-gorm3é”™è¯¯å¤„ç†ä¸è·¯ç”±æ¥å£\" %}\n{% post_link \"gin-gorm4ç”¨æˆ·æ¨¡å—æ¥å£ç¼–å†™\" %}\n{% post_link \"gin-gorm5å¯†ç åŠ å¯†\" %}\n{% post_link \"gin-gorm6ç¼–è¾‘ã€åˆ é™¤ç”¨æˆ·\" %}","subtitle":"Interface of user module","index":12,"date":"2023-02-13 00:00:04","lunar_date":"æ­£æœˆå»¿ä¸‰","year":"2023","month":"02","month_en":"Feb","day":"13","tag":"æŠ€æœ¯","tag_en":"TECH","cover":"/img/rabbit/012.jpg","categories":"gin-gormä¹‹é¡¹ç›®å­¦ä¹ ","body":{"type":"root","children":[{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"é€šè¿‡"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"gin-gormä¹‹é¡¹ç›®å­¦ä¹ "}]},{"type":"text","value":"éƒ¨åˆ†çš„å­¦ä¹ ï¼Œå¯ä»¥å¯¹é¡¹ç›®çš„æ¶æ„æœ‰æ·±å…¥çš„äº†è§£ ğŸ¤Ÿ\n{% post_link \"gin-gorm1é¡¹ç›®å‡†å¤‡åˆå§‹åŒ–\" %}"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n{% post_link \"gin-gorm2æ•°æ®åº“\" %}"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n{% post_link \"gin-gorm3é”™è¯¯å¤„ç†ä¸è·¯ç”±æ¥å£\" %}"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n{% post_link \"gin-gorm4ç”¨æˆ·æ¨¡å—æ¥å£ç¼–å†™\" %}"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n{% post_link \"gin-gorm5å¯†ç åŠ å¯†\" %}"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n{% post_link \"gin-gorm6ç¼–è¾‘ã€åˆ é™¤ç”¨æˆ·\" %}"},{"type":"element","tag":"br","props":{},"children":[]}]},{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"h1","props":{"id":"ç”¨æˆ·æ¨¡å—-å¢æŸ¥"},"children":[{"type":"text","value":"ç”¨æˆ·æ¨¡å—-å¢ã€æŸ¥"}]},{"type":"element","tag":"h2","props":{"id":"æ–°å¢ç”¨æˆ·"},"children":[{"type":"text","value":"æ–°å¢ç”¨æˆ·"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"åœ¨model/User.goä¸­ç¼–å†™ï¼Œæˆ–è€…æ–°å»ºserviceå±‚æ–‡ä»¶ä¹Ÿå¯ä»¥"}]},{"type":"element","tag":"pre","props":{"className":["language-go"],"code":"// æŸ¥è¯¢ç”¨æˆ·æ˜¯å¦å­˜åœ¨\nfunc CheckUser(name string) (code int) {\n    var users User\n    //æŸ¥è¯¢ä½¿ç”¨è¯¥ç”¨æˆ·åçš„ id\n    db.Select(\"id\").Where(\"username =?\", name).First(&users)\n    //å­˜åœ¨ä½¿ç”¨è¯¥ç”¨æˆ·åçš„ id\n    if users.ID > 0 {\n        return errmsg.ERROR_USERNAME_USED //1001\n    }\n    return errmsg.SUCCESS //200\n}\n\n// æ–°å¢ç”¨æˆ·   è¿”å›çŠ¶æ€ç \nfunc CreateUser(data *User) int {\n    err := db.Create(&data).Error\n    if err != nil {\n        return errmsg.ERROR //500\n    }\n    return errmsg.SUCCESS //200\n\n}\n\n","language":"go","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// æŸ¥è¯¢ç”¨æˆ·æ˜¯å¦å­˜åœ¨\nfunc CheckUser(name string) (code int) {\n    var users User\n    //æŸ¥è¯¢ä½¿ç”¨è¯¥ç”¨æˆ·åçš„ id\n    db.Select(\"id\").Where(\"username =?\", name).First(&users)\n    //å­˜åœ¨ä½¿ç”¨è¯¥ç”¨æˆ·åçš„ id\n    if users.ID > 0 {\n        return errmsg.ERROR_USERNAME_USED //1001\n    }\n    return errmsg.SUCCESS //200\n}\n\n// æ–°å¢ç”¨æˆ·   è¿”å›çŠ¶æ€ç \nfunc CreateUser(data *User) int {\n    err := db.Create(&data).Error\n    if err != nil {\n        return errmsg.ERROR //500\n    }\n    return errmsg.SUCCESS //200\n\n}\n\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"åœ¨api/v1/user.goæ¥å£æ–‡ä»¶ä¸­è¡¥å…¨æ·»åŠ ç”¨æˆ·AddUserçš„ä»£ç "}]},{"type":"element","tag":"pre","props":{"className":["language-go"],"code":"// æ·»åŠ ç”¨æˆ·\nfunc AddUser(ctx *gin.Context) {\n    var data model.User\n    _ = ctx.ShouldBindJSON(&data)\n    code = model.CheckUser(data.Username)\n    if code == errmsg.SUCCESS {\n        model.CreateUser(&data)\n    }\n    ctx.JSON(http.StatusOK, gin.H{\n        \"status\":  code,\n        \"data\":    data,\n        \"message\": errmsg.GetErrMsg(code),\n    })\n}\n","language":"go","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// æ·»åŠ ç”¨æˆ·\nfunc AddUser(ctx *gin.Context) {\n    var data model.User\n    _ = ctx.ShouldBindJSON(&data)\n    code = model.CheckUser(data.Username)\n    if code == errmsg.SUCCESS {\n        model.CreateUser(&data)\n    }\n    ctx.JSON(http.StatusOK, gin.H{\n        \"status\":  code,\n        \"data\":    data,\n        \"message\": errmsg.GetErrMsg(code),\n    })\n}\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"åœ¨modelä¸­ï¼Œæˆ‘ä»¬å†™çš„æ˜¯å¯¹æ•°æ®åº“çš„æ“ä½œä»¥åŠæ“ä½œçš„åé¦ˆ\nåœ¨apiä¸­ï¼Œæˆ‘ä»¬å†™çš„æ˜¯æ‰§è¡Œæ“ä½œçš„é€»è¾‘(æ“ä½œæ‰§è¡Œçš„æ¡ä»¶ã€é¡ºåº)ä»¥åŠè¿”å›ç»™å‰ç«¯çš„ä¿¡æ¯"}]},{"type":"element","tag":"h2","props":{"id":"æŸ¥è¯¢ç”¨æˆ·"},"children":[{"type":"text","value":"æŸ¥è¯¢ç”¨æˆ·"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"model/User.go"}]},{"type":"element","tag":"pre","props":{"className":["language-go"],"code":"// æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨ åˆ†é¡µ\nfunc GetUsers(pageSize int, pageNum int) []User {\n    var users []User\n    err = db.Limit(pageSize).Offset((pageNum - 1) * pageSize).Find(&users).Error\n    if err != nil {\n        return nil\n    }\n    return users\n}\n","language":"go","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨ åˆ†é¡µ\nfunc GetUsers(pageSize int, pageNum int) []User {\n    var users []User\n    err = db.Limit(pageSize).Offset((pageNum - 1) * pageSize).Find(&users).Error\n    if err != nil {\n        return nil\n    }\n    return users\n}\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"api/v1/user.go"}]},{"type":"element","tag":"pre","props":{"className":["language-go"],"code":"// æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨ åˆ†é¡µ\n// å‰ç«¯éœ€è¦ä¼ é€’åˆ†é¡µçš„è®¾ç½®ä¿¡æ¯ç»™åç«¯\nfunc GetUsers(ctx *gin.Context) {\n    pageSize, _ := strconv.Atoi(ctx.Query(\"pagesize\"))\n    pageNum, _ := strconv.Atoi(ctx.Query(\"pagenum\"))\n    if pageSize == 0 {\n        pageSize = -1\n    }\n    if pageNum == 0 {\n        pageNum = -1\n    }\n    data := model.GetUsers(pageSize, pageNum)\n    code = errmsg.SUCCESS\n    ctx.JSON(http.StatusOK, gin.H{\n        \"status\":  code,\n        \"data\":    data,\n        \"message\": errmsg.GetErrMsg(code),\n    })\n}\n","language":"go","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨ åˆ†é¡µ\n// å‰ç«¯éœ€è¦ä¼ é€’åˆ†é¡µçš„è®¾ç½®ä¿¡æ¯ç»™åç«¯\nfunc GetUsers(ctx *gin.Context) {\n    pageSize, _ := strconv.Atoi(ctx.Query(\"pagesize\"))\n    pageNum, _ := strconv.Atoi(ctx.Query(\"pagenum\"))\n    if pageSize == 0 {\n        pageSize = -1\n    }\n    if pageNum == 0 {\n        pageNum = -1\n    }\n    data := model.GetUsers(pageSize, pageNum)\n    code = errmsg.SUCCESS\n    ctx.JSON(http.StatusOK, gin.H{\n        \"status\":  code,\n        \"data\":    data,\n        \"message\": errmsg.GetErrMsg(code),\n    })\n}\n"}]}]},{"type":"element","tag":"h2","props":{"id":"é™„åŠ æ¥å£æµ‹è¯•"},"children":[{"type":"text","value":"é™„åŠ ï¼šæ¥å£æµ‹è¯•"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"é€‰æ‹©æ¥å£æµ‹è¯•å·¥å…·ï¼špostmanã€apipostç­‰ç­‰"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"åœ¨åœ°å€æ è¾“å…¥è®¿é—®è°ƒç”¨å‡½æ•°çš„è·¯ç”±åœ°å€"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"localhost:3000/api/v1/user/add\t"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"localhost:3000/api/v1/users"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nè¿™äº›å·²ç»åœ¨routerä¸­å®šä¹‰å¥½ï¼Œlocalhost:3000æ˜¯ä½ å®šä¹‰çš„æœåŠ¡å™¨åœ°å€ç«¯å£ï¼Œ/api/v1æ˜¯ä½ å®šä¹‰çš„è·¯ç”±ç»„å…¥å£ï¼Œåé¢çš„æ˜¯è°ƒç”¨å‡½æ•°çš„è·¯ç”±åŠå‚æ•°"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ä»¥ä¸Šä¸¤ä¸ªåŠŸèƒ½ä¸ºä¾‹ï¼Œä½¿ç”¨apipostä¸ºä¾‹ï¼š"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"æ·»åŠ ç”¨æˆ·æµ‹è¯•"}]},{"type":"text","value":"ï¼š"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"é€‰æ‹©POSTæ–¹å¼ï¼Œåœ°å€æ è¾“å…¥localhost:3000/api/v1/user/add\né€‰æ‹©body-raw-jsonï¼Œè¾“å…¥Useræ•°æ®(jsonæ ¼å¼),ç‚¹å‡»å‘é€"}]},{"type":"element","tag":"pre","props":{"className":["language-json"],"code":"{\n    \"username\": \"li8\",\n    \"password\": \"123456\",\n    \"role\": 0,\n}\n","language":"json","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"{\n    \"username\": \"li8\",\n    \"password\": \"123456\",\n    \"role\": 0,\n}\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"å¯ä»¥çœ‹åˆ°å“åº”ä¿¡æ¯"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"æŸ¥è¯¢ç”¨æˆ·æµ‹è¯•"}]},{"type":"text","value":"ï¼š"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"éœ€è¦å…ˆæ·»åŠ å¤šä¸ªç”¨æˆ·"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"é€‰æ‹©GETæ–¹å¼ï¼Œåœ°å€æ è¾“å…¥localhost:3000/api/v1/users"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"é€‰æ‹©queryï¼Œå¡«å†™å‚æ•°pagesizeã€pagenum,ç‚¹å‡»å‘é€ï¼Œå¯ä»¥çœ‹åˆ°å“åº”ä¿¡æ¯"}]}],"toc":{"title":"","searchDepth":2,"depth":3,"links":[{"id":"æ–°å¢ç”¨æˆ·","depth":2,"text":"æ–°å¢ç”¨æˆ·"},{"id":"æŸ¥è¯¢ç”¨æˆ·","depth":2,"text":"æŸ¥è¯¢ç”¨æˆ·"},{"id":"é™„åŠ æ¥å£æµ‹è¯•","depth":2,"text":"é™„åŠ ï¼šæ¥å£æµ‹è¯•"}]}},"_type":"markdown","_id":"content:essay:12.gin-gorm4ç”¨æˆ·æ¨¡å—æ¥å£.md","_source":"content","_file":"essay/12.gin-gorm4ç”¨æˆ·æ¨¡å—æ¥å£.md","_stem":"essay/12.gin-gorm4ç”¨æˆ·æ¨¡å—æ¥å£","_extension":"md"}